----------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  gmatch_example_ado
       log:  C:\Users\kkranker\Documents\Stata\Ado\Devel\gmatch\gmatch_example_ado.log
  log type:  text
 opened on:  13 Feb 2018, 23:04:10

. di as txt "Current user: `c(username)'" _n "Environment: `c(os)' `c(machine_type)' `: environment computername'" _n "Stata: `c(stata_version)'" cond(c(stata_v
> ersion)==c(version),""," (set to version `c(version)')") _n "Date: " c(current_date) " " c(current_time)
Current user: KKranker
Environment: Windows PC (64-bit x86-64) KKRANKER
Stata: 15.1
Date: 13 Feb 2018 23:04:10

. desc, short

Contains data from C:\Users\kkranker\Documents\Stata\Multiple-Equation-Models\simple_cattaneo_data.dta
  obs:         4,642                          Cattaneo (2010) study on the effect of maternal smoking on birth weight
 vars:            22                          8 Apr 2015 05:07
 size:       366,718                          
Sorted by: 
     Note: Dataset has changed since last saved.

. summ `treatvar' `varlist' `tousevar' `wgtvar' `depvars'

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       treat |      4,642    .1861267    .3892508          0          1
          x1 |      4,642    .6996984    .4584385          0          1
        1.x2 |      4,642    .0340371    .1813439          0          1
        1.x3 |      4,642    .0534252    .2249042          0          1
          x4 |      4,642    .4379578    .4961893          0          1
-------------+---------------------------------------------------------
          x5 |      4,642    26.50452    5.619026         13         45
          x6 |      4,642    12.68957    2.520661          0         17
          x7 |      4,642    6.540069    3.359167          1         12
         x90 |      4,642   -.0031039    1.020177  -4.107368   3.325766
         x91 |      4,642   -.0212069    1.008708   -4.16458   3.503644
-------------+---------------------------------------------------------
         x92 |      4,642    .0076449    1.004589  -3.449011   3.959166
         x93 |      4,642    .0049339    1.004513  -4.274254   3.777972
         x94 |      4,642    .0124264    .9818583  -3.659006   3.658309
         x95 |      4,642    .0044283    1.010194   -3.41615   3.724456
       touse |      4,642    .1077122      .31005          0          1
-------------+---------------------------------------------------------
         wgt |      4,642    1.993316    .4062602   .6638338   3.540576
          y1 |      4,642     3361.68    578.8196        340       5500
   y1_binary |      4,642    .9396812    .2381022          0          1

. 
. 
. // * UNWEIGHTED DATA EXAMPLES *
. 
. // Replicate CBPS
. 
. cbps `treatvar' `varlist' if `tousevar' , ate logit optimization_technique("nr") evaluator_type("gf1")
Iteration 0:   f(p) =  .00647386  
Iteration 1:   f(p) =  .00451406  
Iteration 2:   f(p) =   .0005336  
Iteration 3:   f(p) =  .00001373  
Iteration 4:   f(p) =  2.637e-08  
Iteration 5:   f(p) =  6.777e-13  
Iteration 6:   f(p) =  1.066e-21  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.441064   .5046768    -2.86   0.004    -2.430213   -.4519161
        1.x2 |  -2.548784   3.501511    -0.73   0.467     -9.41162    4.314051
        1.x3 |   -1.02318   2.005094    -0.51   0.610    -4.953091    2.906732
          x4 |  -.2320966   .5678014    -0.41   0.683    -1.344967    .8807737
          x5 |   .0736983    .042799     1.72   0.085    -.0101862    .1575829
          x6 |  -.4863391   .1923869    -2.53   0.011    -.8634106   -.1092676
          x7 |   .0655415   .0720901     0.91   0.363    -.0757525    .2068354
         x90 |   .0303861    .203675     0.15   0.881    -.3688096    .4295819
         x91 |  -.0236437   .2499136    -0.09   0.925    -.5134655     .466178
         x92 |   .2014652   .2092517     0.96   0.336    -.2086606    .6115911
         x93 |  -.0067202   .2511949    -0.03   0.979    -.4990531    .4856126
         x94 |  -.3662317   .2431817    -1.51   0.132     -.842859    .1103956
         x95 |  -.0080118   .2531324    -0.03   0.975    -.5041423    .4881187
       _cons |   3.127763   1.826429     1.71   0.087    -.4519713    6.707497
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , ate cbps pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  2.590e-08  
Iteration 1:   f(p) =  2.548e-08  (backed up)
Iteration 2:   f(p) =  1.980e-08  
Iteration 3:   f(p) =  1.652e-08  
Iteration 4:   f(p) =  1.627e-08  
Iteration 5:   f(p) =  1.540e-08  
Iteration 6:   f(p) =  1.451e-08  
Iteration 7:   f(p) =  1.377e-08  
Iteration 8:   f(p) =  1.290e-08  
Iteration 9:   f(p) =  1.195e-08  
Iteration 10:  f(p) =  1.168e-08  
Iteration 11:  f(p) =  1.075e-08  
(switching technique to nr)
Iteration 12:  f(p) =  1.026e-08  
Iteration 13:  f(p) =  7.037e-09  
Iteration 14:  f(p) =  2.042e-10  
Iteration 15:  f(p) =  1.083e-12  
Iteration 16:  f(p) =  4.356e-17  
Iteration 17:  f(p) =  3.968e-25  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.441064  |
   2 |      i1.x2   -2.548784  |
   3 |      i1.x3    -1.02318  |
   4 |         x4   -.2320966  |
   5 |         x5    .0736983  |
   6 |         x6   -.4863391  |
   7 |         x7    .0655415  |
   8 |        x90    .0303861  |
   9 |        x91   -.0236437  |
  10 |        x92    .2014652  |
  11 |        x93   -.0067202  |
  12 |        x94   -.3662317  |
  13 |        x95   -.0080118  |
  14 |      _cons    3.127763  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  3.96776e-25
  balance table after matching (cbps_port_stata):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6750468      .6750468      1.72e-11      3.66e-11      .4688264      1.008511  |
   3 |        i1.x2      .0219357      .0219357      1.15e-11      7.84e-11      .1466203      1.008511  |
   4 |        i1.x3      .0370067      .0370067      2.40e-10      1.27e-09      .1889672      1.008511  |
   5 |           x4      .4861037      .4861037      5.20e-11      1.04e-10      .5003074      1.008511  |
   6 |           x5      26.25386      26.25386      2.87e-11      4.57e-12      6.268993      .6747771  |
   7 |           x6      12.63471      12.63471      4.25e-10      1.81e-10      2.343236      .5637225  |
   8 |           x7      6.724952      6.724952     -2.27e-10     -6.76e-11      3.360602      1.190087  |
   9 |          x90     -.0592246     -.0592246      6.94e-11      6.66e-11      1.042785      1.206644  |
  10 |          x91      .0116973      .0116973     -1.60e-10     -1.64e-10      .9810721      .9436962  |
  11 |          x92     -.0041245     -.0041245     -4.42e-11     -4.33e-11      1.020036      1.339887  |
  12 |          x93      .0443809      .0443809      3.14e-11      3.24e-11      .9681889      .8469644  |
  13 |          x94     -.0856689     -.0856689     -1.31e-11     -1.29e-11      1.015864      .7767335  |
  14 |          x95     -.0859154     -.0859154     -5.97e-12     -6.11e-12      .9766877      .8347645  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2477.54534
  cv of matching weights (cbps_port_stata):
  .5275374066
  sd of matching weights (cbps_port_stata):
  .5275374066
  skewness of matching weights (cbps_port_stata):
  .2158747756
  kurtosis of matching weights (cbps_port_stata):
  .0860729366
  this.mean_sd_sq(denominator)
  1.29573e-20
  this.mean_asd(denominator)
  1.58973e-10
  this.max_asd(denominator)
  1.26919e-09
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .439       .78      .783      .792       .81      .867      .991       1.3      2.57      6.91
         |       408         1      .439       .78      .783      .792       .81      .867      .991       1.3      2.57      6.91
         |       408      .161      .168    .00228    .00588     .0177     .0388      .102      .214        .4      .697      .887
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1      .815      .189      .189      .334      .416      .725      1.39      1.89      5.12      5.12
         |        92         1      .815      .189      .189      .334      .416      .725      1.39      1.89      5.12      5.12
         |        92      .289      .189     .0343     .0343     .0927      .126      .242      .423      .526      .928      .928
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .528      .189      .285      .763        .8       .86      1.04      1.46      3.09      6.91
         |       500         1      .528      .189      .285      .763        .8       .86      1.04      1.46      3.09      6.91
         |       500      .185      .179    .00228    .00648     .0207     .0485       .12      .268      .461      .712      .928
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.441064
        1.x2 |  -2.548784
        1.x3 |   -1.02318
          x4 |  -.2320966
          x5 |   .0736983
          x6 |  -.4863391
          x7 |   .0655415
         x90 |   .0303861
         x91 |  -.0236437
         x92 |   .2014652
         x93 |  -.0067202
         x94 |  -.3662317
         x95 |  -.0080118
       _cons |   3.127763
------------------------------------------------------------------------------

. cbps `treatvar' `varlist' if `tousevar' , ate over logit optimization_technique("nr") evaluator_type("gf1")
Iteration 0:   f(p) =  .02441999  (not concave)
Iteration 1:   f(p) =    .020112  
Iteration 2:   f(p) =  .01484746  
Iteration 3:   f(p) =   .0142955  
Iteration 4:   f(p) =  .01428412  
Iteration 5:   f(p) =  .01428407  
Iteration 6:   f(p) =  .01428407  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.074574   .2572873    -4.18   0.000    -1.578848      -.5703
        1.x2 |  -1.732571    .847337    -2.04   0.041    -3.393321   -.0718214
        1.x3 |   -.535995   .6259896    -0.86   0.392    -1.762912    .6909221
          x4 |  -.2389831   .2458124    -0.97   0.331    -.7207666    .2428004
          x5 |   .0484453   .0243181     1.99   0.046     .0007828    .0961078
          x6 |  -.2519975   .0459113    -5.49   0.000    -.3419819    -.162013
          x7 |   .0081703   .0322545     0.25   0.800    -.0550474    .0713879
         x90 |    .120204   .1075227     1.12   0.264    -.0905366    .3309445
         x91 |  -.1467757   .1099013    -1.34   0.182    -.3621782    .0686269
         x92 |   .1315867   .1151671     1.14   0.253    -.0941367    .3573101
         x93 |    .086207   .1113523     0.77   0.439    -.1320395    .3044534
         x94 |  -.1702521    .103099    -1.65   0.099    -.3723225    .0318183
         x95 |   .0217906    .112224     0.19   0.846    -.1981643    .2417456
       _cons |   1.206345   .6074599     1.99   0.047      .015746    2.396945
------------------------------------------------------------------------------
J test for overidentifying restrictions: P(chisq>7.142, 14) = 0.929

. gmatch `treatvar' `varlist' if `tousevar' , ate cbps ipw pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  9.768e-08  
Iteration 1:   f(p) =  9.599e-08  (backed up)
Iteration 2:   f(p) =  7.672e-08  
Iteration 3:   f(p) =  6.399e-08  
Iteration 4:   f(p) =  6.304e-08  
Iteration 5:   f(p) =  6.026e-08  
Iteration 6:   f(p) =  5.854e-08  
Iteration 7:   f(p) =  5.801e-08  
Iteration 8:   f(p) =  5.780e-08  
Iteration 9:   f(p) =  5.775e-08  
Iteration 10:  f(p) =  5.764e-08  
Iteration 11:  f(p) =  5.743e-08  
(switching technique to nr)
Iteration 12:  f(p) =  5.722e-08  
Iteration 13:  f(p) =  5.714e-08  
Iteration 14:  f(p) =  5.714e-08  
Iteration 15:  f(p) =  5.714e-08  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.074574  |
   2 |      i1.x2   -1.732571  |
   3 |      i1.x3   -.5359949  |
   4 |         x4    -.238983  |
   5 |         x5    .0484453  |
   6 |         x6   -.2519974  |
   7 |         x7    .0081703  |
   8 |        x90     .120204  |
   9 |        x91   -.1467757  |
  10 |        x92    .1315867  |
  11 |        x93     .086207  |
  12 |        x94   -.1702521  |
  13 |        x95    .0217906  |
  14 |      _cons    1.206345  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  5.71363e-08
  balance table after matching (cbps_port_stata):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6406563      .7027893      -.062133     -.1343718      .4623962      1.111543  |
   3 |        i1.x2      .0157701      .0233767     -.0076067     -.0518322      .1467555      .6856459  |
   4 |        i1.x3       .024807      .0398362     -.0150293     -.0794675      .1891246      .6378543  |
   5 |           x4      .4886894      .4862356      .0024538      .0049044      .5003233      1.008759  |
   6 |           x5      25.82556      26.34781     -.5222463      -.087499      5.968599        .75999  |
   7 |           x6      12.33004       12.9064     -.5763641     -.2576164      2.237296      .5881093  |
   8 |           x7       6.88452      6.669732      .2147883      .0639215      3.360189      1.180429  |
   9 |          x90     -.0713183     -.0265029     -.0448154     -.0441805      1.014371      1.157748  |
  10 |          x91       .020009     -.0226109      .0426199       .043028      .9905145      .9174008  |
  11 |          x92      .0040221     -.0083767      .0123988       .012151      1.020391      1.200576  |
  12 |          x93      .0229491       .055179       -.03223     -.0331899      .9710769      .8891008  |
  13 |          x94      -.121595     -.0231316     -.0984633     -.0994521       .990058      .8143466  |
  14 |          x95     -.0950136      -.071595     -.0234187     -.0239408      .9781897      .8041468  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2458.474471
  cv of matching weights (cbps_port_stata):
  .2958975518
  sd of matching weights (cbps_port_stata):
  .2958975518
  skewness of matching weights (cbps_port_stata):
  .1574497673
  kurtosis of matching weights (cbps_port_stata):
  .065431859
  this.mean_sd_sq(denominator)
  .0027971508
  this.mean_asd(denominator)
  .0719657755
  this.max_asd(denominator)
  .2576163762
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1       .18      .819      .835      .857      .887      .939      1.05      1.24      1.57      2.46
         |       408         1       .18      .819      .835      .857      .887      .939      1.05      1.24      1.57      2.46
         |       408      .173      .114     .0142     .0324     .0574     .0892       .14      .232      .346      .487      .672
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1      .579      .317      .317      .509      .572      .789      1.36      1.63       4.2       4.2
         |        92         1      .579      .317      .317      .509      .572      .789      1.36      1.63       4.2       4.2
         |        92      .274       .13     .0508     .0508      .131      .157      .271      .373       .42      .673      .673
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .296      .317      .452      .822      .872      .936      1.08      1.33      2.05       4.2
         |       500         1      .296      .317      .452      .822      .872      .936      1.08      1.33      2.05       4.2
         |       500      .191      .123     .0142     .0339     .0609     .0967      .153      .263      .381       .55      .673
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.074574
        1.x2 |  -1.732571
        1.x3 |  -.5359949
          x4 |   -.238983
          x5 |   .0484453
          x6 |  -.2519974
          x7 |   .0081703
         x90 |    .120204
         x91 |  -.1467757
         x92 |   .1315867
         x93 |    .086207
         x94 |  -.1702521
         x95 |   .0217906
       _cons |   1.206345
------------------------------------------------------------------------------

. cbps `treatvar' `varlist' if `tousevar' , att logit optimization_technique("nr") evaluator_type("gf1")
Iteration 0:   f(p) =  .00197031  
Iteration 1:   f(p) =  .00006892  
Iteration 2:   f(p) =  1.777e-07  
Iteration 3:   f(p) =  2.570e-12  
Iteration 4:   f(p) =  6.940e-22  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.339291   .3615444    -3.70   0.000    -2.047905   -.6306769
        1.x2 |  -1.525175    1.19071    -1.28   0.200    -3.858923    .8085728
        1.x3 |  -.5996277   .8424377    -0.71   0.477    -2.250775     1.05152
          x4 |  -.3183658   .3103113    -1.03   0.305    -.9265647    .2898331
          x5 |   .0587883     .02835     2.07   0.038     .0032234    .1143533
          x6 |  -.2435676   .0675718    -3.60   0.000    -.3760059   -.1111292
          x7 |   .0341034   .0400884     0.85   0.395    -.0444685    .1126752
         x90 |    .158599   .1286436     1.23   0.218    -.0935378    .4107357
         x91 |  -.1617619    .131618    -1.23   0.219    -.4197284    .0962045
         x92 |   .1391156   .1358437     1.02   0.306    -.1271333    .4053644
         x93 |   .0571151    .134574     0.42   0.671    -.2066451    .3208752
         x94 |  -.1175052   .1193236    -0.98   0.325    -.3513752    .1163649
         x95 |    .011505   .1383574     0.08   0.934    -.2596705    .2826805
       _cons |    .782858    .962964     0.81   0.416    -1.104517    2.670233
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet cbps pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  7.881e-09  
Iteration 1:   f(p) =  7.799e-09  (backed up)
Iteration 2:   f(p) =  7.301e-09  
Iteration 3:   f(p) =  5.045e-09  
Iteration 4:   f(p) =  4.162e-09  
Iteration 5:   f(p) =  3.700e-09  
Iteration 6:   f(p) =  3.063e-09  
Iteration 7:   f(p) =  2.655e-09  
Iteration 8:   f(p) =  2.353e-09  
Iteration 9:   f(p) =  2.232e-09  
Iteration 10:  f(p) =  1.928e-09  
Iteration 11:  f(p) =  1.687e-09  
(switching technique to nr)
Iteration 12:  f(p) =  1.155e-09  
Iteration 13:  f(p) =  8.181e-12  
Iteration 14:  f(p) =  4.655e-16  
Iteration 15:  f(p) =  2.607e-24  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.339291  |
   2 |      i1.x2   -1.525175  |
   3 |      i1.x3   -.5996277  |
   4 |         x4   -.3183658  |
   5 |         x5    .0587883  |
   6 |         x6   -.2435676  |
   7 |         x7    .0341034  |
   8 |        x90     .158599  |
   9 |        x91   -.1617619  |
  10 |        x92    .1391156  |
  11 |        x93    .0571151  |
  12 |        x94   -.1175052  |
  13 |        x95     .011505  |
  14 |      _cons     .782858  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  2.60710e-24
  balance table after matching (cbps_port_stata):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4673913     -1.38e-10     -2.77e-10      .4994352      1.008511  |
   3 |        i1.x2      .0108696      .0108696     -7.66e-11     -7.38e-10      .1037929      1.008511  |
   4 |        i1.x3      .0217391      .0217391     -8.17e-11     -5.60e-10      .1459766      1.008511  |
   5 |           x4      .4347826      .4347826     -4.03e-10     -8.12e-10      .4962249      1.008511  |
   6 |           x5      25.46739      25.46739     -1.76e-09     -2.65e-10      6.664728      .6195799  |
   7 |           x6      11.86957      11.86957     -1.98e-09     -9.69e-10      2.043536      .5669465  |
   8 |           x7      6.858696      6.858696     -1.77e-10     -5.27e-11      3.363971      1.145237  |
   9 |          x90      .0972024      .0972024      4.54e-11      4.44e-11      1.021603       .845302  |
  10 |          x91     -.0890157     -.0890157     -3.25e-11     -3.40e-11      .9556678      .9654928  |
  11 |          x92      .0453787      .0453787      4.05e-11      4.06e-11      .9971707      1.136731  |
  12 |          x93      .0865687      .0865687     -6.32e-11     -6.65e-11        .95074      .9577067  |
  13 |          x94     -.1299173     -.1299173      5.29e-10      5.16e-10       1.02511      .7795321  |
  14 |          x95     -.0807251     -.0807251      8.07e-11      8.42e-11      .9586344      .8888006  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2605.10307
  cv of matching weights (cbps_port_stata):
  .9884371288
  sd of matching weights (cbps_port_stata):
  .9884371288
  skewness of matching weights (cbps_port_stata):
  .1100078305
  kurtosis of matching weights (cbps_port_stata):
  .0225364399
  this.mean_sd_sq(denominator)
  5.64485e-20
  this.mean_asd(denominator)
  3.42965e-10
  this.max_asd(denominator)
  9.69336e-10
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .988     .0568      .125      .226      .376      .636      1.25      2.36      4.58      7.03
         |       408         1      .988     .0568      .125      .226      .376      .636      1.25      2.36      4.58      7.03
         |       408      .163      .117     .0127     .0273     .0486     .0782      .125       .22      .347      .508      .613
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .273      .149     .0434     .0434      .108      .138      .264      .383      .459      .687      .687
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .893     .0568      .126      .247      .433      .808      1.05      2.06      4.53      7.03
         |       500         1      .893     .0568      .126      .247      .433      .808      1.05      2.06      4.53      7.03
         |       500      .183      .131     .0127     .0276     .0522     .0876      .141      .256      .389      .587      .687
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.339291
        1.x2 |  -1.525175
        1.x3 |  -.5996277
          x4 |  -.3183658
          x5 |   .0587883
          x6 |  -.2435676
          x7 |   .0341034
         x90 |    .158599
         x91 |  -.1617619
         x92 |   .1391156
         x93 |   .0571151
         x94 |  -.1175052
         x95 |    .011505
       _cons |    .782858
------------------------------------------------------------------------------

. cbps `treatvar' `varlist' if `tousevar' , att over logit optimization_technique("nr") evaluator_type("gf1")
Iteration 0:   f(p) =  .04521356  
Iteration 1:   f(p) =  .03210384  
Iteration 2:   f(p) =   .0303286  
Iteration 3:   f(p) =   .0302734  
Iteration 4:   f(p) =  .03027339  
Iteration 5:   f(p) =  .03027339  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.171988   .2187737    -5.36   0.000    -1.600776   -.7431991
        1.x2 |  -1.909814   .6607307    -2.89   0.004    -3.204822   -.6148052
        1.x3 |  -.4402667   .7269474    -0.61   0.545    -1.865057     .984524
          x4 |  -.3130788   .2251092    -1.39   0.164    -.7542848    .1281272
          x5 |   .0503881   .0191417     2.63   0.008     .0128711    .0879051
          x6 |  -.2393185   .0575186    -4.16   0.000     -.352053   -.1265841
          x7 |   .0261168   .0311563     0.84   0.402    -.0349484    .0871821
         x90 |   .1425533   .1007579     1.41   0.157    -.0549285    .3400351
         x91 |  -.1282785   .1127153    -1.14   0.255    -.3491964    .0926393
         x92 |      .1073   .1112316     0.96   0.335    -.1107099    .3253099
         x93 |   .0527165   .1101053     0.48   0.632    -.1630859    .2685189
         x94 |  -.1248021   .0971592    -1.28   0.199    -.3152305    .0656263
         x95 |   .0220743   .1115296     0.20   0.843    -.1965196    .2406683
       _cons |   .9132207   .6048419     1.51   0.131    -.2722476    2.098689
------------------------------------------------------------------------------
J test for overidentifying restrictions: P(chisq>15.137, 14) = 0.369

. gmatch `treatvar' `varlist' if `tousevar' , atet cbps ipw pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  1.809e-07  
Iteration 1:   f(p) =  1.775e-07  (backed up)
Iteration 2:   f(p) =  1.749e-07  
Iteration 3:   f(p) =  1.665e-07  
Iteration 4:   f(p) =  1.593e-07  
Iteration 5:   f(p) =  1.436e-07  
Iteration 6:   f(p) =  1.400e-07  
Iteration 7:   f(p) =  1.356e-07  
Iteration 8:   f(p) =  1.328e-07  
Iteration 9:   f(p) =  1.272e-07  
Iteration 10:  f(p) =  1.231e-07  
Iteration 11:  f(p) =  1.224e-07  
(switching technique to nr)
Iteration 12:  f(p) =  1.220e-07  
Iteration 13:  f(p) =  1.211e-07  
Iteration 14:  f(p) =  1.211e-07  
Iteration 15:  f(p) =  1.211e-07  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.171988  |
   2 |      i1.x2   -1.909811  |
   3 |      i1.x3   -.4402667  |
   4 |         x4   -.3130788  |
   5 |         x5    .0503881  |
   6 |         x6   -.2393185  |
   7 |         x7    .0261168  |
   8 |        x90    .1425533  |
   9 |        x91   -.1282785  |
  10 |        x92    .1072999  |
  11 |        x93    .0527165  |
  12 |        x94   -.1248021  |
  13 |        x95    .0220743  |
  14 |      _cons    .9132204  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  1.21094e-07
  balance table after matching (cbps_port_stata):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4923283     -.0249369      -.049839      .5003503      1.004458  |
   3 |        i1.x2      .0108696      .0074884      .0033811      .0376594      .0897824      1.458885  |
   4 |        i1.x3      .0217391       .023711     -.0019719     -.0130452       .151158      .9265074  |
   5 |           x4      .4347826      .4386729     -.0038903     -.0078334      .4966326      1.006495  |
   6 |           x5      25.46739      25.45801      .0093781      .0014148      6.628535      .6273162  |
   7 |           x6      11.86957      11.89491     -.0253428     -.0123239        2.0564       .559006  |
   8 |           x7      6.858696      6.790863      .0678324      .0201339       3.36906      1.140985  |
   9 |          x90      .0972024      .0826851      .0145173      .0142151      1.021263      .8460037  |
  10 |          x91     -.0890157     -.0671192     -.0218965     -.0227622      .9619657      .9503048  |
  11 |          x92      .0453787      .0235132      .0218655      .0219385      .9966695      1.138269  |
  12 |          x93      .0865687      .0849356       .001633      .0017143      .9526181      .9531308  |
  13 |          x94     -.1299173     -.1339674      .0040501      .0039553      1.023979      .7815571  |
  14 |          x95     -.0807251     -.0745052     -.0062199     -.0064787      .9600495      .8856706  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2587.152909
  cv of matching weights (cbps_port_stata):
  .9155855903
  sd of matching weights (cbps_port_stata):
  .9155855903
  skewness of matching weights (cbps_port_stata):
  .1040781462
  kurtosis of matching weights (cbps_port_stata):
  .0213437015
  this.mean_sd_sq(denominator)
  7.49044e-07
  this.mean_asd(denominator)
  .0164087468
  this.max_asd(denominator)
  .0498389796
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .916     .0457      .134      .253      .397      .671      1.27      2.31      4.01      6.68
         |       408         1      .916     .0457      .134      .253      .397      .671      1.27      2.31      4.01      6.68
         |       408      .164      .111     .0101     .0291     .0535     .0814       .13      .221       .34      .472      .599
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .266      .134      .047      .047      .116      .151       .26      .364      .429      .666      .666
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .827     .0457      .138      .276      .454      .871      1.06      2.01      3.95      6.68
         |       500         1      .827     .0457      .138      .276      .454      .871      1.06      2.01      3.95      6.68
         |       500      .183      .122     .0101     .0298     .0577     .0913      .147      .253      .376      .555      .666
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.171988
        1.x2 |  -1.909811
        1.x3 |  -.4402667
          x4 |  -.3130788
          x5 |   .0503881
          x6 |  -.2393185
          x7 |   .0261168
         x90 |   .1425533
         x91 |  -.1282785
         x92 |   .1072999
         x93 |   .0527165
         x94 |  -.1248021
         x95 |   .0220743
       _cons |   .9132204
------------------------------------------------------------------------------

. 
. // Other objective functions
. gmatch `treatvar' `varlist' if `tousevar' , atet mean_sd_sq treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00032638  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  8.089e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  5.298e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  1.465e-13  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.206443  |
   2 |      i1.x2   -1.628676  |
   3 |      i1.x3     -.58031  |
   4 |         x4   -.2832337  |
   5 |         x5     .069416  |
   6 |         x6   -.2787871  |
   7 |         x7    .0283208  |
   8 |        x90    .1446874  |
   9 |        x91   -.1322013  |
  10 |        x92    .1288213  |
  11 |        x93    .0633599  |
  12 |        x94   -.1645469  |
  13 |        x95    .0190734  |
  14 |      _cons     1.37953  |
     +-------------------------+
  Balance after CBPS (mean_sd_sq):
  optimize_result_value(S)
  1.46475e-13
  balance table after matching (mean_sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5065699    -.0391786    -.0780965     .5016695     1.004395  |
   3 |       i1.x2     .0108696     .0094032     .0014663     .0140644     .1042572      1.16405  |
   4 |       i1.x3     .0217391     .0217076     .0000315     .0002149     .1466296     1.009943  |
   5 |          x4     .4347826     .4181838     .0165988     .0333012     .4984448     1.018627  |
   6 |          x5     25.46739     26.05539    -.5880034     -.108011     5.443922     .5832672  |
   7 |          x6     11.86957     11.79935     .0702201     .0437493     1.605057     .5528997  |
   8 |          x7     6.858696      6.77528     .0834157     .0234531     3.556704     1.141156  |
   9 |         x90     .0972024      .056997     .0402054     .0421535     .9537854     .8487816  |
  10 |         x91    -.0890157     -.062197    -.0268186    -.0284411     .9429542     .9668971  |
  11 |         x92     .0453787     .0391245     .0062542     .0059497     1.051175     1.151879  |
  12 |         x93     .0865687       .10444    -.0178714    -.0191144     .9349714     .9622811  |
  13 |         x94    -.1299173    -.1873487     .0574314     .0621009     .9248091     .7465149  |
  14 |         x95    -.0807251    -.0886595     .0079344     .0086809      .914005     .8927751  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (mean_sd_sq):
  2608.892909
  cv of matching weights (mean_sd_sq):
  1.041361059
  sd of matching weights (mean_sd_sq):
  1.041361059
  skewness of matching weights (mean_sd_sq):
  .171087219
  kurtosis of matching weights (mean_sd_sq):
  .0624911137
  this.mean_sd_sq(denominator)
  1.46475e-13
  this.mean_asd(denominator)
  .0359485287
  this.max_asd(denominator)
  .1080109802
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      1.04     .0503      .106      .224      .365      .657      1.23      2.34      4.29      11.1
         |       408         1      1.04     .0503      .106      .224      .365      .657      1.23      2.34      4.29      11.1
         |       408      .232      .146     .0183     .0376     .0766      .119      .196      .313      .465      .614      .804
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .364      .163     .0707     .0707      .176      .215      .347      .492      .558      .798      .798
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1       .94     .0503      .115       .25      .426      .845      1.07      1.96      4.24      11.1
         |       500         1       .94     .0503      .115       .25      .426      .845      1.07      1.96      4.24      11.1
         |       500      .257      .158     .0183     .0409     .0838      .136      .216       .35      .497      .687      .804
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = mean(stddiff())^2
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.206443
        1.x2 |  -1.628676
        1.x3 |    -.58031
          x4 |  -.2832337
          x5 |    .069416
          x6 |  -.2787871
          x7 |   .0283208
         x90 |   .1446874
         x91 |  -.1322013
         x92 |   .1288213
         x93 |   .0633599
         x94 |  -.1645469
         x95 |   .0190734
       _cons |    1.37953
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet sd_sq treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .02141594  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .02005607  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01097598  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00782372  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00292673  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00193285  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00085471  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00063406  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00028285  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00013476  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00008047  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00006325  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =   .0000443  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =   .0000369  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  .00002338  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  .00001546  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  .00001346  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  .00001212  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  .00001088  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  .00001082  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  9.573e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  9.389e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  4.485e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  4.003e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  3.814e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  3.376e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  3.119e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  3.112e-06  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.342283  |
   2 |      i1.x2   -1.536597  |
   3 |      i1.x3   -.5895909  |
   4 |         x4   -.3200163  |
   5 |         x5    .0587867  |
   6 |         x6   -.2431739  |
   7 |         x7    .0340359  |
   8 |        x90    .1583933  |
   9 |        x91   -.1615859  |
  10 |        x92    .1382431  |
  11 |        x93    .0570086  |
  12 |        x94    -.117411  |
  13 |        x95    .0107444  |
  14 |      _cons    1.396628  |
     +-------------------------+
  Balance after CBPS (sd_sq):
  optimize_result_value(S)
  3.11232e-06
  balance table after matching (sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4669726     .0004187     .0008347     .5016695     1.008622  |
   3 |       i1.x2     .0108696     .0107984     .0000712     .0006826     .1042572     1.015084  |
   4 |       i1.x3     .0217391     .0218933    -.0001541    -.0010512     .1466296     1.001568  |
   5 |          x4     .4347826     .4345332     .0002494     .0005004     .4984448     1.008645  |
   6 |          x5     25.46739     25.46671     .0006823     .0001253     5.443922     .6197459  |
   7 |          x6     11.86957     11.87004    -.0004781    -.0002979     1.605057     .5670785  |
   8 |          x7     6.858696     6.858366     .0003297     .0000927     3.556704     1.145052  |
   9 |         x90     .0972024     .0971255     .0000769     .0000806     .9537854     .8451478  |
  10 |         x91    -.0890157    -.0888662    -.0001495    -.0001585     .9429542     .9655653  |
  11 |         x92     .0453787     .0447441     .0006345     .0006036     1.051175     1.136783  |
  12 |         x93     .0865687     .0865005     .0000681     .0000729     .9349714     .9577067  |
  13 |         x94    -.1299173    -.1298303     -.000087    -.0000941     .9248091     .7795743  |
  14 |         x95    -.0807251    -.0809687     .0002436     .0002665      .914005     .8885584  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (sd_sq):
  2605.245654
  cv of matching weights (sd_sq):
  .9889151443
  sd of matching weights (sd_sq):
  .9889151443
  skewness of matching weights (sd_sq):
  .1098386248
  kurtosis of matching weights (sd_sq):
  .022431189
  this.mean_sd_sq(denominator)
  1.62578e-08
  this.mean_asd(denominator)
  .000373925
  this.max_asd(denominator)
  .001051243
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .989     .0561      .123      .227      .376      .636      1.25      2.37      4.58      7.01
         |       408         1      .989     .0561      .123      .227      .376      .636      1.25      2.37      4.58      7.01
         |       408      .252      .154     .0229      .049     .0865      .136       .21      .343      .497      .657      .745
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .392      .175     .0775     .0775      .184      .229      .399      .535      .611      .802      .802
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .893     .0561      .126      .246      .433      .808      1.05      2.06      4.54      7.01
         |       500         1      .893     .0561      .126      .246      .433      .808      1.05      2.06      4.54      7.01
         |       500      .278      .167     .0229     .0499     .0925      .151      .232      .389      .542      .724      .802
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = stddiff():^2
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.342283
        1.x2 |  -1.536597
        1.x3 |  -.5895909
          x4 |  -.3200163
          x5 |   .0587867
          x6 |  -.2431739
          x7 |   .0340359
         x90 |   .1583933
         x91 |  -.1615859
         x92 |   .1382431
         x93 |   .0570086
         x94 |   -.117411
         x95 |   .0107444
       _cons |   1.396628
------------------------------------------------------------------------------

. 
. // IPW
. teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , atet aequations

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  4.978e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Treated vs Untreated)  |  -365.5251   68.93598    -5.30   0.000    -500.6371   -230.4131
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3417.895   43.41569    78.72   0.000     3332.801    3502.988
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.207512   .3268258    -3.69   0.000    -1.848079   -.5669452
                        |
                     x2 |
                     1  |  -1.628792   1.054719    -1.54   0.123    -3.696005    .4384199
                        |
                     x3 |
                     1  |  -.5805318   .8259794    -0.70   0.482    -2.199422    1.038358
                     x4 |  -.2831153   .2838113    -1.00   0.318    -.8393752    .2731445
                     x5 |   .0545179   .0270259     2.02   0.044     .0015481    .1074878
                     x6 |  -.2844593   .0688093    -4.13   0.000     -.419323   -.1495955
                     x7 |    .023871   .0390129     0.61   0.541    -.0525929    .1003349
                    x90 |   .1439494   .1292697     1.11   0.265    -.1094145    .3973133
                    x91 |  -.1331182   .1248073    -1.07   0.286    -.3777361    .1114997
                    x92 |   .1277527    .133834     0.95   0.340    -.1345572    .3900625
                    x93 |   .0623585   .1243317     0.50   0.616    -.1813271    .3060441
                    x94 |  -.1663354   .1194682    -1.39   0.164    -.4004887    .0678179
                    x95 |    .017776   .1254901     0.14   0.887    -.2281801     .263732
                  _cons |   1.379538   .9297905     1.48   0.138    -.4428177    3.201894
-----------------------------------------------------------------------------------------

. di _b[POmean:0.treat]
3417.8947

. tebalance summarize

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        247.8
                          Control obs   =          408        252.2
                          -----------------------------------------

  -----------------------------------------------------------------
                  |Standardized differences          Variance ratio
                  |        Raw    Weighted           Raw   Weighted
  ----------------+------------------------------------------------
               x1 |  -.6027752   -.0090577      1.338962   .9989677
                  |
               x2 |
               1  |  -.1180374    .0096998      .4133173   1.098626
                  |
               x3 |
               1  |  -.1253201    .0022927      .5085817   1.015318
                  |
               x4 |  -.1207472   -.0222549      .9914484   .9947225
               x5 |  -.1944638    .0308855      .8589874   .5917507
               x6 |  -.6542694    .0952268      .4958356   .5601212
               x7 |   .0473848    .0429284      1.160037   1.132231
              x90 |   .1499304    .0130255      .9289414   .8182649
              x91 |  -.0833726   -.0288848      .8791918   .9584288
              x92 |   .0662245    .0110605      1.090179   1.139468
              x93 |   .0479737   -.0087695      .8926169   .9659809
              x94 |  -.1521926    .0562648      .8686432   .7583723
              x95 |  -.0155155     .017858      .8285405   .8879817
  -----------------------------------------------------------------

. tebalance summarize, baseline

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        247.8
                          Control obs   =          408        252.2
                          -----------------------------------------

  -----------------------------------------------------------------
                  |           Means                  Variances     
                  |    Control     Treated       Control    Treated
  ----------------+------------------------------------------------
               x1 |        .75    .4673913      .1879607   .2516722
                  |
               x2 |
               1  |   .0269608    .0108696      .0262984   .0108696
                  |
               x3 |
               1  |   .0441176    .0217391      .0422749   .0215002
                  |
               x4 |    .495098    .4347826      .2505902   .2484472
               x5 |   26.56863    25.46739      34.50142   29.63629
               x6 |   13.15931    11.86957      5.195687   2.576206
               x7 |   6.696078    6.858696      10.90495   12.65014
              x90 |   -.048508    .0972024      .9792937   .9097065
              x91 |  -.0077434   -.0890157      1.011341   .8891627
              x92 |  -.0227801    .0453787      1.013567    1.10497
              x93 |   .0403853    .0865687      .9793358   .8741716
              x94 |   .0160559   -.1299173      .9846065   .8552718
              x95 |  -.0658282   -.0807251      1.008285   .8354051
  -----------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet ipw treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888   -1.628789297   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406   -.1331181675    .1277525862
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      1.04     .0533        .1      .213      .348      .647      1.27      2.38      4.62      9.29
         |       408         1      1.04     .0533        .1      .213      .348      .647      1.27      2.38      4.62      9.29
         |       408      .164      .121     .0121     .0225     .0467     .0739      .129      .226      .354      .515      .681
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .272      .142     .0407     .0407      .119      .153      .264      .383      .444      .721      .721
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .941     .0533      .112      .231      .403      .811      1.02      2.04      4.56      9.29
         |       500         1      .941     .0533      .112      .231      .403      .811      1.02      2.04      4.56      9.29
         |       500      .184      .132     .0121      .025     .0493     .0845      .145      .258       .39      .579      .721
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.207512
        1.x2 |  -1.628789
        1.x3 |  -.5805312
          x4 |  -.2831152
          x5 |   .0545179
          x6 |  -.2844592
          x7 |   .0238709
         x90 |   .1439493
         x91 |  -.1331182
         x92 |   .1277526
         x93 |   .0623585
         x94 |  -.1663353
         x95 |   .0177759
       _cons |   1.379537
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet ipw averagevariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888   -1.628789297   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406   -.1331181675    .1277525862
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      1.04     .0533        .1      .213      .348      .647      1.27      2.38      4.62      9.29
         |       408         1      1.04     .0533        .1      .213      .348      .647      1.27      2.38      4.62      9.29
         |       408      .164      .121     .0121     .0225     .0467     .0739      .129      .226      .354      .515      .681
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .272      .142     .0407     .0407      .119      .153      .264      .383      .444      .721      .721
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .941     .0533      .112      .231      .403      .811      1.02      2.04      4.56      9.29
         |       500         1      .941     .0533      .112      .231      .403      .811      1.02      2.04      4.56      9.29
         |       500      .184      .132     .0121      .025     .0493     .0845      .145      .258       .39      .579      .721
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.207512
        1.x2 |  -1.628789
        1.x3 |  -.5805312
          x4 |  -.2831152
          x5 |   .0545179
          x6 |  -.2844592
          x7 |   .0238709
         x90 |   .1439493
         x91 |  -.1331182
         x92 |   .1277526
         x93 |   .0623585
         x94 |  -.1663353
         x95 |   .0177759
       _cons |   1.379537
------------------------------------------------------------------------------

. teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , ate aequations

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  1.612e-25  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATE                     |
                  treat |
(Treated vs Untreated)  |   -328.878   82.21905    -4.00   0.000    -490.0244   -167.7316
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3452.527   28.58753   120.77   0.000     3396.497    3508.558
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.207512   .3268258    -3.69   0.000    -1.848079   -.5669452
                        |
                     x2 |
                     1  |  -1.628792   1.054719    -1.54   0.123    -3.696005    .4384199
                        |
                     x3 |
                     1  |  -.5805318   .8259794    -0.70   0.482    -2.199422    1.038358
                     x4 |  -.2831153   .2838113    -1.00   0.318    -.8393752    .2731445
                     x5 |   .0545179   .0270259     2.02   0.044     .0015481    .1074878
                     x6 |  -.2844593   .0688093    -4.13   0.000     -.419323   -.1495955
                     x7 |    .023871   .0390129     0.61   0.541    -.0525929    .1003349
                    x90 |   .1439494   .1292697     1.11   0.265    -.1094145    .3973133
                    x91 |  -.1331182   .1248073    -1.07   0.286    -.3777361    .1114997
                    x92 |   .1277527    .133834     0.95   0.340    -.1345572    .3900625
                    x93 |   .0623585   .1243317     0.50   0.616    -.1813271    .3060441
                    x94 |  -.1663354   .1194682    -1.39   0.164    -.4004887    .0678179
                    x95 |    .017776   .1254901     0.14   0.887    -.2281801     .263732
                  _cons |   1.379538   .9297905     1.48   0.138    -.4428177    3.201894
-----------------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , ate ipw treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888   -1.628789297   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406   -.1331181675    .1277525862
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .194      .823      .832      .853      .878      .934      1.05      1.26      1.68      2.55
         |       408         1      .194      .823      .832      .853      .878      .934      1.05      1.26      1.68      2.55
         |       408      .164      .121     .0121     .0225     .0467     .0739      .129      .226      .354      .515      .681
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1      .665      .277      .277      .449      .521      .754       1.3      1.68       4.9       4.9
         |        92         1      .665      .277      .277      .449      .521      .754       1.3      1.68       4.9       4.9
         |        92      .272      .142     .0407     .0407      .119      .153      .264      .383      .444      .721      .721
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .334      .277      .414      .818      .867       .93      1.07      1.35      2.21       4.9
         |       500         1      .334      .277      .414      .818      .867       .93      1.07      1.35      2.21       4.9
         |       500      .184      .132     .0121      .025     .0493     .0845      .145      .258       .39      .579      .721
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.207512
        1.x2 |  -1.628789
        1.x3 |  -.5805312
          x4 |  -.2831152
          x5 |   .0545179
          x6 |  -.2844592
          x7 |   .0238709
         x90 |   .1439493
         x91 |  -.1331182
         x92 |   .1277526
         x93 |   .0623585
         x94 |  -.1663353
         x95 |   .0177759
       _cons |   1.379537
------------------------------------------------------------------------------

. teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , atet aequations tlevel(0) control(1)

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  3.813e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Untreated vs Treated)  |     319.07   91.15096     3.50   0.000     140.4174    497.7225
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
               Treated  |   3141.406   87.28586    35.99   0.000     2970.328    3312.483
------------------------+----------------------------------------------------------------
TME0                    |
                     x1 |   1.207512   .3268258     3.69   0.000     .5669452    1.848079
                        |
                     x2 |
                     1  |   1.628792   1.054719     1.54   0.123    -.4384199    3.696005
                        |
                     x3 |
                     1  |   .5805318   .8259794     0.70   0.482    -1.038358    2.199422
                     x4 |   .2831153   .2838113     1.00   0.318    -.2731445    .8393752
                     x5 |  -.0545179   .0270259    -2.02   0.044    -.1074878   -.0015481
                     x6 |   .2844593   .0688093     4.13   0.000     .1495955     .419323
                     x7 |   -.023871   .0390129    -0.61   0.541    -.1003349    .0525929
                    x90 |  -.1439494   .1292697    -1.11   0.265    -.3973133    .1094145
                    x91 |   .1331182   .1248073     1.07   0.286    -.1114997    .3777361
                    x92 |  -.1277527    .133834    -0.95   0.340    -.3900625    .1345572
                    x93 |  -.0623585   .1243317    -0.50   0.616    -.3060441    .1813271
                    x94 |   .1663354   .1194682     1.39   0.164    -.0678179    .4004887
                    x95 |   -.017776   .1254901    -0.14   0.887     -.263732    .2281801
                  _cons |  -1.379538   .9297905    -1.48   0.138    -3.201894    .4428177
-----------------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , ateu ipw treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888   -1.628789297   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406   -.1331181675    .1277525862
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1         0         1         1         1         1         1         1         1         1         1
         |       408         1         0         1         1         1         1         1         1         1         1         1
         |       408      .164      .121     .0121     .0225     .0467     .0739      .129      .226      .354      .515      .681
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1       .83     .0964     .0964      .312      .402      .693      1.38      1.85      5.87      5.87
         |        92         1       .83     .0964     .0964      .312      .402      .693      1.38      1.85      5.87      5.87
         |        92      .272      .142     .0407     .0407      .119      .153      .264      .383      .444      .721      .721
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .355     .0964      .268      .804         1         1         1         1      2.29      5.87
         |       500         1      .355     .0964      .268      .804         1         1         1         1      2.29      5.87
         |       500      .184      .132     .0121      .025     .0493     .0845      .145      .258       .39      .579      .721
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.207512
        1.x2 |  -1.628789
        1.x3 |  -.5805312
          x4 |  -.2831152
          x5 |   .0545179
          x6 |  -.2844592
          x7 |   .0238709
         x90 |   .1439493
         x91 |  -.1331182
         x92 |   .1277526
         x93 |   .0623585
         x94 |  -.1663353
         x95 |   .0177759
       _cons |   1.379537
------------------------------------------------------------------------------

. 
. // tradeoff between CBPS-like balance and variance in weights
. gmatch `treatvar' `varlist' if `tousevar' , atet cbps treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  7.881e-09  
Iteration 1:   f(p) =  7.799e-09  (backed up)
Iteration 2:   f(p) =  7.301e-09  
Iteration 3:   f(p) =  5.045e-09  
Iteration 4:   f(p) =  4.162e-09  
Iteration 5:   f(p) =  3.700e-09  
Iteration 6:   f(p) =  3.063e-09  
Iteration 7:   f(p) =  2.655e-09  
Iteration 8:   f(p) =  2.353e-09  
Iteration 9:   f(p) =  2.232e-09  
Iteration 10:  f(p) =  1.928e-09  
Iteration 11:  f(p) =  1.687e-09  
(switching technique to nr)
Iteration 12:  f(p) =  1.155e-09  
Iteration 13:  f(p) =  8.181e-12  
Iteration 14:  f(p) =  4.655e-16  
Iteration 15:  f(p) =  2.607e-24  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.339291  |
   2 |      i1.x2   -1.525175  |
   3 |      i1.x3   -.5996277  |
   4 |         x4   -.3183658  |
   5 |         x5    .0587883  |
   6 |         x6   -.2435676  |
   7 |         x7    .0341034  |
   8 |        x90     .158599  |
   9 |        x91   -.1617619  |
  10 |        x92    .1391156  |
  11 |        x93    .0571151  |
  12 |        x94   -.1175052  |
  13 |        x95     .011505  |
  14 |      _cons     .782858  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  2.60710e-24
  balance table after matching (cbps_port_stata):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4673913    -1.38e-10    -2.76e-10     .5016695     1.008511  |
   3 |       i1.x2     .0108696     .0108696    -7.66e-11    -7.34e-10     .1042572     1.008511  |
   4 |       i1.x3     .0217391     .0217391    -8.17e-11    -5.57e-10     .1466296     1.008511  |
   5 |          x4     .4347826     .4347826    -4.03e-10    -8.08e-10     .4984448     1.008511  |
   6 |          x5     25.46739     25.46739    -1.76e-09    -3.24e-10     5.443922     .6195799  |
   7 |          x6     11.86957     11.86957    -1.98e-09    -1.23e-09     1.605057     .5669465  |
   8 |          x7     6.858696     6.858696    -1.77e-10    -4.99e-11     3.556704     1.145237  |
   9 |         x90     .0972024     .0972024     4.54e-11     4.76e-11     .9537854      .845302  |
  10 |         x91    -.0890157    -.0890157    -3.25e-11    -3.45e-11     .9429542     .9654928  |
  11 |         x92     .0453787     .0453787     4.05e-11     3.85e-11     1.051175     1.136731  |
  12 |         x93     .0865687     .0865687    -6.32e-11    -6.76e-11     .9349714     .9577067  |
  13 |         x94    -.1299173    -.1299173     5.29e-10     5.72e-10     .9248091     .7795321  |
  14 |         x95    -.0807251    -.0807251     8.07e-11     8.83e-11      .914005     .8888006  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2605.10307
  cv of matching weights (cbps_port_stata):
  .9884371288
  sd of matching weights (cbps_port_stata):
  .9884371288
  skewness of matching weights (cbps_port_stata):
  .1100078305
  kurtosis of matching weights (cbps_port_stata):
  .0225364399
  this.mean_sd_sq(denominator)
  6.60012e-20
  this.mean_asd(denominator)
  3.71686e-10
  this.max_asd(denominator)
  1.23414e-09
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .988     .0568      .125      .226      .376      .636      1.25      2.36      4.58      7.03
         |       408         1      .988     .0568      .125      .226      .376      .636      1.25      2.36      4.58      7.03
         |       408      .163      .117     .0127     .0273     .0486     .0782      .125       .22      .347      .508      .613
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .273      .149     .0434     .0434      .108      .138      .264      .383      .459      .687      .687
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .893     .0568      .126      .247      .433      .808      1.05      2.06      4.53      7.03
         |       500         1      .893     .0568      .126      .247      .433      .808      1.05      2.06      4.53      7.03
         |       500      .183      .131     .0127     .0276     .0522     .0876      .141      .256      .389      .587      .687
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.339291
        1.x2 |  -1.525175
        1.x3 |  -.5996277
          x4 |  -.3183658
          x5 |   .0587883
          x6 |  -.2435676
          x7 |   .0341034
         x90 |    .158599
         x91 |  -.1617619
         x92 |   .1391156
         x93 |   .0571151
         x94 |  -.1175052
         x95 |    .011505
       _cons |    .782858
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet cbps treatvariance cvopt(1 .75 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00061284  
Iteration 1:   f(p) =  2.181e-07  
Iteration 2:   f(p) =  1.269e-07  
Iteration 3:   f(p) =  1.206e-07  
Iteration 4:   f(p) =  1.176e-07  
Iteration 5:   f(p) =  1.171e-07  
Iteration 6:   f(p) =  1.170e-07  
Iteration 7:   f(p) =  1.161e-07  
Iteration 8:   f(p) =  8.930e-08  
Iteration 9:   f(p) =  8.347e-08  
Iteration 10:  f(p) =  8.293e-08  
Iteration 11:  f(p) =  8.282e-08  
(switching technique to nr)
Iteration 12:  f(p) =  8.217e-08  (not concave)
Iteration 13:  f(p) =  6.170e-08  (not concave)
Iteration 14:  f(p) =  4.531e-08  (not concave)
Iteration 15:  f(p) =  3.155e-08  (not concave)
Iteration 16:  f(p) =  2.949e-08  (not concave)
Iteration 17:  f(p) =  2.389e-08  
Iteration 18:  f(p) =  1.733e-08  
Iteration 19:  f(p) =  1.234e-08  
Iteration 20:  f(p) =  1.147e-08  
Iteration 21:  f(p) =  1.143e-08  
Iteration 22:  f(p) =  1.143e-08  
Iteration 23:  f(p) =  1.143e-08  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.069921  |
   2 |      i1.x2   -1.301676  |
   3 |      i1.x3   -.4865722  |
   4 |         x4   -.2463173  |
   5 |         x5    .0447741  |
   6 |         x6   -.1995635  |
   7 |         x7    .0257331  |
   8 |        x90    .1236242  |
   9 |        x91   -.1270511  |
  10 |        x92    .1015911  |
  11 |        x93    .0470551  |
  12 |        x94   -.0948948  |
  13 |        x95    .0008498  |
  14 |      _cons    .4556063  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  1.14344e-08
  balance table after matching (cbps_port_stata):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5182506    -.0508593    -.1013802     .5016695     1.005561  |
   3 |       i1.x2     .0108696      .012455    -.0015855    -.0152072     .1042572     .8815459  |
   4 |       i1.x3     .0217391     .0242826    -.0025435    -.0173465     .1466296     .9052271  |
   5 |          x4     .4347826     .4521396    -.0173569    -.0348222     .4984448      1.00052  |
   6 |          x5     25.46739     25.54157    -.0741743    -.0136252     5.443922     .6518318  |
   7 |          x6     11.86957     12.06656    -.1969953    -.1227342     1.605057     .5447873  |
   8 |          x7     6.858696     6.811629      .047067     .0132333     3.556704     1.145782  |
   9 |         x90     .0972024     .0715906     .0256118     .0268528     .9537854     .8605673  |
  10 |         x91    -.0890157    -.0737238    -.0152918    -.0162169     .9429542     .9393008  |
  11 |         x92     .0453787     .0269169     .0184618      .017563     1.051175     1.126957  |
  12 |         x93     .0865687     .0765419     .0100267     .0107241     .9349714     .9352735  |
  13 |         x94    -.1299173    -.0967909    -.0331264    -.0358197     .9248091      .797834  |
  14 |         x95    -.0807251    -.0889146     .0081896     .0089601      .914005     .8763149  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2554.903768
  cv of matching weights (cbps_port_stata):
  .7780723044
  sd of matching weights (cbps_port_stata):
  .7780723044
  skewness of matching weights (cbps_port_stata):
  .0867263921
  kurtosis of matching weights (cbps_port_stata):
  .0156197343
  this.mean_sd_sq(denominator)
  .0004633049
  this.mean_asd(denominator)
  .033421951
  this.max_asd(denominator)
  .1227341892
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .778     .0982      .186      .326      .484      .726      1.27      2.16      3.56         5
         |       408         1      .778     .0982      .186      .326      .484      .726      1.27      2.16      3.56         5
         |       408      .163     .0963     .0205     .0382     .0651     .0937      .134      .213      .316      .432      .516
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .252      .117     .0584     .0584      .123      .148      .246      .342      .394      .585      .585
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .703     .0982      .194      .341      .532      .903      1.07      1.93      3.51         5
         |       500         1      .703     .0982      .194      .341      .532      .903      1.07      1.93      3.51         5
         |       500      .179      .106     .0205     .0398     .0673        .1      .148       .24      .344      .498      .585
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS + 1*abs(CV-.75)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.069921
        1.x2 |  -1.301676
        1.x3 |  -.4865722
          x4 |  -.2463173
          x5 |   .0447741
          x6 |  -.1995635
          x7 |   .0257331
         x90 |   .1236242
         x91 |  -.1270511
         x92 |   .1015911
         x93 |   .0470551
         x94 |  -.0948948
         x95 |   .0008498
       _cons |   .4556063
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet cbps treatvariance cvopt(1 .50 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .02519573  
Iteration 1:   f(p) =  .00037232  
Iteration 2:   f(p) =  .00018115  
Iteration 3:   f(p) =  .00007047  
Iteration 4:   f(p) =  .00006335  
Iteration 5:   f(p) =  .00005995  
Iteration 6:   f(p) =  .00003158  
Iteration 7:   f(p) =  .00001706  
Iteration 8:   f(p) =  .00001448  
Iteration 9:   f(p) =  .00001017  
Iteration 10:  f(p) =  9.753e-06  
Iteration 11:  f(p) =  9.539e-06  
(switching technique to nr)
Iteration 12:  f(p) =  9.503e-06  (not concave)
Iteration 13:  f(p) =  5.050e-06  (not concave)
Iteration 14:  f(p) =  1.640e-06  (not concave)
Iteration 15:  f(p) =  8.277e-07  (not concave)
Iteration 16:  f(p) =  1.184e-07  (not concave)
Iteration 17:  f(p) =  1.058e-07  (not concave)
Iteration 18:  f(p) =  8.792e-08  (not concave)
Iteration 19:  f(p) =  6.713e-08  
Iteration 20:  f(p) =  6.430e-08  (not concave)
Iteration 21:  f(p) =  5.229e-08  
Iteration 22:  f(p) =  5.138e-08  
Iteration 23:  f(p) =  5.134e-08  
(switching technique to bfgs)
Iteration 24:  f(p) =  5.114e-08  
Iteration 25:  f(p) =  5.114e-08  
Iteration 26:  f(p) =  5.114e-08  
Iteration 27:  f(p) =  5.114e-08  
Iteration 28:  f(p) =  5.114e-08  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -.7224138  |
   2 |      i1.x2   -.9764887  |
   3 |      i1.x3   -.3663548  |
   4 |         x4    -.168158  |
   5 |         x5    .0290492  |
   6 |         x6   -.1459132  |
   7 |         x7    .0167638  |
   8 |        x90    .0854738  |
   9 |        x91   -.0882829  |
  10 |        x92    .0659837  |
  11 |        x93    .0343202  |
  12 |        x94   -.0658758  |
  13 |        x95   -.0067123  |
  14 |      _cons   -.0849365  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  5.11366e-08
  balance table after matching (cbps_port_stata):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5906749    -.1232836    -.2457468     .5016695     1.038371  |
   3 |       i1.x2     .0108696     .0149903    -.0041207    -.0395243     .1042572     .7343394  |
   4 |       i1.x3     .0217391     .0280491      -.00631    -.0430336     .1466296     .7867085  |
   5 |          x4     .4347826      .466862    -.0320794    -.0643589     .4984448     .9957268  |
   6 |          x5     25.46739     25.77278    -.3053876     -.056097     5.443922     .6996665  |
   7 |          x6     11.86957     12.34747    -.4779045    -.2977493     1.605057     .5220231  |
   8 |          x7     6.858696     6.764909     .0937868      .026369     3.556704     1.148402  |
   9 |         x90     .0972024     .0379817     .0592207     .0620902     .9537854     .8843597  |
  10 |         x91    -.0890157    -.0569168    -.0320989    -.0340408     .9429542      .911345  |
  11 |         x92     .0453787      .011174     .0342046     .0325394     1.051175     1.115674  |
  12 |         x93     .0865687     .0661146     .0204541     .0218767     .9349714     .9136066  |
  13 |         x94    -.1299173    -.0574348    -.0724824    -.0783756     .9248091     .8189414  |
  14 |         x95    -.0807251    -.0931508     .0124257     .0135947      .914005     .8623481  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2504.5033
  cv of matching weights (cbps_port_stata):
  .5321354845
  sd of matching weights (cbps_port_stata):
  .5321354845
  skewness of matching weights (cbps_port_stata):
  .062927843
  kurtosis of matching weights (cbps_port_stata):
  .0108020119
  this.mean_sd_sq(denominator)
  .0029197911
  this.mean_asd(denominator)
  .0781074082
  this.max_asd(denominator)
  .2977493254
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .532      .195      .322      .466      .622      .841      1.25      1.82      2.59      3.27
         |       408         1      .532      .195      .322      .466      .622      .841      1.25      1.82      2.59      3.27
         |       408      .153     .0657     .0355     .0574     .0809      .105      .137      .191      .256      .329      .382
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .213     .0737     .0763     .0763      .132      .149      .213      .269      .301      .429      .429
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .481      .195      .328      .492      .675      .991      1.11      1.68      2.57      3.27
         |       500         1      .481      .195      .328      .492      .675      .991      1.11      1.68      2.57      3.27
         |       500      .164     .0711     .0355     .0584     .0847      .112      .148      .205      .274      .369      .429
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS + 1*abs(CV-.5)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -.7224138
        1.x2 |  -.9764887
        1.x3 |  -.3663548
          x4 |   -.168158
          x5 |   .0290492
          x6 |  -.1459132
          x7 |   .0167638
         x90 |   .0854738
         x91 |  -.0882829
         x92 |   .0659837
         x93 |   .0343202
         x94 |  -.0658758
         x95 |  -.0067123
       _cons |  -.0849365
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet mean_sd_sq treatvariance cvopt(1 .75 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00093921  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00042753  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00003686  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00002767  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00001518  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  6.684e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  3.117e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  1.306e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  3.889e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  1.977e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  7.502e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  5.838e-08  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  4.674e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  4.385e-08  (not concave)
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.169707  |
   2 |      i1.x2   -1.627965  |
   3 |      i1.x3    -.580193  |
   4 |         x4   -.2667316  |
   5 |         x5      .00093  |
   6 |         x6    -.084199  |
   7 |         x7    -.012288  |
   8 |        x90    .1101824  |
   9 |        x91   -.1318251  |
  10 |        x92     .102793  |
  11 |        x93    .0292863  |
  12 |        x94   -.1183492  |
  13 |        x95    .0107489  |
  14 |      _cons    1.404818  |
     +-------------------------+
  Balance after CBPS (mean_sd_sq):
  optimize_result_value(S)
  4.38502e-08
  balance table after matching (mean_sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4636655     .0037258     .0074267     .5016695     1.009553  |
   3 |       i1.x2     .0108696     .0091688     .0017008     .0163135     .1042572     1.193537  |
   4 |       i1.x3     .0217391     .0193982     .0023409     .0159647     .1466296     1.127516  |
   5 |          x4     .4347826     .5028705    -.0680879    -.1366006     .4984448     .9913857  |
   6 |          x5     25.46739     24.33974     1.127651     .2071394     5.443922      .756809  |
   7 |          x6     11.86957     12.24397    -.3744095    -.2332687     1.605057     .5355518  |
   8 |          x7     6.858696     6.388786     .4699092     .1321193     3.556704     1.139287  |
   9 |         x90     .0972024     .1170389    -.0198364    -.0207976     .9537854     .8363061  |
  10 |         x91    -.0890157    -.0852899    -.0037257    -.0039511     .9429542     .9332198  |
  11 |         x92     .0453787     .0526538    -.0072751     -.006921     1.051175     1.110548  |
  12 |         x93     .0865687     .0602509     .0263178     .0281482     .9349714     .9496523  |
  13 |         x94    -.1299173    -.1306693     .0007521     .0008132     .9248091     .8386995  |
  14 |         x95    -.0807251     -.075398     -.005327    -.0058282      .914005     .8746094  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (mean_sd_sq):
  2559.207294
  cv of matching weights (mean_sd_sq):
  .8089600201
  sd of matching weights (mean_sd_sq):
  .8089600201
  skewness of matching weights (mean_sd_sq):
  .0881944961
  kurtosis of matching weights (mean_sd_sq):
  .0143938379
  this.mean_sd_sq(denominator)
  1.84090e-09
  this.mean_asd(denominator)
  .0627147941
  this.max_asd(denominator)
  .2332687373
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .809      .119      .225      .387      .492      .672      1.08       2.3      3.44         5
         |       408         1      .809      .119      .225      .387      .492      .672      1.08       2.3      3.44         5
         |       408      .315      .143     .0614       .11      .175      .213      .269      .373      .558      .654      .733
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .432      .152      .142      .142      .251      .281      .427      .573      .614      .694      .694
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .731      .119      .238      .408      .537      .778         1      2.09      3.41         5
         |       500         1      .731      .119      .238      .408      .537      .778         1      2.09      3.41         5
         |       500      .336      .151     .0614      .115      .182      .224      .282      .467      .581      .688      .733
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = mean(stddiff())^2 + 1*abs(CV-.75)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.169707
        1.x2 |  -1.627965
        1.x3 |   -.580193
          x4 |  -.2667316
          x5 |     .00093
          x6 |   -.084199
          x7 |   -.012288
         x90 |   .1101824
         x91 |  -.1318251
         x92 |    .102793
         x93 |   .0292863
         x94 |  -.1183492
         x95 |   .0107489
       _cons |   1.404818
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet mean_sd_sq treatvariance cvopt(1 .50 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =   .0255221  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00707055  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00121893  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00077435  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00038439  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00027065  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00020657  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00014905  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00004814  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00002729  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00002254  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00001783  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00001699  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  .00001033  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  7.210e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  3.223e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  2.672e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  1.259e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  1.089e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  1.059e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  6.598e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  5.851e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  5.704e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  2.666e-07  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  2.621e-07  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -.8824632  |
   2 |      i1.x2   -2.564508  |
   3 |      i1.x3   -.1876487  |
   4 |         x4   -.1072799  |
   5 |         x5    .0144915  |
   6 |         x6   -.0401028  |
   7 |         x7   -.0328468  |
   8 |        x90   -.0893701  |
   9 |        x91     -.15651  |
  10 |        x92   -.1346063  |
  11 |        x93   -.1007194  |
  12 |        x94   -.1207242  |
  13 |        x95   -.1326203  |
  14 |      _cons    1.419705  |
     +-------------------------+
  Balance after CBPS (mean_sd_sq):
  optimize_result_value(S)
  2.62127e-07
  balance table after matching (mean_sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5844559    -.1170646    -.2333501     .5016695     1.033715  |
   3 |       i1.x2     .0108696     .0034975     .0073721     .0707107     .1042572     3.111105  |
   4 |       i1.x3     .0217391     .0254154    -.0036762    -.0250716     .1466296     .8658875  |
   5 |          x4     .4347826     .5066966     -.071914    -.1442768     .4984448     .9915309  |
   6 |          x5     25.46739      25.5818    -.1144052    -.0210152     5.443922     .7481279  |
   7 |          x6     11.86957     12.62414    -.7545699    -.4701205     1.605057     .4987375  |
   8 |          x7     6.858696     6.327533     .5311628     .1493413     3.556704     1.128347  |
   9 |         x90     .0972024    -.1028475       .20005     .2097432     .9537854     .8836741  |
  10 |         x91    -.0890157    -.1202121     .0311964     .0330837     .9429542     .9470659  |
  11 |         x92     .0453787    -.1493203      .194699     .1852202     1.051175     1.095645  |
  12 |         x93     .0865687    -.0577474     .1443161     .1543535     .9349714     .8542852  |
  13 |         x94    -.1299173    -.1200942     -.009823    -.0106217     .9248091     .8263152  |
  14 |         x95    -.0807251    -.1738245     .0930994     .1018588      .914005     .8626109  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (mean_sd_sq):
  2513.326312
  cv of matching weights (mean_sd_sq):
  .5799928361
  sd of matching weights (mean_sd_sq):
  .5799928361
  skewness of matching weights (mean_sd_sq):
  .077236408
  kurtosis of matching weights (mean_sd_sq):
  .0147167682
  this.mean_sd_sq(denominator)
  1.23688e-10
  this.mean_asd(denominator)
  .1391359431
  this.max_asd(denominator)
  .4701204636
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1       .58     .0454      .105      .467      .621      .837      1.23      1.81      3.03      3.59
         |       408         1       .58     .0454      .105      .467      .621      .837      1.23      1.81      3.03      3.59
         |       408      .566       .13     .0656       .14      .419       .49      .564      .654      .737      .824      .847
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92       .64      .126      .153      .153      .478      .558       .64      .741      .795       .88       .88
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .524     .0454      .116      .504      .681      .961       1.1      1.65      2.99      3.59
         |       500         1      .524     .0454      .116      .504      .681      .961       1.1      1.65      2.99      3.59
         |       500       .58      .132     .0656      .147      .431      .499      .575      .671       .75      .836       .88
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = mean(stddiff())^2 + 1*abs(CV-.5)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -.8824632
        1.x2 |  -2.564508
        1.x3 |  -.1876487
          x4 |  -.1072799
          x5 |   .0144915
          x6 |  -.0401028
          x7 |  -.0328468
         x90 |  -.0893701
         x91 |    -.15651
         x92 |  -.1346063
         x93 |  -.1007194
         x94 |  -.1207242
         x95 |  -.1326203
       _cons |   1.419705
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' , atet cbps ipw treatvariance cvopt(1 .75 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs
  92 treatment obs
  (Data are unweighted.)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21588  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00061301  
Iteration 1:   f(p) =  .00010314  
Iteration 2:   f(p) =  .00006546  
Iteration 3:   f(p) =  .00002385  
Iteration 4:   f(p) =  .00001692  
Iteration 5:   f(p) =  .00001277  
Iteration 6:   f(p) =  .00001168  
Iteration 7:   f(p) =  .00001092  
Iteration 8:   f(p) =  8.593e-06  
Iteration 9:   f(p) =  5.346e-06  
Iteration 10:  f(p) =  4.603e-06  
Iteration 11:  f(p) =  4.428e-06  
(switching technique to nr)
Iteration 12:  f(p) =  4.385e-06  (not concave)
Iteration 13:  f(p) =  3.026e-06  (not concave)
Iteration 14:  f(p) =  1.396e-06  (not concave)
Iteration 15:  f(p) =  1.342e-06  (not concave)
Iteration 16:  f(p) =  1.133e-06  (not concave)
Iteration 17:  f(p) =  8.277e-07  (not concave)
Iteration 18:  f(p) =  5.711e-07  (not concave)
Iteration 19:  f(p) =  4.471e-07  (not concave)
Iteration 20:  f(p) =  3.270e-07  (not concave)
Iteration 21:  f(p) =  2.418e-07  (not concave)
Iteration 22:  f(p) =  2.260e-07  (not concave)
Iteration 23:  f(p) =  1.935e-07  
(switching technique to bfgs)
Iteration 24:  f(p) =  1.764e-07  
Iteration 25:  f(p) =  1.717e-07  
Iteration 26:  f(p) =  1.716e-07  
Iteration 27:  f(p) =  1.716e-07  
Iteration 28:  f(p) =  1.716e-07  
Iteration 29:  f(p) =  1.716e-07  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1    -1.05919  |
   2 |      i1.x2   -1.392652  |
   3 |      i1.x3   -.3877011  |
   4 |         x4   -.2597628  |
   5 |         x5    .0455692  |
   6 |         x6   -.2089932  |
   7 |         x7    .0230333  |
   8 |        x90     .127256  |
   9 |        x91    -.121233  |
  10 |        x92    .0972156  |
  11 |        x93    .0481425  |
  12 |        x94   -.1060473  |
  13 |        x95     .010529  |
  14 |      _cons    .6347766  |
     +-------------------------+
  Balance after CBPS (cbps_port_stata):
  optimize_result_value(S)
  1.71556e-07
  balance table after matching (cbps_port_stata):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913      .518763    -.0513717    -.1024016     .5016695     1.005638  |
   3 |       i1.x2     .0108696     .0118444    -.0009748    -.0093503     .1042572       .92642  |
   4 |       i1.x3     .0217391     .0264241    -.0046849    -.0319509     .1466296     .8336962  |
   5 |          x4     .4347826     .4476611    -.0128785    -.0258373     .4984448     1.002336  |
   6 |          x5     25.46739     25.56133     -.093934    -.0172548     5.443922      .646753  |
   7 |          x6     11.86957     12.03336    -.1637987    -.1020517     1.605057     .5461048  |
   8 |          x7     6.858696     6.780638     .0780575     .0219466     3.556704     1.144354  |
   9 |         x90     .0972024     .0722594     .0249431     .0261517     .9537854     .8581527  |
  10 |         x91    -.0890157    -.0683622    -.0206535     -.021903     .9429542     .9389307  |
  11 |         x92     .0453787     .0233068     .0220719     .0209974     1.051175     1.130349  |
  12 |         x93     .0865687     .0787127      .007856     .0084024     .9349714     .9405742  |
  13 |         x94    -.1299173    -.1086978    -.0212195    -.0229447     .9248091     .7927287  |
  14 |         x95    -.0807251    -.0823442     .0016191     .0017714      .914005     .8768564  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_stata):
  2558.082484
  cv of matching weights (cbps_port_stata):
  .7933794224
  sd of matching weights (cbps_port_stata):
  .7933794224
  skewness of matching weights (cbps_port_stata):
  .0906555598
  kurtosis of matching weights (cbps_port_stata):
  .0171323521
  this.mean_sd_sq(denominator)
  .0003830299
  this.mean_asd(denominator)
  .0317664395
  this.max_asd(denominator)
  .1024015526
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408         1      .793     .0894      .182      .316      .465       .72      1.28      2.17      3.54      5.44
         |       408         1      .793     .0894      .182      .316      .465       .72      1.28      2.17      3.54      5.44
         |       408      .171      .101       .02       .04     .0674     .0961      .141      .226      .332      .447      .554
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .265       .12     .0589     .0589       .13      .162       .26      .354       .41      .613      .613
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500         1      .717     .0894      .192      .331      .524      .906      1.07      1.93      3.49      5.44
         |       500         1      .717     .0894      .192      .331      .524      .906      1.07      1.93      3.49      5.44
         |       500      .189      .111       .02     .0421     .0698      .105      .158      .255      .363       .52      .613
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        500
Generalization of IPW/CPBS-type reweigting
Loss = CBPS + 1*abs(CV-.75)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |   -1.05919
        1.x2 |  -1.392652
        1.x3 |  -.3877011
          x4 |  -.2597628
          x5 |   .0455692
          x6 |  -.2089932
          x7 |   .0230333
         x90 |    .127256
         x91 |   -.121233
         x92 |   .0972156
         x93 |   .0481425
         x94 |  -.1060473
         x95 |    .010529
       _cons |   .6347766
------------------------------------------------------------------------------

. 
. 
. // * WEIGHTED DATA EXAMPLES *
. 
. // Replicate CBPS
. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], ate cbps pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00008909  
Iteration 1:   f(p) =  .00006006  
Iteration 2:   f(p) =  .00005798  
Iteration 3:   f(p) =  .00005798  
Iteration 4:   f(p) =  .00005797  
Iteration 5:   f(p) =  .00005722  
Iteration 6:   f(p) =  .00004799  
Iteration 7:   f(p) =  .00002163  
Iteration 8:   f(p) =  .00001682  
Iteration 9:   f(p) =  .00001603  
Iteration 10:  f(p) =  .00001599  
Iteration 11:  f(p) =  .00001599  
(switching technique to nr)
Iteration 12:  f(p) =  .00001598  (not concave)
Iteration 13:  f(p) =  4.571e-06  (not concave)
Iteration 14:  f(p) =  1.592e-06  (not concave)
Iteration 15:  f(p) =  8.516e-07  (not concave)
Iteration 16:  f(p) =  3.286e-07  (not concave)
Iteration 17:  f(p) =  1.745e-07  (not concave)
Iteration 18:  f(p) =  8.936e-08  (not concave)
Iteration 19:  f(p) =  2.836e-08  (not concave)
Iteration 20:  f(p) =  5.115e-09  
Iteration 21:  f(p) =  1.153e-10  
Iteration 22:  f(p) =  1.212e-14  
Iteration 23:  f(p) =  2.740e-25  
(switching technique to bfgs)
Iteration 24:  f(p) =  2.405e-27  
  CBPS beta after undoing the normalization
                1           2
     +-------------------------+
   1 |         x1   -1.502416  |
   2 |      i1.x2   -2.525399  |
   3 |      i1.x3   -.8191009  |
   4 |         x4   -.3236397  |
   5 |         x5    .0771198  |
   6 |         x6   -.4884764  |
   7 |         x7    .0722686  |
   8 |        x90    .0234165  |
   9 |        x91    .0257849  |
  10 |        x92    .2152141  |
  11 |        x93   -.0285372  |
  12 |        x94   -.3393877  |
  13 |        x95   -.0407881  |
  14 |      _cons    3.075437  |
     +-------------------------+
  Balance after CBPS (cbps_port_r):
  optimize_result_value(S)
  2.40498e-27
  balance table after matching (cbps_port_r):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6695182      .6695182      1.44e-15      3.07e-15      .4706262      1.004328  |
   3 |        i1.x2      .0220668      .0220668     -1.88e-14     -1.28e-13      .1469756      1.004328  |
   4 |        i1.x3      .0366911      .0366911     -2.61e-14     -1.39e-13       .188098      1.004328  |
   5 |           x4       .485133       .485133      1.70e-13      3.39e-13      .5000334      1.004328  |
   6 |           x5      26.17889      26.17889      6.18e-13      9.91e-14      6.237853      .6789026  |
   7 |           x6      12.63449      12.63449     -1.58e-12     -6.76e-13      2.338005      .5740656  |
   8 |           x7      6.755243      6.755243     -6.36e-13     -1.89e-13      3.370937      1.187219  |
   9 |          x90     -.0520316     -.0520316      3.49e-14      3.34e-14      1.046128      1.163666  |
  10 |          x91      .0164856      .0164856      7.94e-14      8.18e-14      .9705717      .9930954  |
  11 |          x92     -.0021645     -.0021645     -2.62e-15     -2.58e-15      1.017927      1.359802  |
  12 |          x93      .0456916      .0456916     -2.14e-13     -2.22e-13      .9636159       .883731  |
  13 |          x94     -.0910006     -.0910006     -2.10e-13     -2.07e-13      1.014116      .7859289  |
  14 |          x95     -.0894588     -.0894588      6.18e-13      6.32e-13       .978942      .8236876  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_r):
  2750.417544
  cv of matching weights (cbps_port_r):
  .5270998694
  sd of matching weights (cbps_port_r):
  .5284997369
  skewness of matching weights (cbps_port_r):
  .2026515012
  kurtosis of matching weights (cbps_port_r):
  .0762370775
  this.mean_sd_sq(denominator)
  8.32408e-28
  this.mean_asd(denominator)
  2.11649e-13
  this.max_asd(denominator)
  6.76199e-13
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      .957      .762      .953      1.26      1.49       1.8      2.11       2.8      5.77        13
         |       408      .999      .435       .78      .784      .792      .809      .864      .985      1.32      2.65      6.64
         |       408       .16      .168     .0019    .00635     .0172      .037     .0987      .209      .409      .707      .883
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      1.63      .415      .415      .642      .808      1.35       2.6      3.88      9.17      9.17
         |        92      1.02      .828      .188      .188      .318      .405      .739      1.47      1.96      5.21      5.21
         |        92      .288      .192     .0336     .0336     .0892      .119      .237      .431       .55      .931      .931
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.11      .415      .548      1.06      1.41      1.78      2.17      2.99      6.49        13
         |       500         1      .528      .188      .273      .782      .799      .859      1.05      1.49       2.9      6.64
         |       500      .183       .18     .0019    .00715       .02     .0472      .117      .263      .446      .717      .931
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.502416
        1.x2 |  -2.525399
        1.x3 |  -.8191009
          x4 |  -.3236397
          x5 |   .0771198
          x6 |  -.4884764
          x7 |   .0722686
         x90 |   .0234165
         x91 |   .0257849
         x92 |   .2152141
         x93 |  -.0285372
         x94 |  -.3393877
         x95 |  -.0407881
       _cons |   3.075437
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], ate cbps ipw pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .02296546  
Iteration 1:   f(p) =  .01893921  
Iteration 2:   f(p) =  .01888779  
Iteration 3:   f(p) =  .01864991  
Iteration 4:   f(p) =  .01807801  
Iteration 5:   f(p) =  .01796175  
Iteration 6:   f(p) =  .01796123  
Iteration 7:   f(p) =  .01795278  
Iteration 8:   f(p) =  .01785278  
Iteration 9:   f(p) =   .0178181  
Iteration 10:  f(p) =  .01781755  
Iteration 11:  f(p) =  .01781528  
(switching technique to nr)
Iteration 12:  f(p) =  .01780001  
Iteration 13:  f(p) =  .01777185  
Iteration 14:  f(p) =  .01777184  
Iteration 15:  f(p) =  .01777184  
  CBPS beta after undoing the normalization
                1           2
     +-------------------------+
   1 |         x1   -1.226645  |
   2 |      i1.x2   -1.653762  |
   3 |      i1.x3   -.7776876  |
   4 |         x4   -.3532491  |
   5 |         x5    .0574629  |
   6 |         x6   -.2583005  |
   7 |         x7    .0080439  |
   8 |        x90    .0890276  |
   9 |        x91   -.1706881  |
  10 |        x92    .1765097  |
  11 |        x93    .1136718  |
  12 |        x94   -.1271347  |
  13 |        x95    .0214704  |
  14 |      _cons    1.180155  |
     +-------------------------+
  Balance after CBPS (cbps_port_r):
  optimize_result_value(S)
  .0177718443
  balance table after matching (cbps_port_r):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6415953      .6970127     -.0554173     -.1194311      .4640107      1.093567  |
   3 |        i1.x2      .0142909      .0234703     -.0091794     -.0628462      .1460619      .6172753  |
   4 |        i1.x3      .0334441      .0380925     -.0046484     -.0245369      .1894462      .8860314  |
   5 |           x4      .4881571      .4821182      .0060389      .0120785       .499973       1.00505  |
   6 |           x5      25.72258      26.31855     -.5959644     -.1000426      5.957105      .7659019  |
   7 |           x6      12.33189       12.8994     -.5675068     -.2533225      2.240254      .6135511  |
   8 |           x7      6.911084      6.688832       .222252      .0657612      3.379685      1.211887  |
   9 |          x90     -.0440388     -.0251309      -.018908     -.0185767       1.01783      1.120774  |
  10 |          x91      .0661735     -.0257224      .0918959      .0936219      .9815644      .9753854  |
  11 |          x92     -.0382008     -.0020298     -.0361709     -.0355957      1.016161       1.20721  |
  12 |          x93      .0014101      .0645199     -.0631098     -.0653399      .9658703      .9125525  |
  13 |          x94     -.1442668     -.0285682     -.1156986     -.1166712      .9916637      .8216037  |
  14 |          x95     -.1053626       -.07164     -.0337226     -.0344811      .9780038       .803947  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_r):
  2733.070247
  cv of matching weights (cbps_port_r):
  .3236892358
  sd of matching weights (cbps_port_r):
  .3244154091
  skewness of matching weights (cbps_port_r):
  .1499732973
  kurtosis of matching weights (cbps_port_r):
  .0569705853
  this.mean_sd_sq(denominator)
  .0025726925
  this.mean_asd(denominator)
  .0771004086
  this.max_asd(denominator)
  .2533225075
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      .569      .882      1.05      1.37      1.58       1.9      2.22      2.65      3.75      5.18
         |       408      .999      .194      .816      .827      .851      .879      .934      1.05      1.23      1.66      2.64
         |       408       .17      .119     .0115     .0244     .0519     .0816      .136      .228      .345      .513      .694
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      1.26      .471      .471       .86      1.14      1.52      2.69      3.33      7.65      7.65
         |        92      1.02      .639      .297      .297      .465      .547      .791      1.35      1.75      4.34      4.34
         |        92      .278      .144      .048      .048      .119      .154      .264      .381      .448      .702      .702
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      .744      .471       .68      1.21      1.51      1.87      2.25      2.77      4.93      7.65
         |       500         1      .324      .297      .426      .821      .864      .931      1.07      1.35      2.08      4.34
         |       500       .19      .131     .0115     .0257     .0544     .0922      .151      .268      .394      .595      .702
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.226645
        1.x2 |  -1.653762
        1.x3 |  -.7776876
          x4 |  -.3532491
          x5 |   .0574629
          x6 |  -.2583005
          x7 |   .0080439
         x90 |   .0890276
         x91 |  -.1706881
         x92 |   .1765097
         x93 |   .1136718
         x94 |  -.1271347
         x95 |   .0214704
       _cons |   1.180155
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet cbps pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00001735  
Iteration 1:   f(p) =  6.450e-06  
Iteration 2:   f(p) =  5.892e-06  
Iteration 3:   f(p) =  5.889e-06  
Iteration 4:   f(p) =  5.889e-06  
Iteration 5:   f(p) =  5.884e-06  
Iteration 6:   f(p) =  5.782e-06  
Iteration 7:   f(p) =  1.662e-06  
Iteration 8:   f(p) =  1.352e-06  
Iteration 9:   f(p) =  1.347e-06  
Iteration 10:  f(p) =  1.347e-06  
Iteration 11:  f(p) =  1.347e-06  
(switching technique to nr)
Iteration 12:  f(p) =  1.337e-06  (not concave)
Iteration 13:  f(p) =  8.478e-08  
Iteration 14:  f(p) =  1.602e-08  
Iteration 15:  f(p) =  7.712e-10  
Iteration 16:  f(p) =  5.651e-13  
Iteration 17:  f(p) =  5.938e-20  
Iteration 18:  f(p) =  8.653e-26  
  CBPS beta after undoing the normalization
                1           2
     +-------------------------+
   1 |         x1   -1.447047  |
   2 |      i1.x2   -1.546891  |
   3 |      i1.x3   -.4710623  |
   4 |         x4   -.3822539  |
   5 |         x5    .0635824  |
   6 |         x6    -.243227  |
   7 |         x7    .0477027  |
   8 |        x90    .1334992  |
   9 |        x91   -.1336117  |
  10 |        x92    .1522937  |
  11 |        x93    .0757732  |
  12 |        x94   -.1016171  |
  13 |        x95   -.0383391  |
  14 |      _cons    .6265763  |
     +-------------------------+
  Balance after CBPS (cbps_port_r):
  optimize_result_value(S)
  8.65286e-26
  balance table after matching (cbps_port_r):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4512231      .4512231      2.63e-12      5.28e-12      .4978686      1.004328  |
   3 |        i1.x2      .0114039      .0114039      2.63e-13      2.47e-12      .1062323      1.004328  |
   4 |        i1.x3      .0240637      .0240637      3.94e-13      2.57e-12      .1533251      1.004328  |
   5 |           x4      .4218861      .4218861      7.43e-13      1.50e-12       .494112      1.004328  |
   6 |           x5      25.44699      25.44699      1.28e-11      1.92e-12      6.665558      .6144662  |
   7 |           x6      11.84757      11.84757      1.34e-11      6.54e-12      2.042375      .5982513  |
   8 |           x7      7.015422      7.015422     -1.00e-11     -3.00e-12      3.345323      1.161761  |
   9 |          x90      .0839738      .0839738     -1.05e-14     -1.02e-14        1.0258      .8505325  |
  10 |          x91     -.0648837     -.0648837      3.35e-12      3.56e-12       .941106      .9922891  |
  11 |          x92      .0575388      .0575388     -1.11e-12     -1.12e-12      .9892732      1.118263  |
  12 |          x93      .1016523      .1016523     -1.98e-12     -2.11e-12      .9410813      1.012572  |
  13 |          x94     -.1252265     -.1252265      1.63e-12      1.59e-12      1.026859      .7576623  |
  14 |          x95     -.1044649     -.1044649      6.17e-13      6.40e-13      .9627688      .8646431  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_r):
  2876.289278
  cv of matching weights (cbps_port_r):
  1.031924564
  sd of matching weights (cbps_port_r):
  1.02710789
  skewness of matching weights (cbps_port_r):
  .1135011509
  kurtosis of matching weights (cbps_port_r):
  .0229206639
  this.mean_sd_sq(denominator)
  2.32907e-24
  this.mean_asd(denominator)
  2.48484e-12
  this.max_asd(denominator)
  6.53792e-12
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.14     .0807      .208      .375      .695      1.17      2.44      4.62      9.71      16.8
         |       408      .995      1.03      .043      .118      .207       .36       .61      1.22       2.3      4.75      7.01
         |       408      .161       .12    .00957     .0257     .0444     .0748      .121      .215       .34      .516      .611
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .274      .157     .0464     .0464     .0968      .128      .243       .38       .48      .692      .692
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.94     .0807      .209      .419      .781      1.46      2.33      4.12      9.63      16.8
         |       500      .996      .928      .043      .119      .228      .398      .809      1.04      2.05      4.72      7.01
         |       500      .182      .135    .00957     .0261     .0485     .0816      .134      .247      .392      .597      .692
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.447047
        1.x2 |  -1.546891
        1.x3 |  -.4710623
          x4 |  -.3822539
          x5 |   .0635824
          x6 |   -.243227
          x7 |   .0477027
         x90 |   .1334992
         x91 |  -.1336117
         x92 |   .1522937
         x93 |   .0757732
         x94 |  -.1016171
         x95 |  -.0383391
       _cons |   .6265763
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet cbps ipw pooledvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00053487  
Iteration 1:   f(p) =  .00021848  
Iteration 2:   f(p) =  .00021162  
Iteration 3:   f(p) =  .00021159  
Iteration 4:   f(p) =  .00021001  
Iteration 5:   f(p) =  .00019724  
Iteration 6:   f(p) =   .0001771  
Iteration 7:   f(p) =  .00017502  
Iteration 8:   f(p) =  .00017501  
Iteration 9:   f(p) =  .00017499  
Iteration 10:  f(p) =  .00017465  
Iteration 11:  f(p) =  .00017249  
(switching technique to nr)
Iteration 12:  f(p) =  .00017245  
Iteration 13:  f(p) =  .00017215  
Iteration 14:  f(p) =  .00017215  
Iteration 15:  f(p) =  .00017215  
  CBPS beta after undoing the normalization
                1           2
     +-------------------------+
   1 |         x1   -1.393749  |
   2 |      i1.x2   -1.561041  |
   3 |      i1.x3   -.4600041  |
   4 |         x4   -.3846168  |
   5 |         x5    .0606092  |
   6 |         x6   -.2482012  |
   7 |         x7    .0443349  |
   8 |        x90    .1306488  |
   9 |        x91   -.1205474  |
  10 |        x92    .1453092  |
  11 |        x93     .070476  |
  12 |        x94   -.1075638  |
  13 |        x95   -.0307916  |
  14 |      _cons    .7598453  |
     +-------------------------+
  Balance after CBPS (cbps_port_r):
  optimize_result_value(S)
  .0001721532
  balance table after matching (cbps_port_r):
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4512231      .4553292      -.004106      -.008242       .498186      1.002774  |
   3 |        i1.x2      .0114039      .0111962      .0002076      .0019689      .1054487      1.022737  |
   4 |        i1.x3      .0240637      .0242798     -.0002161     -.0014043      .1538723      .9956099  |
   5 |           x4      .4218861      .4235251      -.001639     -.0033156       .494322      1.003286  |
   6 |           x5      25.44699      25.39436      .0526224      .0078927      6.667188      .6141311  |
   7 |           x6      11.84757      11.82507      .0224988      .0110125      2.043017      .5978372  |
   8 |           x7      7.015422      6.978162        .03726       .011128      3.348319      1.159171  |
   9 |          x90      .0839738      .0816058       .002368      .0023047      1.027479      .8472278  |
  10 |          x91     -.0648837     -.0554765     -.0094072     -.0099831      .9423132      .9892043  |
  11 |          x92      .0575388      .0526517      .0048871      .0049455      .9881782      1.121369  |
  12 |          x93      .1016523        .09771      .0039424      .0041911      .9406607      1.013686  |
  13 |          x94     -.1252265      -.131327      .0061006      .0059387       1.02725      .7569926  |
  14 |          x95     -.1044649     -.1015494     -.0029155     -.0030291      .9625009      .8652191  |
     +---------------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_r):
  2872.573597
  cv of matching weights (cbps_port_r):
  1.019033715
  sd of matching weights (cbps_port_r):
  1.014129106
  skewness of matching weights (cbps_port_r):
  .1128933006
  kurtosis of matching weights (cbps_port_r):
  .0230686436
  this.mean_sd_sq(denominator)
  3.24223e-06
  this.mean_asd(denominator)
  .0057966356
  this.max_asd(denominator)
  .0111279635
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.12     .0834      .213      .379      .703       1.2      2.44       4.6      9.79      16.6
         |       408      .995      1.01     .0445      .124      .212      .364      .618      1.22      2.32      4.57      7.11
         |       408      .161      .119    .00985     .0269     .0454     .0753      .121      .214      .341      .506      .614
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .272      .153     .0459     .0459     .0999      .133      .243      .375      .464      .695      .695
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.92     .0834      .215      .425      .799      1.47      2.33       4.1       9.5      16.6
         |       500      .996      .916     .0445      .124      .228      .404       .82      1.04      2.07      4.54      7.11
         |       500      .181      .133    .00985     .0269     .0484     .0819      .137      .247       .39      .596      .695
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.393749
        1.x2 |  -1.561041
        1.x3 |  -.4600041
          x4 |  -.3846168
          x5 |   .0606092
          x6 |  -.2482012
          x7 |   .0443349
         x90 |   .1306488
         x91 |  -.1205474
         x92 |   .1453092
         x93 |    .070476
         x94 |  -.1075638
         x95 |  -.0307916
       _cons |   .7598453
------------------------------------------------------------------------------

. 
. // Other objective functions
. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet mean_sd_sq treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.29045  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00026309  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00001126  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  4.733e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  1.762e-13  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.298301  |
   2 |      i1.x2    -1.62991  |
   3 |      i1.x3   -.4511738  |
   4 |         x4   -.3553036  |
   5 |         x5    .0715797  |
   6 |         x6   -.2773325  |
   7 |         x7    .0371348  |
   8 |        x90    .1283825  |
   9 |        x91   -.0952385  |
  10 |        x92    .1409152  |
  11 |        x93    .0743039  |
  12 |        x94   -.1419192  |
  13 |        x95   -.0201501  |
  14 |      _cons    1.248956  |
     +-------------------------+
  Balance after CBPS (mean_sd_sq):
  optimize_result_value(S)
  1.76189e-13
  balance table after matching (mean_sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4879803    -.0367571    -.0736613     .4990018     .9953453  |
   3 |       i1.x2     .0114039     .0101189     .0012849      .012068     .1064741     1.130391  |
   4 |       i1.x3     .0240637     .0243904    -.0003267    -.0021259     .1536741     .9912072  |
   5 |          x4     .4218861     .4077079     .0141782     .0286292     .4952368     1.014376  |
   6 |          x5     25.44699     25.93852    -.4915369    -.0906539     5.422129     .5820458  |
   7 |          x6     11.84757     11.77832     .0692544     .0421787     1.641931     .5870661  |
   8 |          x7     7.015422     6.877176     .1382457     .0388829     3.555432     1.150412  |
   9 |         x90     .0839738     .0558968      .028077     .0292556     .9597153     .8505927  |
  10 |         x91    -.0648837    -.0314163    -.0334674    -.0356564       .93861     .9896463  |
  11 |         x92     .0575388     .0508004     .0067383     .0065071      1.03554     1.132825  |
  12 |         x93     .1016523     .1109107    -.0092584     -.009783     .9463749     1.021042  |
  13 |         x94    -.1252265    -.1752569     .0500305     .0546927     .9147554     .7291545  |
  14 |         x95    -.1044649    -.1041672    -.0002977    -.0003283     .9069849     .8690485  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (mean_sd_sq):
  2884.454316
  cv of matching weights (mean_sd_sq):
  1.067016337
  sd of matching weights (mean_sd_sq):
  1.064358243
  skewness of matching weights (mean_sd_sq):
  .1583883422
  kurtosis of matching weights (mean_sd_sq):
  .0509006234
  this.mean_sd_sq(denominator)
  1.76189e-13
  this.mean_asd(denominator)
  .0326479167
  this.max_asd(denominator)
  .0906538643
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.18     .0766      .195      .376      .696      1.22      2.44      4.57      9.98      20.7
         |       408      .998      1.06     .0408      .117      .208       .36       .63      1.18      2.31      4.35      10.6
         |       408       .22      .145     .0139     .0389     .0671      .111      .179      .289      .444      .601      .786
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .351      .168      .068      .068      .152      .203      .322      .485      .552       .79       .79
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.98     .0766      .203      .418      .776       1.5      2.35      4.17      9.35      20.7
         |       500      .998      .961     .0408      .117      .226      .402      .852      1.07      1.96      4.35      10.6
         |       500      .244      .158     .0139      .039     .0719      .119      .203      .332      .494      .685       .79
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = mean(stddiff())^2
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.298301
        1.x2 |   -1.62991
        1.x3 |  -.4511738
          x4 |  -.3553036
          x5 |   .0715797
          x6 |  -.2773325
          x7 |   .0371348
         x90 |   .1283825
         x91 |  -.0952385
         x92 |   .1409152
         x93 |   .0743039
         x94 |  -.1419192
         x95 |  -.0201501
       _cons |   1.248956
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet sd_sq treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.29045  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .01944489  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .01784035  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01032757  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00864462  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00309574  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00232235  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00091852  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00071553  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00032888  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00013226  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00006152  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00004718  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00002689  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  .00002208  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  .00002167  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  .00001909  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  .00001789  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  .00001648  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  .00001642  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  .00001107  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  9.799e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  9.140e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  8.255e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  5.364e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  4.308e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  4.225e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  3.639e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  3.476e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  3.375e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  3.283e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  3.274e-06  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.448267  |
   2 |      i1.x2   -1.565342  |
   3 |      i1.x3   -.4664383  |
   4 |         x4   -.3840641  |
   5 |         x5    .0635287  |
   6 |         x6   -.2430673  |
   7 |         x7    .0477054  |
   8 |        x90    .1333153  |
   9 |        x91   -.1334921  |
  10 |        x92    .1520502  |
  11 |        x93    .0756012  |
  12 |        x94   -.1015022  |
  13 |        x95   -.0391333  |
  14 |      _cons      1.3916  |
     +-------------------------+
  Balance after CBPS (sd_sq):
  optimize_result_value(S)
  3.27406e-06
  balance table after matching (sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4511035     .0001196     .0002398     .4990018     1.004375  |
   3 |       i1.x2     .0114039     .0112293     .0001746     .0016398     .1064741     1.019764  |
   4 |       i1.x3     .0240637     .0240848    -.0000211    -.0001373     .1536741      1.00347  |
   5 |          x4     .4218861     .4216434     .0002427     .0004901     .4952368     1.004484  |
   6 |          x5     25.44699     25.44639     .0005986     .0001104     5.422129     .6145825  |
   7 |          x6     11.84757     11.84769    -.0001229    -.0000748     1.641931     .5983502  |
   8 |          x7     7.015422     7.015471     -.000049    -.0000138     3.555432     1.161615  |
   9 |         x90     .0839738     .0838468     .0001271     .0001324     .9597153      .850452  |
  10 |         x91    -.0648837    -.0648426    -.0000411    -.0000438       .93861     .9923018  |
  11 |         x92     .0575388     .0574363     .0001025     .0000989      1.03554     1.118291  |
  12 |         x93     .1016523     .1015954     .0000569     .0000601     .9463749     1.012463  |
  13 |         x94    -.1252265    -.1251737    -.0000528    -.0000577     .9147554     .7576589  |
  14 |         x95    -.1044649    -.1048848     .0004199     .0004629     .9069849     .8645414  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (sd_sq):
  2876.454222
  cv of matching weights (sd_sq):
  1.032542433
  sd of matching weights (sd_sq):
  1.027719636
  skewness of matching weights (sd_sq):
  .1134621492
  kurtosis of matching weights (sd_sq):
  .0228846418
  this.mean_sd_sq(denominator)
  5.00071e-08
  this.mean_asd(denominator)
  .0002739944
  this.max_asd(denominator)
  .0016398253
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.14     .0791      .208      .374      .695      1.17      2.45      4.64      9.72      16.8
         |       408      .995      1.03     .0421      .117      .207       .36       .61      1.21       2.3      4.75         7
         |       408      .272      .165     .0199     .0536     .0907      .148      .227      .369      .525      .696      .771
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .422      .188     .0946     .0946      .187      .239      .408      .568      .664      .828      .828
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.94     .0791      .209      .419      .781      1.46      2.33      4.12      9.64      16.8
         |       500      .996      .928     .0421      .119      .228      .398      .809      1.05      2.05      4.72         7
         |       500        .3      .179     .0199     .0544     .0987       .16       .25      .414      .581      .761      .828
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = stddiff():^2
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.448267
        1.x2 |  -1.565342
        1.x3 |  -.4664383
          x4 |  -.3840641
          x5 |   .0635287
          x6 |  -.2430673
          x7 |   .0477054
         x90 |   .1333153
         x91 |  -.1334921
         x92 |   .1520502
         x93 |   .0756012
         x94 |  -.1015022
         x95 |  -.0391333
       _cons |     1.3916
------------------------------------------------------------------------------

. 
. // IPW
. teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], atet aequations

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  1.444e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Treated vs Untreated)  |  -373.2561   49.21885    -7.58   0.000    -469.7233   -276.7889
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3424.879   30.82585   111.10   0.000     3364.462    3485.297
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.299227   .2371935    -5.48   0.000    -1.764118   -.8343367
                        |
                     x2 |
                     1  |  -1.630014    .746001    -2.19   0.029    -3.092149   -.1678787
                        |
                     x3 |
                     1  |  -.4513753   .5770312    -0.78   0.434    -1.582336    .6795851
                     x4 |  -.3551911    .204881    -1.73   0.083    -.7567506    .0463684
                     x5 |    .058452   .0195046     3.00   0.003     .0202237    .0966803
                     x6 |  -.2821622    .049775    -5.67   0.000    -.3797195    -.184605
                     x7 |   .0332008   .0279849     1.19   0.235    -.0216486    .0880501
                    x90 |   .1276778   .0907109     1.41   0.159    -.0501124     .305468
                    x91 |  -.0961159   .0916737    -1.05   0.294     -.275793    .0835612
                    x92 |   .1400043   .0976573     1.43   0.152    -.0514004    .3314091
                    x93 |   .0734557   .0916967     0.80   0.423    -.1062665     .253178
                    x94 |  -.1435742   .0862727    -1.66   0.096    -.3126656    .0255172
                    x95 |  -.0212452   .0898768    -0.24   0.813    -.1974006    .1549102
                  _cons |    1.24872   .6712769     1.86   0.063    -.0669587    2.564399
-----------------------------------------------------------------------------------------

. di _b[POmean:0.treat]
3424.8791

. tebalance summarize

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        249.5
                          Control obs   =          408        250.5
                          -----------------------------------------

  -----------------------------------------------------------------
                  |Standardized differences          Variance ratio
                  |        Raw    Weighted           Raw   Weighted
  ----------------+------------------------------------------------
               x1 |  -.6027752    .0041102      1.338962   1.000571
                  |
               x2 |
               1  |  -.1180374    .0011686      .4133173   1.011157
                  |
               x3 |
               1  |  -.1253201   -.0169419      .5085817   .8975379
                  |
               x4 |  -.1207472    .0136004      .9914484   1.003798
               x5 |  -.1944638     .003179      .8589874   .5855492
               x6 |  -.6542694    .0947099      .4958356   .5643304
               x7 |   .0473848    .0177567      1.160037   1.134687
              x90 |   .1499304    .0348222      .9289414    .817157
              x91 |  -.0833726   -.0675073      .8791918     .96061
              x92 |   .0662245   -.0005441      1.090179   1.148892
              x93 |   .0479737    -.020065      .8926169   .9606022
              x94 |  -.1521926    .0315996      .8686432   .7548902
              x95 |  -.0155155    .0398234      .8285405   .8815991
  -----------------------------------------------------------------

. tebalance summarize, baseline

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        249.5
                          Control obs   =          408        250.5
                          -----------------------------------------

  -----------------------------------------------------------------
                  |           Means                  Variances     
                  |    Control     Treated       Control    Treated
  ----------------+------------------------------------------------
               x1 |        .75    .4673913      .1879607   .2516722
                  |
               x2 |
               1  |   .0269608    .0108696      .0262984   .0108696
                  |
               x3 |
               1  |   .0441176    .0217391      .0422749   .0215002
                  |
               x4 |    .495098    .4347826      .2505902   .2484472
               x5 |   26.56863    25.46739      34.50142   29.63629
               x6 |   13.15931    11.86957      5.195687   2.576206
               x7 |   6.696078    6.858696      10.90495   12.65014
              x90 |   -.048508    .0972024      .9792937   .9097065
              x91 |  -.0077434   -.0890157      1.011341   .8891627
              x92 |  -.0227801    .0453787      1.013567    1.10497
              x93 |   .0403853    .0865687      .9793358   .8741716
              x94 |   .0160559   -.1299173      .9846065   .8552718
              x95 |  -.0658282   -.0807251      1.008285   .8354051
  -----------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet ipw treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462   -1.630013723    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932   -.0961158854    .1400043185
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.21     .0806      .194      .362      .647      1.17      2.44      4.63      9.22      17.7
         |       408      .995      1.06      .043      .116      .204      .339      .619      1.19      2.41      4.48      9.04
         |       408      .162      .122    .00968     .0257     .0443     .0716      .123      .213      .354      .505      .673
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .272      .148     .0419     .0419      .111      .141      .249       .37      .448      .722      .722
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97         2     .0806      .198      .398      .743      1.45      2.36      4.15       9.1      17.7
         |       500      .996      .954      .043      .116      .216      .395       .81      1.01      2.09      4.37      9.04
         |       500      .182      .134    .00968     .0257     .0468     .0819      .141      .249      .395       .59      .722
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.299227
        1.x2 |  -1.630014
        1.x3 |  -.4513753
          x4 |  -.3551911
          x5 |    .058452
          x6 |  -.2821622
          x7 |   .0332008
         x90 |   .1276778
         x91 |  -.0961159
         x92 |   .1400043
         x93 |   .0734557
         x94 |  -.1435742
         x95 |  -.0212452
       _cons |    1.24872
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet ipw averagevariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462   -1.630013723    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932   -.0961158854    .1400043185
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.21     .0806      .194      .362      .647      1.17      2.44      4.63      9.22      17.7
         |       408      .995      1.06      .043      .116      .204      .339      .619      1.19      2.41      4.48      9.04
         |       408      .162      .122    .00968     .0257     .0443     .0716      .123      .213      .354      .505      .673
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .272      .148     .0419     .0419      .111      .141      .249       .37      .448      .722      .722
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97         2     .0806      .198      .398      .743      1.45      2.36      4.15       9.1      17.7
         |       500      .996      .954      .043      .116      .216      .395       .81      1.01      2.09      4.37      9.04
         |       500      .182      .134    .00968     .0257     .0468     .0819      .141      .249      .395       .59      .722
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.299227
        1.x2 |  -1.630014
        1.x3 |  -.4513753
          x4 |  -.3551911
          x5 |    .058452
          x6 |  -.2821622
          x7 |   .0332008
         x90 |   .1276778
         x91 |  -.0961159
         x92 |   .1400043
         x93 |   .0734557
         x94 |  -.1435742
         x95 |  -.0212452
       _cons |    1.24872
------------------------------------------------------------------------------

. teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], ate aequations

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  2.423e-25  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATE                     |
                  treat |
(Treated vs Untreated)  |  -332.1348   56.53175    -5.88   0.000     -442.935   -221.3346
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3453.029    20.1341   171.50   0.000     3413.567    3492.491
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.299227   .2371935    -5.48   0.000    -1.764118   -.8343367
                        |
                     x2 |
                     1  |  -1.630014    .746001    -2.19   0.029    -3.092149   -.1678787
                        |
                     x3 |
                     1  |  -.4513753   .5770312    -0.78   0.434    -1.582336    .6795851
                     x4 |  -.3551911    .204881    -1.73   0.083    -.7567506    .0463684
                     x5 |    .058452   .0195046     3.00   0.003     .0202237    .0966803
                     x6 |  -.2821622    .049775    -5.67   0.000    -.3797195    -.184605
                     x7 |   .0332008   .0279849     1.19   0.235    -.0216486    .0880501
                    x90 |   .1276778   .0907109     1.41   0.159    -.0501124     .305468
                    x91 |  -.0961159   .0916737    -1.05   0.294     -.275793    .0835612
                    x92 |   .1400043   .0976573     1.43   0.152    -.0514004    .3314091
                    x93 |   .0734557   .0916967     0.80   0.423    -.1062665     .253178
                    x94 |  -.1435742   .0862727    -1.66   0.096    -.3126656    .0255172
                    x95 |  -.0212452   .0898768    -0.24   0.813    -.1974006    .1549102
                  _cons |    1.24872   .6712769     1.86   0.063    -.0669587    2.564399
-----------------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], ate ipw treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462   -1.630013723    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932   -.0961158854    .1400043185
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      .572      .862      1.06      1.36      1.59       1.9      2.23      2.72      3.72      5.29
         |       408      .999      .196      .823      .836      .852      .877      .929      1.03      1.26      1.65      2.49
         |       408      .162      .122    .00968     .0257     .0443     .0716      .123      .213      .354      .505      .673
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      1.31      .475      .475      .807      1.08      1.51      2.47      3.54      8.32      8.32
         |        92      1.02      .684      .274      .274      .443      .535      .795       1.4      1.78      4.73      4.73
         |        92      .272      .148     .0419     .0419      .111      .141      .249       .37      .448      .722      .722
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97       .76      .475      .645      1.19      1.51      1.87      2.26      2.83      4.93      8.32
         |       500         1      .341      .274      .398      .832      .866      .925      1.06      1.39      2.29      4.73
         |       500      .182      .134    .00968     .0257     .0468     .0819      .141      .249      .395       .59      .722
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.299227
        1.x2 |  -1.630014
        1.x3 |  -.4513753
          x4 |  -.3551911
          x5 |    .058452
          x6 |  -.2821622
          x7 |   .0332008
         x90 |   .1276778
         x91 |  -.0961159
         x92 |   .1400043
         x93 |   .0734557
         x94 |  -.1435742
         x95 |  -.0212452
       _cons |    1.24872
------------------------------------------------------------------------------

. teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], atet aequations tlevel(0) control(1)

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  1.908e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Untreated vs Treated)  |   321.4309   62.35166     5.16   0.000     199.2239    443.6379
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
               Treated  |   3138.003   59.50596    52.73   0.000     3021.374    3254.633
------------------------+----------------------------------------------------------------
TME0                    |
                     x1 |   1.299227   .2371935     5.48   0.000     .8343367    1.764118
                        |
                     x2 |
                     1  |   1.630014    .746001     2.19   0.029     .1678787    3.092149
                        |
                     x3 |
                     1  |   .4513753   .5770312     0.78   0.434    -.6795851    1.582336
                     x4 |   .3551911    .204881     1.73   0.083    -.0463684    .7567506
                     x5 |   -.058452   .0195046    -3.00   0.003    -.0966803   -.0202237
                     x6 |   .2821622    .049775     5.67   0.000      .184605    .3797195
                     x7 |  -.0332008   .0279849    -1.19   0.235    -.0880501    .0216486
                    x90 |  -.1276778   .0907109    -1.41   0.159     -.305468    .0501124
                    x91 |   .0961159   .0916737     1.05   0.294    -.0835612     .275793
                    x92 |  -.1400043   .0976573    -1.43   0.152    -.3314091    .0514004
                    x93 |  -.0734557   .0916967    -0.80   0.423     -.253178    .1062665
                    x94 |   .1435742   .0862727     1.66   0.096    -.0255172    .3126656
                    x95 |   .0212452   .0898768     0.24   0.813    -.1549102    .1974006
                  _cons |   -1.24872   .6712769    -1.86   0.063    -2.564399    .0669587
-----------------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], ateu ipw treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  propensity score (logit) model beta:
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462   -1.630013723    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932   -.0961158854    .1400043185
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------+
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      .398      .881      1.17      1.44      1.68      1.96      2.23      2.48      2.83      3.24
         |       408         1         0         1         1         1         1         1         1         1         1         1
         |       408      .162      .122    .00968     .0257     .0443     .0716      .123      .213      .354      .505      .673
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      1.62      .218      .218      .607      .827      1.32      2.63      3.86      9.94      9.94
         |        92      1.03      .852     .0953     .0953      .305      .421      .745       1.5      1.98      5.65      5.65
         |        92      .272      .148     .0419     .0419      .111      .141      .249       .37      .448      .722      .722
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97       .78      .218      .418      1.22       1.6      1.94      2.27      2.59      4.66      9.94
         |       500         1      .364     .0953       .25      .813         1         1         1         1      2.54      5.65
         |       500      .182      .134    .00968     .0257     .0468     .0819      .141      .249      .395       .59      .722
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = IPW
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.299227
        1.x2 |  -1.630014
        1.x3 |  -.4513753
          x4 |  -.3551911
          x5 |    .058452
          x6 |  -.2821622
          x7 |   .0332008
         x90 |   .1276778
         x91 |  -.0961159
         x92 |   .1400043
         x93 |   .0734557
         x94 |  -.1435742
         x95 |  -.0212452
       _cons |    1.24872
------------------------------------------------------------------------------

. 
. // tradeoff between CBPS-like balance and variance in weights
. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet cbps treatvariance
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00001735  
Iteration 1:   f(p) =  6.450e-06  
Iteration 2:   f(p) =  5.892e-06  
Iteration 3:   f(p) =  5.889e-06  
Iteration 4:   f(p) =  5.889e-06  
Iteration 5:   f(p) =  5.884e-06  
Iteration 6:   f(p) =  5.782e-06  
Iteration 7:   f(p) =  1.662e-06  
Iteration 8:   f(p) =  1.352e-06  
Iteration 9:   f(p) =  1.347e-06  
Iteration 10:  f(p) =  1.347e-06  
Iteration 11:  f(p) =  1.347e-06  
(switching technique to nr)
Iteration 12:  f(p) =  1.337e-06  (not concave)
Iteration 13:  f(p) =  8.478e-08  
Iteration 14:  f(p) =  1.602e-08  
Iteration 15:  f(p) =  7.712e-10  
Iteration 16:  f(p) =  5.651e-13  
Iteration 17:  f(p) =  5.938e-20  
Iteration 18:  f(p) =  8.653e-26  
  CBPS beta after undoing the normalization
                1           2
     +-------------------------+
   1 |         x1   -1.447047  |
   2 |      i1.x2   -1.546891  |
   3 |      i1.x3   -.4710623  |
   4 |         x4   -.3822539  |
   5 |         x5    .0635824  |
   6 |         x6    -.243227  |
   7 |         x7    .0477027  |
   8 |        x90    .1334992  |
   9 |        x91   -.1336117  |
  10 |        x92    .1522937  |
  11 |        x93    .0757732  |
  12 |        x94   -.1016171  |
  13 |        x95   -.0383391  |
  14 |      _cons    .6265763  |
     +-------------------------+
  Balance after CBPS (cbps_port_r):
  optimize_result_value(S)
  8.65286e-26
  balance table after matching (cbps_port_r):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512231     2.63e-12     5.26e-12     .4990018     1.004328  |
   3 |       i1.x2     .0114039     .0114039     2.63e-13     2.47e-12     .1064741     1.004328  |
   4 |       i1.x3     .0240637     .0240637     3.94e-13     2.57e-12     .1536741     1.004328  |
   5 |          x4     .4218861     .4218861     7.43e-13     1.50e-12     .4952368     1.004328  |
   6 |          x5     25.44699     25.44699     1.28e-11     2.36e-12     5.422129     .6144662  |
   7 |          x6     11.84757     11.84757     1.34e-11     8.13e-12     1.641931     .5982513  |
   8 |          x7     7.015422     7.015422    -1.00e-11    -2.82e-12     3.555432     1.161761  |
   9 |         x90     .0839738     .0839738    -1.05e-14    -1.09e-14     .9597153     .8505325  |
  10 |         x91    -.0648837    -.0648837     3.35e-12     3.57e-12       .93861     .9922891  |
  11 |         x92     .0575388     .0575388    -1.11e-12    -1.07e-12      1.03554     1.118263  |
  12 |         x93     .1016523     .1016523    -1.98e-12    -2.09e-12     .9463749     1.012572  |
  13 |         x94    -.1252265    -.1252265     1.63e-12     1.78e-12     .9147554     .7576623  |
  14 |         x95    -.1044649    -.1044649     6.17e-13     6.80e-13     .9069849     .8646431  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_r):
  2876.289278
  cv of matching weights (cbps_port_r):
  1.031924564
  sd of matching weights (cbps_port_r):
  1.02710789
  skewness of matching weights (cbps_port_r):
  .1135011509
  kurtosis of matching weights (cbps_port_r):
  .0229206639
  this.mean_sd_sq(denominator)
  2.95033e-24
  this.mean_asd(denominator)
  2.63972e-12
  this.max_asd(denominator)
  8.13242e-12
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.14     .0807      .208      .375      .695      1.17      2.44      4.62      9.71      16.8
         |       408      .995      1.03      .043      .118      .207       .36       .61      1.22       2.3      4.75      7.01
         |       408      .161       .12    .00957     .0257     .0444     .0748      .121      .215       .34      .516      .611
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .274      .157     .0464     .0464     .0968      .128      .243       .38       .48      .692      .692
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.94     .0807      .209      .419      .781      1.46      2.33      4.12      9.63      16.8
         |       500      .996      .928      .043      .119      .228      .398      .809      1.04      2.05      4.72      7.01
         |       500      .182      .135    .00957     .0261     .0485     .0816      .134      .247      .392      .597      .692
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = CBPS
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.447047
        1.x2 |  -1.546891
        1.x3 |  -.4710623
          x4 |  -.3822539
          x5 |   .0635824
          x6 |   -.243227
          x7 |   .0477027
         x90 |   .1334992
         x91 |  -.1336117
         x92 |   .1522937
         x93 |   .0757732
         x94 |  -.1016171
         x95 |  -.0383391
       _cons |   .6265763
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet cbps treatvariance cvopt(1 .75 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
Warning: cvopt does not appear to substantially affect the reults with fctn=cbps. Consider switching to fctn=sd_sq or mean_sd_sq
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .17799586  
Iteration 1:   f(p) =  .17799428  (backed up)
Iteration 2:   f(p) =  .17798375  
Iteration 3:   f(p) =  .17798365  
Iteration 4:   f(p) =  .17798365  
Iteration 5:   f(p) =  .17798364  
Iteration 6:   f(p) =  .17798171  
Iteration 7:   f(p) =     .17798  
Iteration 8:   f(p) =  .17797995  
Iteration 9:   f(p) =  .17797995  
Iteration 10:  f(p) =  .17797995  
Iteration 11:  f(p) =  .17797995  
(switching technique to nr)
Iteration 12:  f(p) =  .17797989  
Iteration 13:  f(p) =  .17797853  
Iteration 14:  f(p) =  .17797852  
Iteration 15:  f(p) =  .17797852  
Iteration 16:  f(p) =  .17797852  (backed up)
  CBPS beta after undoing the normalization
                1           2
     +-------------------------+
   1 |         x1    -1.44703  |
   2 |      i1.x2   -1.546957  |
   3 |      i1.x3   -.4711251  |
   4 |         x4   -.3822612  |
   5 |         x5     .063581  |
   6 |         x6   -.2432253  |
   7 |         x7     .047703  |
   8 |        x90     .133496  |
   9 |        x91   -.1336043  |
  10 |        x92    .1522877  |
  11 |        x93    .0757711  |
  12 |        x94   -.1016181  |
  13 |        x95   -.0383358  |
  14 |      _cons    .6265859  |
     +-------------------------+
  Balance after CBPS (cbps_port_r):
  optimize_result_value(S)
  .1779785156
  balance table after matching (cbps_port_r):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512254    -2.28e-06    -4.57e-06     .4990018     1.004327  |
   3 |       i1.x2     .0114039     .0114028     1.10e-06     .0000103     .1064741     1.004424  |
   4 |       i1.x3     .0240637     .0240619     1.83e-06     .0000119     .1536741     1.004402  |
   5 |          x4     .4218861     .4218858     3.47e-07     7.00e-07     .4952368     1.004328  |
   6 |          x5     25.44699     25.44699    -7.28e-08    -1.34e-08     5.422129     .6144678  |
   7 |          x6     11.84757     11.84758    -7.96e-06    -4.85e-06     1.641931     .5982507  |
   8 |          x7     7.015422      7.01543    -8.81e-06    -2.48e-06     3.555432      1.16176  |
   9 |         x90     .0839738     .0839704     3.43e-06     3.58e-06     .9597153     .8505319  |
  10 |         x91    -.0648837    -.0648782    -5.53e-06    -5.89e-06       .93861     .9922873  |
  11 |         x92     .0575388     .0575326     6.12e-06     5.91e-06      1.03554     1.118264  |
  12 |         x93     .1016523     .1016513     1.04e-06     1.10e-06     .9463749     1.012569  |
  13 |         x94    -.1252265    -.1252272     7.45e-07     8.14e-07     .9147554     .7576633  |
  14 |         x95    -.1044649    -.1044615    -3.48e-06    -3.84e-06     .9069849     .8646435  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_r):
  2876.287329
  cv of matching weights (cbps_port_r):
  1.031917533
  sd of matching weights (cbps_port_r):
  1.027100831
  skewness of matching weights (cbps_port_r):
  .1135002103
  kurtosis of matching weights (cbps_port_r):
  .0229202661
  this.mean_sd_sq(denominator)
  9.46598e-13
  this.mean_asd(denominator)
  4.30250e-06
  this.max_asd(denominator)
  .0000118814
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.14     .0807      .208      .375      .695      1.17      2.44      4.63      9.71      16.8
         |       408      .995      1.03      .043      .118      .207       .36       .61      1.22       2.3      4.75      7.01
         |       408      .161       .12    .00957     .0257     .0444     .0748      .121      .215       .34      .516      .611
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .274      .157     .0464     .0464     .0968      .128      .243       .38       .48      .692      .692
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.94     .0807      .209      .419      .781      1.46      2.33      4.12      9.63      16.8
         |       500      .996      .928      .043      .119      .228      .398      .809      1.04      2.05      4.72      7.01
         |       500      .182      .135    .00957     .0261     .0485     .0816      .134      .247      .392      .597      .692
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = CBPS + 1*abs(CV-.75)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |   -1.44703
        1.x2 |  -1.546957
        1.x3 |  -.4711251
          x4 |  -.3822612
          x5 |    .063581
          x6 |  -.2432253
          x7 |    .047703
         x90 |    .133496
         x91 |  -.1336043
         x92 |   .1522877
         x93 |   .0757711
         x94 |  -.1016181
         x95 |  -.0383358
       _cons |   .6265859
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet cbps treatvariance cvopt(1 .50 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
Warning: cvopt does not appear to substantially affect the reults with fctn=cbps. Consider switching to fctn=sd_sq or mean_sd_sq
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .01564235  
Iteration 1:   f(p) =  .01563174  
Iteration 2:   f(p) =  .01563166  
Iteration 3:   f(p) =  .01563166  
Iteration 4:   f(p) =  .01563166  
Iteration 5:   f(p) =  .01563163  
Iteration 6:   f(p) =  .01563123  
Iteration 7:   f(p) =  .01562716  
Iteration 8:   f(p) =  .01562646  
Iteration 9:   f(p) =  .01562645  
Iteration 10:  f(p) =  .01562645  
Iteration 11:  f(p) =  .01562645  
(switching technique to nr)
Iteration 12:  f(p) =  .01562645  
Iteration 13:  f(p) =  .01562501  
Iteration 14:  f(p) =    .015625  
Iteration 15:  f(p) =    .015625  
Iteration 16:  f(p) =    .015625  
  CBPS beta after undoing the normalization
                1           2
     +-------------------------+
   1 |         x1   -1.447046  |
   2 |      i1.x2   -1.546894  |
   3 |      i1.x3   -.4710656  |
   4 |         x4   -.3822545  |
   5 |         x5    .0635823  |
   6 |         x6   -.2432271  |
   7 |         x7    .0477027  |
   8 |        x90    .1334992  |
   9 |        x91   -.1336111  |
  10 |        x92    .1522936  |
  11 |        x93    .0757731  |
  12 |        x94   -.1016171  |
  13 |        x95   -.0383388  |
  14 |      _cons     .626579  |
     +-------------------------+
  Balance after CBPS (cbps_port_r):
  optimize_result_value(S)
  .015625
  balance table after matching (cbps_port_r):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512233    -1.29e-07    -2.59e-07     .4990018     1.004328  |
   3 |       i1.x2     .0114039     .0114038     5.58e-08     5.24e-07     .1064741     1.004333  |
   4 |       i1.x3     .0240637     .0240636     8.93e-08     5.81e-07     .1536741     1.004332  |
   5 |          x4     .4218861     .4218861     2.19e-08     4.43e-08     .4952368     1.004328  |
   6 |          x5     25.44699     25.44698     1.14e-06     2.10e-07     5.422129     .6144663  |
   7 |          x6     11.84757     11.84757     1.01e-07     6.13e-08     1.641931     .5982513  |
   8 |          x7     7.015422     7.015422    -2.88e-07    -8.09e-08     3.555432     1.161761  |
   9 |         x90     .0839738     .0839738     5.56e-08     5.79e-08     .9597153     .8505324  |
  10 |         x91    -.0648837    -.0648833    -3.76e-07    -4.01e-07       .93861     .9922889  |
  11 |         x92     .0575388     .0575386     1.37e-07     1.33e-07      1.03554     1.118263  |
  12 |         x93     .1016523     .1016523     5.48e-08     5.79e-08     .9463749     1.012572  |
  13 |         x94    -.1252265    -.1252265     1.98e-08     2.17e-08     .9147554     .7576623  |
  14 |         x95    -.1044649    -.1044647    -2.85e-07    -3.14e-07     .9069849     .8646431  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (cbps_port_r):
  2876.28917
  cv of matching weights (cbps_port_r):
  1.031924268
  sd of matching weights (cbps_port_r):
  1.027107584
  skewness of matching weights (cbps_port_r):
  .1135011307
  kurtosis of matching weights (cbps_port_r):
  .0229206584
  this.mean_sd_sq(denominator)
  2.39664e-15
  this.mean_asd(denominator)
  2.11202e-07
  this.max_asd(denominator)
  5.80789e-07
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      2.14     .0807      .208      .375      .695      1.17      2.44      4.62      9.71      16.8
         |       408      .995      1.03      .043      .118      .207       .36       .61      1.22       2.3      4.75      7.01
         |       408      .161       .12    .00957     .0257     .0444     .0748      .121      .215       .34      .516      .611
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .274      .157     .0464     .0464     .0968      .128      .243       .38       .48      .692      .692
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.94     .0807      .209      .419      .781      1.46      2.33      4.12      9.63      16.8
         |       500      .996      .928      .043      .119      .228      .398      .809      1.04      2.05      4.72      7.01
         |       500      .182      .135    .00957     .0261     .0485     .0816      .134      .247      .392      .597      .692
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = CBPS + 1*abs(CV-.5)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.447046
        1.x2 |  -1.546894
        1.x3 |  -.4710656
          x4 |  -.3822545
          x5 |   .0635823
          x6 |  -.2432271
          x7 |   .0477027
         x90 |   .1334992
         x91 |  -.1336111
         x92 |   .1522936
         x93 |   .0757731
         x94 |  -.1016171
         x95 |  -.0383388
       _cons |    .626579
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet mean_sd_sq treatvariance cvopt(1 .75 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.29045  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00118407  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00047827  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00006974  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00004509  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  9.893e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  2.962e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  1.695e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  6.546e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  2.889e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  1.307e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  8.558e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  7.610e-08  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -1.255753  |
   2 |      i1.x2   -1.628901  |
   3 |      i1.x3   -.4503974  |
   4 |         x4   -.3346771  |
   5 |         x5    .0070273  |
   6 |         x6   -.0775803  |
   7 |         x7   -.0178256  |
   8 |        x90    .0982705  |
   9 |        x91   -.1024415  |
  10 |        x92     .114491  |
  11 |        x93    .0410172  |
  12 |        x94   -.1023475  |
  13 |        x95   -.0263129  |
  14 |      _cons    1.256348  |
     +-------------------------+
  Balance after CBPS (mean_sd_sq):
  optimize_result_value(S)
  7.60975e-08
  balance table after matching (mean_sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231      .457953    -.0067298    -.0134866     .4990018     1.001855  |
   3 |       i1.x2     .0114039      .009755     .0016489     .0154863     .1064741     1.172135  |
   4 |       i1.x3     .0240637     .0216688      .002395     .0155846     .1536741     1.112602  |
   5 |          x4     .4218861     .4825009    -.0606148    -.1223957     .4952368     .9810168  |
   6 |          x5     25.44699     24.45723     .9897571     .1825403     5.422129     .7465604  |
   7 |          x6     11.84757      12.2595    -.4119275      -.25088     1.641931     .5550162  |
   8 |          x7     7.015422     6.363199      .652223     .1834441     3.555432     1.144074  |
   9 |         x90     .0839738     .1069147    -.0229409    -.0239039     .9597153     .8365983  |
  10 |         x91    -.0648837    -.0681262     .0032425     .0034546       .93861     .9534483  |
  11 |         x92     .0575388     .0729413    -.0154025    -.0148739      1.03554     1.090563  |
  12 |         x93     .1016523     .0768846     .0247677     .0261712     .9463749     1.002152  |
  13 |         x94    -.1252265    -.1318526     .0066261     .0072436     .9147554     .8085824  |
  14 |         x95    -.1044649    -.0957594    -.0087055    -.0095983     .9069849     .8538529  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (mean_sd_sq):
  2815.792812
  cv of matching weights (mean_sd_sq):
  .8137908636
  sd of matching weights (mean_sd_sq):
  .8087486412
  skewness of matching weights (mean_sd_sq):
  .0900538996
  kurtosis of matching weights (mean_sd_sq):
  .0148661301
  this.mean_sd_sq(denominator)
  8.71442e-09
  this.mean_asd(denominator)
  .0668509993
  this.max_asd(denominator)
  .2508799649
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      1.72      .192      .401      .685      .895      1.32      2.21      4.44      8.39      12.9
         |       408      .994      .809      .103      .249      .374      .483      .669      1.11      2.28      3.45      4.65
         |       408       .31      .142     .0524      .118      .168      .207      .265      .374      .551       .65      .715
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92      .428      .156       .14       .14      .234      .279      .435      .572      .625      .701      .701
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.56      .192      .424      .717      .965      1.51      2.25      4.02       7.9      12.9
         |       500      .995       .73      .103      .251      .401      .528      .777         1      2.06      3.44      4.65
         |       500      .331      .152     .0524      .119      .177       .22      .278      .459      .579      .692      .715
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = mean(stddiff())^2 + 1*abs(CV-.75)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -1.255753
        1.x2 |  -1.628901
        1.x3 |  -.4503974
          x4 |  -.3346771
          x5 |   .0070273
          x6 |  -.0775803
          x7 |  -.0178256
         x90 |   .0982705
         x91 |  -.1024415
         x92 |    .114491
         x93 |   .0410172
         x94 |  -.1023475
         x95 |  -.0263129
       _cons |   1.256348
------------------------------------------------------------------------------

. gmatch `treatvar' `varlist' if `tousevar' [iw=`wgtvar'], atet mean_sd_sq treatvariance cvopt(1 .50 6)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
(4,642 missing values generated)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.29045  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .03174366  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .01880683  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01499079  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00460016  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00088681  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00069868  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00016284  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00008031  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00004972  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00003906  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00003723  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00002755  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00001175  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  9.832e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  5.783e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  5.150e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  4.504e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  3.517e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  3.214e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  2.933e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  2.837e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  2.310e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  2.097e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  9.961e-07  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  8.701e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  8.661e-07  
  CBPS beta
                1           2
     +-------------------------+
   1 |         x1   -.9690922  |
   2 |      i1.x2   -1.704319  |
   3 |      i1.x3   -.4959917  |
   4 |         x4   -.2589244  |
   5 |         x5    .0106514  |
   6 |         x6   -.0301908  |
   7 |         x7   -.0501008  |
   8 |        x90   -.0363644  |
   9 |        x91   -.1071162  |
  10 |        x92   -.1057992  |
  11 |        x93   -.0909857  |
  12 |        x94   -.0565093  |
  13 |        x95   -.1379859  |
  14 |      _cons     1.27396  |
     +-------------------------+
  Balance after CBPS (mean_sd_sq):
  optimize_result_value(S)
  8.66061e-07
  balance table after matching (mean_sd_sq):
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .5605247    -.1093015    -.2190404     .4990018     1.009563  |
   3 |       i1.x2     .0114039     .0082293     .0031746     .0298158     .1064741     1.387313  |
   4 |       i1.x3     .0240637     .0201238       .00394     .0256384     .1536741     1.196133  |
   5 |          x4     .4218861     .4853435    -.0634574    -.1281355     .4952368     .9806578  |
   6 |          x5     25.44699     25.38972     .0572613     .0105607     5.422129      .752994  |
   7 |          x6     11.84757     12.58987    -.7422999    -.4520897     1.641931      .527518  |
   8 |          x7     7.015422     6.151162     .8642601     .2430816     3.555432     1.128012  |
   9 |         x90     .0839738     -.040307     .1242808     .1294976     .9597153     .8622194  |
  10 |         x91    -.0648837    -.0791887      .014305     .0152406       .93861     .9586889  |
  11 |         x92     .0575388    -.1120972     .1696359     .1638139      1.03554     1.079439  |
  12 |         x93     .1016523    -.0289827      .130635     .1380372     .9463749     .9216689  |
  13 |         x94    -.1252265    -.0852702    -.0399563    -.0436797     .9147554     .8107032  |
  14 |         x95    -.1044649    -.1828354     .0783704     .0864076     .9069849     .8468416  |
     +--------------------------------------------------------------------------------------------+
  entropydistance of control weights (mean_sd_sq):
  2790.12915
  cv of matching weights (mean_sd_sq):
  .5975509931
  sd of matching weights (mean_sd_sq):
  .5973291805
  skewness of matching weights (mean_sd_sq):
  .0805389686
  kurtosis of matching weights (mean_sd_sq):
  .0148835008
  this.mean_sd_sq(denominator)
  4.29337e-09
  this.mean_asd(denominator)
  .1296183578
  this.max_asd(denominator)
  .452089668
  New variables (unweighted summary statistics):

Summary for variables: _weight _weight_mtch _pscore
     by categories of: _treated 

_treated |         N      mean        sd       min        p1       p10       p25       p50       p75       p90       p99       max
---------+------------------------------------------------------------------------------------------------------------------------
       0 |       408      1.97      1.27      .188      .384      .799      1.12       1.6      2.37       3.8      6.17      9.77
         |       408         1      .597        .1      .238      .458      .599      .813      1.23      1.85         3      3.75
         |       408      .479      .128     .0967      .202      .328       .39      .464      .567      .664      .762        .8
---------+------------------------------------------------------------------------------------------------------------------------
       1 |        92      1.96      .391      .877      .877      1.39      1.72         2      2.25      2.45      2.67      2.67
         |        92         1         0         1         1         1         1         1         1         1         1         1
         |        92       .56      .134      .258      .258      .384      .455      .555      .667      .725      .809      .809
---------+------------------------------------------------------------------------------------------------------------------------
   Total |       500      1.97      1.16      .188      .386      .871      1.23      1.74      2.32      3.54      6.16      9.77
         |       500         1      .539        .1       .25      .486      .646      .947      1.09      1.68      2.94      3.75
         |       500      .494      .133     .0967       .21      .337        .4      .479      .589      .687      .788      .809
----------------------------------------------------------------------------------------------------------------------------------

Propensity score model coefficients                Number of obs  =        983
Generalization of IPW/CPBS-type reweigting
Loss = mean(stddiff())^2 + 1*abs(CV-.5)^ 6)
------------------------------------------------------------------------------
             |      Coef.
-------------+----------------------------------------------------------------
          x1 |  -.9690922
        1.x2 |  -1.704319
        1.x3 |  -.4959917
          x4 |  -.2589244
          x5 |   .0106514
          x6 |  -.0301908
          x7 |  -.0501008
         x90 |  -.0363644
         x91 |  -.1071162
         x92 |  -.1057992
         x93 |  -.0909857
         x94 |  -.0565093
         x95 |  -.1379859
       _cons |    1.27396
------------------------------------------------------------------------------

. 
. log close gmatch_example_ado
      name:  gmatch_example_ado
       log:  C:\Users\kkranker\Documents\Stata\Ado\Devel\gmatch\gmatch_example_ado.log
  log type:  text
 closed on:  13 Feb 2018, 23:04:57
----------------------------------------------------------------------------------------------------------------------------------------------------------------
