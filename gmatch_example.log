----------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  gmatch_example
       log:  C:\Users\kkranker\Documents\Stata\Ado\Devel\gmatch\gmatch_example.log
  log type:  text
 opened on:  14 Feb 2018, 01:21:17

. 
. //****************************************************************************/
. *! $Id: gmatch_example.do,v e38398bcb0ac 2018/02/14 08:16:27 kkranker $
. *! Generalization of IPW and CBPS estimators
. *! Example files
. //
. *! By Keith Kranker
. // Last updated $Date: 2018/02/14 08:16:27 $
. //
. // Copyright (C) Mathematica Policy Research, Inc.
. // This code cannot be copied, distributed or used without the express written
. // permission of Mathematica Policy Research, Inc.
. //*****************************************************************************/
. 
. version 15.1

. set type double

. di as txt "Current user: `c(username)'" _n "Environment: `c(os)' `c(machine_type)' `: environment computername'" _n "Stata: `c(stata_version)'" cond(c(stata_v
> ersion)==c(version),""," (set to version `c(version)')") _n "Date: " c(current_date) " " c(current_time)
Current user: KKranker
Environment: Windows PC (64-bit x86-64) KKRANKER
Stata: 15.1
Date: 14 Feb 2018 01:21:18

. 
. // do C:\Users\kkranker\Documents\Stata\Ado\Devel\gmatch\gmatch_one_time_setup.do
. 
. which gmatch
.\gmatch.ado
*! $Id: gmatch.ado,v 64c1f9ba17f5 2018/02/14 08:13:08 kkranker $
*! Generalization of IPW and CBPS estimators
*! Stata command to estimate models
*! By Keith Kranker

. which gmatchcall
.\gmatchcall.ado
*! $Id: gmatchcall.ado,v 3a696a7b31b4 2018/02/14 07:28:04 kkranker $
*! Generalization of IPW and CBPS estimators
*! Stata command to call class functions on an instance of the class
*! named gmatch_ado_most_recent
*! By Keith Kranker

. mata: mata describe using lgmatch
(library contains 48 members)


      # bytes   type                        name and extent
-------------------------------------------------------------------------------
        4,032   auto classdef scalar        gmatch()
          208   auto real rowvector          ::asd()
        1,316   auto void                    ::balanceresults()
        1,312   auto real matrix             ::balancetable()
          628   auto void                    ::calcN()
          816   auto void                    ::calccovariances()
          320   auto void                    ::calcmeans()
          576   auto void                    ::calcvariances()
        6,176   auto real rowvector          ::cbps()
        2,136   auto void                    ::cbps_port_r()
          768   auto void                    ::cbps_port_stata()
          676   auto real matrix             ::cbps_port_stata_gradient()
          748   auto real colvector          ::cbps_port_stata_moments()
        1,668   auto real matrix             ::cbps_port_stata_wgt_matrix()
        1,960   auto void                    ::cbpseval()
          592   auto void                    ::clone()
          568   auto real rowvector          ::diagvariance()
          168   auto real rowvector          ::diff()
          336   auto real scalar             ::entropydistance()
          968   auto void                    ::get_scores()
          604   auto real rowvector          ::ipw()
        1,520   auto real rowvector          ::logitbeta()
          524   auto real colvector          ::logitpredict()
        1,292   auto real colvector          ::logitweights()
          232   auto real scalar             ::max_asd()
          240   auto real scalar             ::mean_asd()
          272   auto real scalar             ::mean_sd_sq()
           96   auto void                    ::new()
          688   auto real rowvector          ::olsbeta()
          468   auto real colvector          ::olspredict()
          264   auto real rowvector          ::pomean()
          776   auto void                    ::postbeta()
        1,200   auto real rowvector          ::prognosticdiff()
          728   auto void                    ::reweight()
          224   auto real rowvector          ::sd_sq()
        1,568   auto void                    ::set()
          264   auto void                    ::set_Y()
          852   auto real rowvector          ::stddiff()
          512   auto real colvector          ::trim()
          168   auto real rowvector          ::varratio()
          200   auto real scalar             ::wgt_cv()
          264   auto real scalar             ::wgt_kurtosis()
          784   auto real rowvector          ::wgt_moments()
          140   auto real scalar             ::wgt_sd()
          272   auto real scalar             ::wgt_skewness()
          412   auto void                   gmatch_cbps_eval()
          504   auto void                   gmatch_logit_eval()
        2,276   auto void                   optimize_init_mlopts()
-------------------------------------------------------------------------------

. 
. ************************************************************************************
. * Describe/summarize the example datasets
. ************************************************************************************
. 
. *** Input data file (simple_cattaneo_data) comes from the program named Make_example_datasets.do (in C:\Users\kkranker\Documents\Stata\Multiple-Equation-Model
> s)
. 
. use "C:\Users\kkranker\Documents\Stata\Multiple-Equation-Models\simple_cattaneo_data.dta"
(Cattaneo (2010) study on the effect of maternal smoking on birth weight)

. desc, short

Contains data from C:\Users\kkranker\Documents\Stata\Multiple-Equation-Models\simple_cattaneo_data.dta
  obs:         4,642                          Cattaneo (2010) study on the effect of maternal smoking on birth weight
 vars:            11                          8 Apr 2015 05:07
 size:        55,704                          
Sorted by: 

. notes _dta

_dta:
  1.  Cattaneo (2010) study on the effect of maternal smoking on birth weight
  2.  Dataset created by Keith Kranker (program name: make_example_datasets.do)
  3.  Source: Cattaneo, M. D. 2010. "Efficient Semiparametric Estimation of Multi-Valued Treatment Effects under Ignorability." Journal of Econometrics, 155(2):
      138–154, doi:10.1016/j.jeconom.2009.09.023.
  4.  Source: Almond, D., Chay, K.Y., Lee, D.S., 2005. "The costs of low birth weight." Quarterly Journal of Economics, 120: 1031-1083.
  5.  Original dataset downloaded 4/3/2015 via Stata command ". webuse cattaneo2"
  6.  The variable names in the original datasets are replaced with "generic" names: (1) The outcome variables are named y1 y2 y3... (2) The treatment variable
      is named treat (binary) or treat_cat (categorical). (3) The control variables are named x1 x2 x3...

. summ, sep(0)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       treat |      4,642    .1861267    .3892508          0          1
   treat_cat |      4,642    .3996122    .8988632          0          3
          x1 |      4,642    .6996984    .4584385          0          1
          x2 |      4,642    .0340371    .1813439          0          1
          x3 |      4,642    .0534252    .2249042          0          1
          x4 |      4,642    .4379578    .4961893          0          1
          x5 |      4,642    26.50452    5.619026         13         45
          x6 |      4,642    12.68957    2.520661          0         17
          x7 |      4,642    6.540069    3.359167          1         12
          y1 |      4,642     3361.68    578.8196        340       5500
   y1_binary |      4,642    .9396812    .2381022          0          1

. tab treat treat_cat, mi

           |                  treat_cat
     treat | Untreated  1st Treat  2nd Treat  3rd Treat |     Total
-----------+--------------------------------------------+----------
 Untreated |     3,778          0          0          0 |     3,778 
   Treated |         0        200        337        327 |       864 
-----------+--------------------------------------------+----------
     Total |     3,778        200        337        327 |     4,642 


. corr treat y1 y1_binary
(obs=4,642)

             |    treat       y1 y1_bin~y
-------------+---------------------------
       treat |   1.0000
          y1 |  -0.1851   1.0000
   y1_binary |  -0.0997   0.5924   1.0000


. 
. local if if _n<=500

. set seed 1

. gen wgt = max(.1,rnormal(2,.4))

. gen fwgt = round(rnormal(2,.4))

. // forvalues i = 20/200 {
. forvalues i = 90/95 {
  2.   gen x`i' = rnormal()
  3. }

. 
. local depvars = "y1 y1_binary"

. local treatvar = "treat"

. local varlist = "x1 i.x2 i.x3 x4 x5 x6 x7 x9*"

. local wgtvar = "wgt"

. local tousevar = "touse"

. local estimate = "atet"

. 
. 
. // some automatic parsing based on options above, since Mata doesn't have this stuff
. if "`wgtvar'"!="" local wgtexp "[iw=`wgtvar']"

. mark    `tousevar' `if' `in' `wgtexp'

. markout `tousevar' `depvars' `treatvar' `varlist'

. _rmdcoll `treatvar' `varlist' if `tousevar' `wgtexp', expand

. // _rmcoll `treatvar' `varlist' if `tousevar' `wgtexp', expand logit touse(`tousevar')
. // fvexpand `varlist' if `tousevar'
. local varlist `r(varlist)'

. forvalues j=1/`: list sizeof varlist' {
  2.   local v : word `j' of `varlist'
  3.   _ms_parse_parts `v'
  4.   if !r(omit) local varlist1 `"`varlist1' `v'"'
  5. }

. local varlist : copy local varlist1

. 
. // file for testing in R
. if 0 {
.   fvrevar `varlist'
.   export delimited `treatvar' `r(varlist)' `wgtvar' using testfile.csv if `tousevar', replace nolabel
. }

. 
. 
. // *******************************
. // * RUN MODELS DIRECTLY IN MATA *
. // *******************************
. 
. mata:
------------------------------------------------- mata (type end to exit) --------------------------------------------------------------------------------------
: 
: depvars  = st_local("depvars" )

: treatvar = st_local("treatvar")

: wgtvar   = st_local("wgtvar"  )

: varlist  = st_local("varlist" )

: tousevar = st_local("tousevar")

: estimate = st_local("estimate")

: 
: // * UNWEIGHTED DATA EXAMPLES *
: 
: D = gmatch()

: D.set(treatvar, varlist, tousevar)
  408 control obs
  92 treatment obs
  (Data are unweighted.)

: if (depvars!="") D.set_Y(depvars,tousevar)
> 
> // Misc balance measures
>   D.diff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.2826086957   -.0160912191   -.0223785166   -.0603154305   -1.101236147   -1.289748508    .1626172208    .1457104569   -.0812723301    .0681588142
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0461833248   -.1459731942   -.0148968728  |
     ----------------------------------------------+

:   D.stddiff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.563336463   -.1543415516   -.1526193687   -.1210072453    -.202287272   -.8035533326    .0457213254    .1527707004     -.08618905    .0648405717
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0493954389   -.1578414414    -.016298459  |
     ----------------------------------------------+

:   D.mean_asd()
  .1977078631

:   D.stddiff(1)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.563336463   -.1543415516   -.1526193687   -.1210072453    -.202287272   -.8035533326    .0457213254    .1527707004     -.08618905    .0648405717
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0493954389   -.1578414414    -.016298459  |
     ----------------------------------------------+

:   D.stddiff(0)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.6518565108   -.0992258067   -.1088403741    -.120488729   -.1874830308   -.5658268397    .0492441608    .1472428581   -.0808153611    .0677010963
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0466680215   -.1471098503   -.0148355423  |
     ----------------------------------------------+

:   D.varratio()
                 1             2             3             4             5             6             7             8             9            10
    +---------------------------------------------------------------------------------------------------------------------------------------------
  1 |  1.338962118   .4133172708   .5085817193   .9914483579   .8589874442   .4958355659   1.160037045   .9289414423   .8791918375   1.090178798
    +---------------------------------------------------------------------------------------------------------------------------------------------
                11            12            13
     -------------------------------------------+
  1    .8926168505   .8686432131   .8285405428  |
     -------------------------------------------+

:   D.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3444.538            3460.475           -15.93746            3460.475  |
  3 |          y1_binary            .9482656            .9607843           -.0125187            .9607843  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |  -15.93745522   -.0125187159  |
    +-------------------------------+

: 
:   "Balance table before matching"
  Balance table before matching

:   table = D.balancetable(1)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913          .75    -.2826087    -.5633365     .5016695     1.338962  |
   3 |        1.x2     .0108696     .0269608    -.0160912    -.1543416     .1042572     .4133173  |
   4 |        1.x3     .0217391     .0441176    -.0223785    -.1526194     .1466296     .5085817  |
   5 |          x4     .4347826      .495098    -.0603154    -.1210072     .4984448     .9914484  |
   6 |          x5     25.46739     26.56863    -1.101236    -.2022873     5.443922     .8589874  |
   7 |          x6     11.86957     13.15931    -1.289749    -.8035533     1.605057     .4958356  |
   8 |          x7     6.858696     6.696078     .1626172     .0457213     3.556704     1.160037  |
   9 |         x90     .0972024     -.048508     .1457105     .1527707     .9537854     .9289414  |
  10 |         x91    -.0890157    -.0077434    -.0812723    -.0861891     .9429542     .8791918  |
  11 |         x92     .0453787    -.0227801     .0681588     .0648406     1.051175     1.090179  |
  12 |         x93     .0865687     .0403853     .0461833     .0493954     .9349714     .8926169  |
  13 |         x94    -.1299173     .0160559    -.1459732    -.1578414     .9248091     .8686432  |
  14 |         x95    -.0807251    -.0658282    -.0148969    -.0162985      .914005     .8285405  |
     +--------------------------------------------------------------------------------------------+

: 
: // Replicate CBPS
: 
:   "--- ATE (not overidentified) ---"; ""; ""
  --- ATE (not overidentified) ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , ate      logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .00647386  
Iteration 1:   f(p) =  .00451406  
Iteration 2:   f(p) =   .0005336  
Iteration 3:   f(p) =  .00001373  
Iteration 4:   f(p) =  2.637e-08  
Iteration 5:   f(p) =  6.777e-13  
Iteration 6:   f(p) =  1.066e-21  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.441064   .5046768    -2.86   0.004    -2.430213   -.4519161
        1.x2 |  -2.548784   3.501511    -0.73   0.467     -9.41162    4.314051
        1.x3 |   -1.02318   2.005094    -0.51   0.610    -4.953091    2.906732
          x4 |  -.2320966   .5678014    -0.41   0.683    -1.344967    .8807737
          x5 |   .0736983    .042799     1.72   0.085    -.0101862    .1575829
          x6 |  -.4863391   .1923869    -2.53   0.011    -.8634106   -.1092676
          x7 |   .0655415   .0720901     0.91   0.363    -.0757525    .2068354
         x90 |   .0303861    .203675     0.15   0.881    -.3688096    .4295819
         x91 |  -.0236437   .2499136    -0.09   0.925    -.5134655     .466178
         x92 |   .2014652   .2092517     0.96   0.336    -.2086606    .6115911
         x93 |  -.0067202   .2511949    -0.03   0.979    -.4990531    .4856126
         x94 |  -.3662317   .2431817    -1.51   0.132     -.842859    .1103956
         x95 |  -.0080118   .2531324    -0.03   0.975    -.5041423    .4881187
       _cons |   3.127763   1.826429     1.71   0.087    -.4519713    6.707497
------------------------------------------------------------------------------

:     stata(`"cbps_imbalance"')
Total average covariate imbalance: 1.5e-10
Average covariate imbalance on the treated: 1.26

:     D.cbps("ate", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  2.590e-08  
Iteration 1:   f(p) =  2.548e-08  (backed up)
Iteration 2:   f(p) =  1.980e-08  
Iteration 3:   f(p) =  1.652e-08  
Iteration 4:   f(p) =  1.627e-08  
Iteration 5:   f(p) =  1.540e-08  
Iteration 6:   f(p) =  1.451e-08  
Iteration 7:   f(p) =  1.377e-08  
Iteration 8:   f(p) =  1.290e-08  
Iteration 9:   f(p) =  1.195e-08  
Iteration 10:  f(p) =  1.168e-08  
Iteration 11:  f(p) =  1.075e-08  
(switching technique to nr)
Iteration 12:  f(p) =  1.026e-08  
Iteration 13:  f(p) =  7.037e-09  
Iteration 14:  f(p) =  2.042e-10  
Iteration 15:  f(p) =  1.083e-12  
Iteration 16:  f(p) =  4.352e-17  
Iteration 17:  f(p) =  3.960e-25  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.441064364   -2.548784375   -1.023179787   -.2320965899    .0736983183   -.4863390836    .0655414714    .0303861209   -.0236437103    .2014652341
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1    -.0067202316   -.3662316849   -.0080118221    3.127762798  |
     -------------------------------------------------------------+

:     D.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6750468      .6750468      1.72e-11      3.66e-11      .4688264      1.008511  |
   3 |         1.x2      .0219357      .0219357      1.15e-11      7.84e-11      .1466203      1.008511  |
   4 |         1.x3      .0370067      .0370067      2.40e-10      1.27e-09      .1889672      1.008511  |
   5 |           x4      .4861037      .4861037      5.20e-11      1.04e-10      .5003074      1.008511  |
   6 |           x5      26.25386      26.25386      2.87e-11      4.57e-12      6.268993      .6747771  |
   7 |           x6      12.63471      12.63471      4.25e-10      1.81e-10      2.343236      .5637225  |
   8 |           x7      6.724952      6.724952     -2.27e-10     -6.75e-11      3.360602      1.190087  |
   9 |          x90     -.0592246     -.0592246      6.94e-11      6.65e-11      1.042785      1.206644  |
  10 |          x91      .0116973      .0116973     -1.60e-10     -1.63e-10      .9810721      .9436962  |
  11 |          x92     -.0041245     -.0041245     -4.41e-11     -4.33e-11      1.020036      1.339887  |
  12 |          x93      .0443809      .0443809      3.13e-11      3.24e-11      .9681889      .8469644  |
  13 |          x94     -.0856689     -.0856689     -1.31e-11     -1.29e-11      1.015864      .7767335  |
  14 |          x95     -.0859154     -.0859154     -5.96e-12     -6.11e-12      .9766877      .8347645  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.29325e-20
  Mean absolute standardized diff.
  1.58820e-10
  Maximum absolute standardized diff.
  1.26794e-09
  C.V. of matching weights:
  .5275374066
  S.D. of matching weights:
  .5275374066
  Skewness of matching weights:
  .2158747756
  Kurtosis of matching weights:
  .0860729366
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3444.163            3444.163           -3.58e-08            3444.163  |
  3 |          y1_binary            .9544751            .9544751            1.12e-12            .9544751  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATE overidentified ---"; ""; ""
  --- ATE overidentified ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , ate over logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .02441999  (not concave)
Iteration 1:   f(p) =    .020112  
Iteration 2:   f(p) =  .01484746  
Iteration 3:   f(p) =   .0142955  
Iteration 4:   f(p) =  .01428412  
Iteration 5:   f(p) =  .01428407  
Iteration 6:   f(p) =  .01428407  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.074574   .2572873    -4.18   0.000    -1.578848      -.5703
        1.x2 |  -1.732571    .847337    -2.04   0.041    -3.393321   -.0718214
        1.x3 |   -.535995   .6259896    -0.86   0.392    -1.762912    .6909221
          x4 |  -.2389831   .2458124    -0.97   0.331    -.7207666    .2428004
          x5 |   .0484453   .0243181     1.99   0.046     .0007828    .0961078
          x6 |  -.2519975   .0459113    -5.49   0.000    -.3419819    -.162013
          x7 |   .0081703   .0322545     0.25   0.800    -.0550474    .0713879
         x90 |    .120204   .1075227     1.12   0.264    -.0905366    .3309445
         x91 |  -.1467757   .1099013    -1.34   0.182    -.3621782    .0686269
         x92 |   .1315867   .1151671     1.14   0.253    -.0941367    .3573101
         x93 |    .086207   .1113523     0.77   0.439    -.1320395    .3044534
         x94 |  -.1702521    .103099    -1.65   0.099    -.3723225    .0318183
         x95 |   .0217906    .112224     0.19   0.846    -.1981643    .2417456
       _cons |   1.206345   .6074599     1.99   0.047      .015746    2.396945
------------------------------------------------------------------------------
J test for overidentifying restrictions: P(chisq>7.142, 14) = 0.929

:     stata(`"cbps_imbalance"')
Total average covariate imbalance: .313
Average covariate imbalance on the treated: .168

:     D.cbps("ate", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  9.768e-08  
Iteration 1:   f(p) =  9.599e-08  (backed up)
Iteration 2:   f(p) =  7.672e-08  
Iteration 3:   f(p) =  6.399e-08  
Iteration 4:   f(p) =  6.304e-08  
Iteration 5:   f(p) =  6.026e-08  
Iteration 6:   f(p) =  5.854e-08  
Iteration 7:   f(p) =  5.801e-08  
Iteration 8:   f(p) =  5.780e-08  
Iteration 9:   f(p) =  5.775e-08  
Iteration 10:  f(p) =  5.764e-08  
Iteration 11:  f(p) =  5.743e-08  
(switching technique to nr)
Iteration 12:  f(p) =  5.722e-08  
Iteration 13:  f(p) =  5.714e-08  
Iteration 14:  f(p) =  5.714e-08  
Iteration 15:  f(p) =  5.714e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.074573785    -1.73257095   -.5359949351     -.23898303    .0484452934   -.2519974261    .0081702571    .1202039716   -.1467756596    .1315866934
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0862070169   -.1702520909     .021790637    1.206345174  |
     -------------------------------------------------------------+

:     D.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6406563      .7027893      -.062133     -.1343718      .4623962      1.111543  |
   3 |         1.x2      .0157701      .0233767     -.0076067     -.0518322      .1467555      .6856459  |
   4 |         1.x3       .024807      .0398362     -.0150293     -.0794675      .1891246      .6378543  |
   5 |           x4      .4886894      .4862356      .0024538      .0049044      .5003233      1.008759  |
   6 |           x5      25.82556      26.34781     -.5222463      -.087499      5.968599        .75999  |
   7 |           x6      12.33004       12.9064     -.5763641     -.2576164      2.237296      .5881093  |
   8 |           x7       6.88452      6.669732      .2147883      .0639215      3.360189      1.180429  |
   9 |          x90     -.0713183     -.0265029     -.0448154     -.0441805      1.014371      1.157748  |
  10 |          x91      .0200089     -.0226109      .0426199       .043028      .9905145      .9174008  |
  11 |          x92      .0040221     -.0083767      .0123988       .012151      1.020391      1.200576  |
  12 |          x93      .0229491       .055179       -.03223     -.0331899      .9710769      .8891008  |
  13 |          x94      -.121595     -.0231316     -.0984633     -.0994521       .990058      .8143466  |
  14 |          x95     -.0950136      -.071595     -.0234187     -.0239408      .9781897      .8041468  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0027971508
  Mean absolute standardized diff.
  .0719657756
  Maximum absolute standardized diff.
  .2576163783
  C.V. of matching weights:
  .2958975504
  S.D. of matching weights:
  .2958975504
  Skewness of matching weights:
  .1574497662
  Kurtosis of matching weights:
  .0654318582
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3443.444            3453.946           -10.50205            3453.946  |
  3 |          y1_binary            .9509072            .9588221           -.0079149            .9588221  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET (not overidentified) ---"; ""; ""
  --- ATET (not overidentified) ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , att      logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .00197031  
Iteration 1:   f(p) =  .00006892  
Iteration 2:   f(p) =  1.777e-07  
Iteration 3:   f(p) =  2.570e-12  
Iteration 4:   f(p) =  6.940e-22  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.339291   .3615444    -3.70   0.000    -2.047905   -.6306769
        1.x2 |  -1.525175    1.19071    -1.28   0.200    -3.858923    .8085728
        1.x3 |  -.5996277   .8424377    -0.71   0.477    -2.250775     1.05152
          x4 |  -.3183658   .3103113    -1.03   0.305    -.9265647    .2898331
          x5 |   .0587883     .02835     2.07   0.038     .0032234    .1143533
          x6 |  -.2435676   .0675718    -3.60   0.000    -.3760059   -.1111292
          x7 |   .0341034   .0400884     0.85   0.395    -.0444685    .1126752
         x90 |    .158599   .1286436     1.23   0.218    -.0935378    .4107357
         x91 |  -.1617619    .131618    -1.23   0.219    -.4197284    .0962045
         x92 |   .1391156   .1358437     1.02   0.306    -.1271333    .4053644
         x93 |   .0571151    .134574     0.42   0.671    -.2066451    .3208752
         x94 |  -.1175052   .1193236    -0.98   0.325    -.3513752    .1163649
         x95 |    .011505   .1383574     0.08   0.934    -.2596705    .2826805
       _cons |    .782858    .962964     0.81   0.416    -1.104517    2.670233
------------------------------------------------------------------------------

:     stata(`"cbps_imbalance"')
Total average covariate imbalance: .374
Average covariate imbalance on the treated: 1.1e-10

:     D.cbps("atet", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  7.881e-09  
Iteration 1:   f(p) =  7.799e-09  (backed up)
Iteration 2:   f(p) =  7.301e-09  
Iteration 3:   f(p) =  5.045e-09  
Iteration 4:   f(p) =  4.162e-09  
Iteration 5:   f(p) =  3.700e-09  
Iteration 6:   f(p) =  3.063e-09  
Iteration 7:   f(p) =  2.655e-09  
Iteration 8:   f(p) =  2.353e-09  
Iteration 9:   f(p) =  2.232e-09  
Iteration 10:  f(p) =  1.928e-09  
Iteration 11:  f(p) =  1.687e-09  
(switching technique to nr)
Iteration 12:  f(p) =  1.155e-09  
Iteration 13:  f(p) =  8.181e-12  
Iteration 14:  f(p) =  4.655e-16  
Iteration 15:  f(p) =  2.607e-24  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.339290927   -1.525175229   -.5996277399   -.3183658287    .0587883339   -.2435675677    .0341033606    .1585989692   -.1617619473    .1391155704
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0571150775   -.1175051975    .0115050157    .7828580418  |
     -------------------------------------------------------------+

:     D.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4673913     -1.38e-10     -2.77e-10      .4994352      1.008511  |
   3 |         1.x2      .0108696      .0108696     -7.66e-11     -7.38e-10      .1037929      1.008511  |
   4 |         1.x3      .0217391      .0217391     -8.17e-11     -5.60e-10      .1459766      1.008511  |
   5 |           x4      .4347826      .4347826     -4.03e-10     -8.12e-10      .4962249      1.008511  |
   6 |           x5      25.46739      25.46739     -1.76e-09     -2.65e-10      6.664728      .6195799  |
   7 |           x6      11.86957      11.86957     -1.98e-09     -9.69e-10      2.043536      .5669465  |
   8 |           x7      6.858696      6.858696     -1.77e-10     -5.27e-11      3.363971      1.145237  |
   9 |          x90      .0972024      .0972024      4.54e-11      4.44e-11      1.021603       .845302  |
  10 |          x91     -.0890157     -.0890157     -3.25e-11     -3.40e-11      .9556678      .9654928  |
  11 |          x92      .0453787      .0453787      4.05e-11      4.06e-11      .9971707      1.136731  |
  12 |          x93      .0865687      .0865687     -6.32e-11     -6.65e-11        .95074      .9577067  |
  13 |          x94     -.1299173     -.1299173      5.29e-10      5.16e-10       1.02511      .7795321  |
  14 |          x95     -.0807251     -.0807251      8.07e-11      8.42e-11      .9586344      .8888006  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  5.64497e-20
  Mean absolute standardized diff.
  3.42968e-10
  Maximum absolute standardized diff.
  9.69352e-10
  C.V. of matching weights:
  .9884371288
  S.D. of matching weights:
  .9884371288
  Skewness of matching weights:
  .1100078305
  Kurtosis of matching weights:
  .0225364399
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.753            3424.753           -7.80e-09            3424.753  |
  3 |          y1_binary            .9470393            .9470393           -1.14e-11            .9470393  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET overidentified ---"; ""; ""
  --- ATET overidentified ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , att over logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .04521356  
Iteration 1:   f(p) =  .03210384  
Iteration 2:   f(p) =   .0303286  
Iteration 3:   f(p) =   .0302734  
Iteration 4:   f(p) =  .03027339  
Iteration 5:   f(p) =  .03027339  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.171988   .2187737    -5.36   0.000    -1.600776   -.7431991
        1.x2 |  -1.909814   .6607307    -2.89   0.004    -3.204822   -.6148052
        1.x3 |  -.4402667   .7269474    -0.61   0.545    -1.865057     .984524
          x4 |  -.3130788   .2251092    -1.39   0.164    -.7542848    .1281272
          x5 |   .0503881   .0191417     2.63   0.008     .0128711    .0879051
          x6 |  -.2393185   .0575186    -4.16   0.000     -.352053   -.1265841
          x7 |   .0261168   .0311563     0.84   0.402    -.0349484    .0871821
         x90 |   .1425533   .1007579     1.41   0.157    -.0549285    .3400351
         x91 |  -.1282785   .1127153    -1.14   0.255    -.3491964    .0926393
         x92 |      .1073   .1112316     0.96   0.335    -.1107099    .3253099
         x93 |   .0527165   .1101053     0.48   0.632    -.1630859    .2685189
         x94 |  -.1248021   .0971592    -1.28   0.199    -.3152305    .0656263
         x95 |   .0220743   .1115296     0.20   0.843    -.1965196    .2406683
       _cons |   .9132207   .6048419     1.51   0.131    -.2722476    2.098689
------------------------------------------------------------------------------
J test for overidentifying restrictions: P(chisq>15.137, 14) = 0.369

:     stata(`"cbps_imbalance"')
Total average covariate imbalance:  .34
Average covariate imbalance on the treated: .073

:     D.cbps("atet", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  1.809e-07  
Iteration 1:   f(p) =  1.775e-07  (backed up)
Iteration 2:   f(p) =  1.749e-07  
Iteration 3:   f(p) =  1.665e-07  
Iteration 4:   f(p) =  1.593e-07  
Iteration 5:   f(p) =  1.436e-07  
Iteration 6:   f(p) =  1.400e-07  
Iteration 7:   f(p) =  1.356e-07  
Iteration 8:   f(p) =  1.328e-07  
Iteration 9:   f(p) =  1.272e-07  
Iteration 10:  f(p) =  1.231e-07  
Iteration 11:  f(p) =  1.224e-07  
(switching technique to nr)
Iteration 12:  f(p) =  1.220e-07  
Iteration 13:  f(p) =  1.211e-07  
Iteration 14:  f(p) =  1.211e-07  
Iteration 15:  f(p) =  1.211e-07  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.171987636   -1.909811021   -.4402666692   -.3130787803    .0503880832   -.2393185049    .0261168262     .142553296   -.1282785303      .10729995
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0527164662   -.1248020851    .0220743362    .9132203721  |
     -------------------------------------------------------------+

:     D.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4923283     -.0249369      -.049839      .5003503      1.004458  |
   3 |         1.x2      .0108696      .0074884      .0033811      .0376593      .0897825      1.458884  |
   4 |         1.x3      .0217391       .023711     -.0019719     -.0130452       .151158      .9265074  |
   5 |           x4      .4347826      .4386729     -.0038903     -.0078334      .4966326      1.006495  |
   6 |           x5      25.46739      25.45801      .0093781      .0014148      6.628535      .6273162  |
   7 |           x6      11.86957      11.89491     -.0253428     -.0123239        2.0564       .559006  |
   8 |           x7      6.858696      6.790863      .0678324      .0201339       3.36906      1.140985  |
   9 |          x90      .0972024      .0826851      .0145173      .0142151      1.021263      .8460037  |
  10 |          x91     -.0890157     -.0671192     -.0218965     -.0227622      .9619657      .9503048  |
  11 |          x92      .0453787      .0235132      .0218655      .0219385      .9966695      1.138269  |
  12 |          x93      .0865687      .0849356       .001633      .0017143      .9526181      .9531308  |
  13 |          x94     -.1299173     -.1339674      .0040501      .0039553      1.023979      .7815571  |
  14 |          x95     -.0807251     -.0745052     -.0062199     -.0064787      .9600495      .8856706  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  7.49047e-07
  Mean absolute standardized diff.
  .016408746
  Maximum absolute standardized diff.
  .0498389801
  C.V. of matching weights:
  .9155855842
  S.D. of matching weights:
  .9155855842
  Skewness of matching weights:
  .1040781457
  Kurtosis of matching weights:
  .0213437013
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.722            3428.063           -3.341108            3428.063  |
  3 |          y1_binary            .9470466            .9484255           -.0013789            .9484255  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // Other objective functions
:   D.cbps("atet","mean_sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00032638  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  8.089e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  5.298e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  1.466e-13  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  1.466e-13  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  1.466e-13  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 6:   f(p) =  1.466e-13  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  2.506e-15  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  5.073e-17  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  7.201e-18  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  6.086e-19  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  5.095e-19  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  2.126e-20  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  2.126e-20  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  2.126e-20  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  3.635e-22  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  2.172e-23  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  9.035e-24  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  1.164e-24  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  9.941e-25  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  3.682e-25  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  1.470e-25  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  4.609e-26  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  1.885e-26  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 34:  f(p) =  3.515e-27  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 35:  f(p) =  2.855e-27  (backed up)
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 36:  f(p) =  2.128e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 37:  f(p) =  2.126e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 38:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 39:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 40:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 41:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 42:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 43:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 44:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 45:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 46:  f(p) =  2.124e-27  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 47:  f(p) =  2.124e-27  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 48:  f(p) =  2.124e-27  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 49:  f(p) =  4.726e-29  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 50:  f(p) =  5.379e-31  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 51:  f(p) =  1.548e-31  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 52:  f(p) =  3.080e-32  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 53:  f(p) =  5.743e-33  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 54:  f(p) =  2.086e-33  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 55:  f(p) =  4.922e-34  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 56:  f(p) =  7.046e-35  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 57:  f(p) =  2.047e-35  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 58:  f(p) =  7.313e-36  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 59:  f(p) =  4.408e-36  (backed up)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.206443369   -1.628676255    -.580309938   -.2832336978     .069416312   -.2787869252    .0283208958    .1446874441   -.1322012754    .1288212848
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0633599596   -.1645468361    .0190734612    1.412502861  |
     -------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5065707    -.0391794     -.078098     .5016695     1.004395  |
   3 |        1.x2     .0108696     .0094032     .0014663     .0140645     .1042572     1.164051  |
   4 |        1.x3     .0217391     .0217076     .0000315     .0002149     .1466296     1.009942  |
   5 |          x4     .4347826     .4181832     .0165994     .0333023     .4984448     1.018628  |
   6 |          x5     25.46739     26.05541      -.58802     -.108014     5.443922      .583267  |
   7 |          x6     11.86957     11.79935     .0702179     .0437479     1.605057     .5528994  |
   8 |          x7     6.858696     6.775281     .0834144     .0234527     3.556704     1.141156  |
   9 |         x90     .0972024     .0569964      .040206     .0421541     .9537854     .8487821  |
  10 |         x91    -.0890157     -.062197    -.0268186    -.0284411     .9429542     .9668971  |
  11 |         x92     .0453787     .0391246     .0062541     .0059496     1.051175     1.151879  |
  12 |         x93     .0865687     .1044403    -.0178716    -.0191146     .9349714     .9622808  |
  13 |         x94    -.1299173    -.1873487     .0574315     .0621009     .9248091     .7465145  |
  14 |         x95    -.0807251    -.0886593     .0079342     .0086807      .914005      .892775  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  4.40832e-36
  Mean absolute standardized diff.
  .0359488733
  Maximum absolute standardized diff.
  .1080140326
  C.V. of matching weights:
  1.041361442
  S.D. of matching weights:
  1.041361442
  Skewness of matching weights:
  .1710882156
  Kurtosis of matching weights:
  .0624918361
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.964            3426.474           -1.509908            3426.474  |
  3 |          y1_binary            .9468831            .9481476           -.0012646            .9481476  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .02141594  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .02005607  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01097598  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00782372  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00292673  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00193285  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00085471  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00063406  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00028285  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00013476  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00008047  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00006324  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =   .0000443  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  .00001382  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  .00001377  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  .00001245  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  .00001151  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  .00001044  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  9.678e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  7.828e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  6.452e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  5.631e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  5.432e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  5.071e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  4.310e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  3.407e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  1.712e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  6.134e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  3.341e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  2.852e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  4.053e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  1.870e-10  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  1.942e-13  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  3.595e-17  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.339290926   -1.525175229   -.5996277473   -.3183658389    .0587883337   -.2435675686    .0341033607    .1585989738   -.1617619475    .1391155698
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0571150759   -.1175051985    .0115050172    1.381947023  |
     -------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4673913     1.10e-10     2.18e-10     .5016695     1.008511  |
   3 |        1.x2     .0108696     .0108696    -8.24e-11    -7.90e-10     .1042572     1.008511  |
   4 |        1.x3     .0217391     .0217391     1.88e-11     1.29e-10     .1466296     1.008511  |
   5 |          x4     .4347826     .4347826     1.39e-09     2.80e-09     .4984448     1.008511  |
   6 |          x5     25.46739     25.46739     6.86e-10     1.26e-10     5.443922     .6195799  |
   7 |          x6     11.86957     11.86957     9.76e-10     6.08e-10     1.605057     .5669465  |
   8 |          x7     6.858696     6.858696    -8.89e-10    -2.50e-10     3.556704     1.145237  |
   9 |         x90     .0972024     .0972024    -4.22e-09    -4.43e-09     .9537854      .845302  |
  10 |         x91    -.0890157    -.0890157     4.82e-10     5.11e-10     .9429542     .9654928  |
  11 |         x92     .0453787     .0453787     8.26e-10     7.86e-10     1.051175     1.136731  |
  12 |         x93     .0865687     .0865687     7.17e-10     7.67e-10     .9349714     .9577067  |
  13 |         x94    -.1299173    -.1299173     2.14e-09     2.31e-09     .9248091     .7795321  |
  14 |         x95    -.0807251    -.0807251    -6.81e-10    -7.45e-10      .914005     .8888006  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  2.46464e-20
  Mean absolute standardized diff.
  1.11297e-09
  Maximum absolute standardized diff.
  4.42890e-09
  C.V. of matching weights:
  .9884371331
  S.D. of matching weights:
  .9884371331
  Skewness of matching weights:
  .1100078314
  Kurtosis of matching weights:
  .0225364402
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.753            3424.753            1.62e-08            3424.753  |
  3 |          y1_binary            .9470393            .9470393           -6.21e-12            .9470393  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // IPW
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , atet aequations")

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  4.978e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Treated vs Untreated)  |  -365.5251   68.93598    -5.30   0.000    -500.6371   -230.4131
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3417.895   43.41569    78.72   0.000     3332.801    3502.988
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.207512   .3268258    -3.69   0.000    -1.848079   -.5669452
                        |
                     x2 |
                     1  |  -1.628792   1.054719    -1.54   0.123    -3.696005    .4384199
                        |
                     x3 |
                     1  |  -.5805318   .8259794    -0.70   0.482    -2.199422    1.038358
                     x4 |  -.2831153   .2838113    -1.00   0.318    -.8393752    .2731445
                     x5 |   .0545179   .0270259     2.02   0.044     .0015481    .1074878
                     x6 |  -.2844593   .0688093    -4.13   0.000     -.419323   -.1495955
                     x7 |    .023871   .0390129     0.61   0.541    -.0525929    .1003349
                    x90 |   .1439494   .1292697     1.11   0.265    -.1094145    .3973133
                    x91 |  -.1331182   .1248073    -1.07   0.286    -.3777361    .1114997
                    x92 |   .1277527    .133834     0.95   0.340    -.1345572    .3900625
                    x93 |   .0623585   .1243317     0.50   0.616    -.1813271    .3060441
                    x94 |  -.1663354   .1194682    -1.39   0.164    -.4004887    .0678179
                    x95 |    .017776   .1254901     0.14   0.887    -.2281801     .263732
                  _cons |   1.379538   .9297905     1.48   0.138    -.4428177    3.201894
-----------------------------------------------------------------------------------------

:   stata("di _b[POmean:0.treat]")
3417.8947

:   stata("tebalance summarize")

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        247.8
                          Control obs   =          408        252.2
                          -----------------------------------------

  -----------------------------------------------------------------
                  |Standardized differences          Variance ratio
                  |        Raw    Weighted           Raw   Weighted
  ----------------+------------------------------------------------
               x1 |  -.6027752   -.0090577      1.338962   .9989677
                  |
               x2 |
               1  |  -.1180374    .0096998      .4133173   1.098626
                  |
               x3 |
               1  |  -.1253201    .0022927      .5085817   1.015318
                  |
               x4 |  -.1207472   -.0222549      .9914484   .9947225
               x5 |  -.1944638    .0308855      .8589874   .5917507
               x6 |  -.6542694    .0952268      .4958356   .5601212
               x7 |   .0473848    .0429284      1.160037   1.132231
              x90 |   .1499304    .0130255      .9289414   .8182649
              x91 |  -.0833726   -.0288848      .8791918   .9584288
              x92 |   .0662245    .0110605      1.090179   1.139468
              x93 |   .0479737   -.0087695      .8926169   .9659809
              x94 |  -.1521926    .0562648      .8686432   .7583723
              x95 |  -.0155155     .017858      .8285405   .8879817
  -----------------------------------------------------------------

:   stata("tebalance summarize, baseline")

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        247.8
                          Control obs   =          408        252.2
                          -----------------------------------------

  -----------------------------------------------------------------
                  |           Means                  Variances     
                  |    Control     Treated       Control    Treated
  ----------------+------------------------------------------------
               x1 |        .75    .4673913      .1879607   .2516722
                  |
               x2 |
               1  |   .0269608    .0108696      .0262984   .0108696
                  |
               x3 |
               1  |   .0441176    .0217391      .0422749   .0215002
                  |
               x4 |    .495098    .4347826      .2505902   .2484472
               x5 |   26.56863    25.46739      34.50142   29.63629
               x6 |   13.15931    11.86957      5.195687   2.576206
               x7 |   6.696078    6.858696      10.90495   12.65014
              x90 |   -.048508    .0972024      .9792937   .9097065
              x91 |  -.0077434   -.0890157      1.011341   .8891627
              x92 |  -.0227801    .0453787      1.013567    1.10497
              x93 |   .0403853    .0865687      .9793358   .8741716
              x94 |   .0160559   -.1299173      .9846065   .8552718
              x95 |  -.0658282   -.0807251      1.008285   .8354051
  -----------------------------------------------------------------

: 
:   D.ipw("atet")
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888   -1.628789297   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406   -.1331181675    .1277525862
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------+

:   D.balanceresults("atet")
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4719209     -.0045296     -.0090652      .4996633      1.007399  |
   3 |         1.x2      .0108696      .0098847      .0009849      .0098566      .0999227      1.107894  |
   4 |         1.x3      .0217391      .0214054      .0003337      .0023004      .1450795      1.023886  |
   5 |           x4      .4347826       .445852     -.0110694     -.0222576      .4973308      1.003118  |
   6 |           x5      25.46739      25.27307      .1943233      .0286772      6.776222       .596745  |
   7 |           x6      11.86957      11.68981      .1797533      .0877664      2.048089      .5648484  |
   8 |           x7      6.858696      6.711046      .1476493      .0438323      3.368502      1.141787  |
   9 |          x90      .0972024      .0841522      .0130502       .012645      1.032043      .8251709  |
  10 |          x91     -.0890157     -.0615794     -.0274362     -.0287197      .9553102      .9665176  |
  11 |          x92      .0453787      .0341522      .0112265      .0113068       .992897      1.149085  |
  12 |          x93      .0865687      .0948113     -.0082427     -.0087305        .94412      .9741335  |
  13 |          x94     -.1299173     -.1857505      .0558332      .0540116      1.033726      .7647728  |
  14 |          x95     -.0807251     -.0974964      .0167713      .0175493      .9556712      .8954759  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0002347319
  Mean absolute standardized diff.
  .0259014405
  Maximum absolute standardized diff.
  .0877663582
  C.V. of matching weights:
  1.041445132
  S.D. of matching weights:
  1.041445132
  Skewness of matching weights:
  .1334759569
  Kurtosis of matching weights:
  .0358990805
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.454            3417.895            6.559175            3417.895  |
  3 |          y1_binary            .9470413            .9465176            .0005237            .9465176  |
    +-----------------------------------------------------------------------------------------------------+

:   table = D.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4673913     .4719209    -.0045296    -.0090456     .5007475     1.007399  |
   3 |        1.x2     .0108696     .0098847     .0009849     .0096855     .1016872     1.107894  |
   4 |        1.x3     .0217391     .0214054     .0003337     .0022895     .1457719     1.023886  |
   5 |          x4     .4347826      .445852    -.0110694    -.0222252     .4980573     1.003118  |
   6 |          x5     25.46739     25.27307     .1943233     .0308606     6.296806      .596745  |
   7 |          x6     11.86957     11.68981     .1797533     .0951549     1.889059     .5648484  |
   8 |          x7     6.858696     6.711046     .1476493      .042865     3.444517     1.141787  |
   9 |         x90     .0972024     .0841522     .0130502     .0130107     1.003034     .8251709  |
  10 |         x91    -.0890157    -.0615794    -.0274362    -.0288473     .9510857     .9665176  |
  11 |         x92     .0453787     .0341522     .0112265     .0110442     1.016508     1.149085  |
  12 |         x93     .0865687     .0948113    -.0082427     -.008758     .9411576     .9741335  |
  13 |         x94    -.1299173    -.1857505     .0558332     .0562053     .9933796     .7647728  |
  14 |         x95    -.0807251    -.0974964     .0167713     .0178362     .9402985     .8954759  |
     +--------------------------------------------------------------------------------------------+

:   D.reweight()

:   table = D.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4673913          .75    -.2826087    -.6027752     .4688459     1.338962  |
   3 |        1.x2     .0108696     .0269608    -.0160912    -.1180374      .136323     .4133173  |
   4 |        1.x3     .0217391     .0441176    -.0223785    -.1253201     .1785709     .5085817  |
   5 |          x4     .4347826      .495098    -.0603154    -.1207472     .4995185     .9914484  |
   6 |          x5     25.46739     26.56863    -1.101236    -.1944638     5.662937     .8589874  |
   7 |          x6     11.86957     13.15931    -1.289749    -.6542694      1.97128     .4958356  |
   8 |          x7     6.858696     6.696078     .1626172     .0473848     3.431843     1.160037  |
   9 |         x90     .0972024     -.048508     .1457105     .1499304      .971854     .9289414  |
  10 |         x91    -.0890157    -.0077434    -.0812723    -.0833726     .9748086     .8791918  |
  11 |         x92     .0453787    -.0227801     .0681588     .0662245     1.029208     1.090179  |
  12 |         x93     .0865687     .0403853     .0461833     .0479737     .9626805     .8926169  |
  13 |         x94    -.1299173     .0160559    -.1459732    -.1521926     .9591346     .8686432  |
  14 |         x95    -.0807251    -.0658282    -.0148969    -.0155155     .9601277     .8285405  |
     +--------------------------------------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , ate aequations")

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  1.612e-25  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATE                     |
                  treat |
(Treated vs Untreated)  |   -328.878   82.21905    -4.00   0.000    -490.0244   -167.7316
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3452.527   28.58753   120.77   0.000     3396.497    3508.558
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.207512   .3268258    -3.69   0.000    -1.848079   -.5669452
                        |
                     x2 |
                     1  |  -1.628792   1.054719    -1.54   0.123    -3.696005    .4384199
                        |
                     x3 |
                     1  |  -.5805318   .8259794    -0.70   0.482    -2.199422    1.038358
                     x4 |  -.2831153   .2838113    -1.00   0.318    -.8393752    .2731445
                     x5 |   .0545179   .0270259     2.02   0.044     .0015481    .1074878
                     x6 |  -.2844593   .0688093    -4.13   0.000     -.419323   -.1495955
                     x7 |    .023871   .0390129     0.61   0.541    -.0525929    .1003349
                    x90 |   .1439494   .1292697     1.11   0.265    -.1094145    .3973133
                    x91 |  -.1331182   .1248073    -1.07   0.286    -.3777361    .1114997
                    x92 |   .1277527    .133834     0.95   0.340    -.1345572    .3900625
                    x93 |   .0623585   .1243317     0.50   0.616    -.1813271    .3060441
                    x94 |  -.1663354   .1194682    -1.39   0.164    -.4004887    .0678179
                    x95 |    .017776   .1254901     0.14   0.887    -.2281801     .263732
                  _cons |   1.379538   .9297905     1.48   0.138    -.4428177    3.201894
-----------------------------------------------------------------------------------------

:   D.ipw("ate")
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888   -1.628789297   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406   -.1331181675    .1277525862
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------+

:   D.balanceresults("ate")
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6643106      .6980937     -.0337831     -.0730952      .4621798      1.067096  |
   3 |         1.x2      .0126474      .0237734      -.011126     -.0762399       .145934      .5426396  |
   4 |         1.x3      .0252967      .0398782     -.0145815     -.0769757      .1894293      .6494649  |
   5 |           x4      .5035684      .4859058      .0176626      .0352982       .500383      1.009262  |
   6 |           x5      25.88638       26.3268     -.4404207     -.0736253       5.98192      .7436049  |
   7 |           x6      12.40345      12.88502     -.4815643      -.214612      2.243884      .5994444  |
   8 |           x7      6.783391      6.698872      .0845182      .0251498       3.36059      1.188955  |
   9 |          x90     -.1279394     -.0237456     -.1041937     -.1022979      1.018533      1.179133  |
  10 |          x91      .0259183     -.0177924      .0437107      .0442269      .9883275      .9105384  |
  11 |          x92      .0197006     -.0121531      .0318537      .0312437      1.019527      1.201641  |
  12 |          x93      .0303493      .0505445     -.0201952     -.0208151      .9702151      .8788976  |
  13 |          x94      -.142924     -.0216133     -.1213108     -.1226343      .9892079      .7980325  |
  14 |          x95     -.0930146     -.0717394     -.0212752     -.0217631      .9775833      .7971968  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0024703949
  Mean absolute standardized diff.
  .0706136183
  Maximum absolute standardized diff.
  .2146119676
  C.V. of matching weights:
  .3337259551
  S.D. of matching weights:
  .3337259551
  Skewness of matching weights:
  .1843123883
  Kurtosis of matching weights:
  .0838509706
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3442.587            3452.527           -9.940045            3452.527  |
  3 |          y1_binary            .9516224            .9581213           -.0064989            .9581213  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , atet aequations tlevel(0) control(1)")

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  3.813e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Untreated vs Treated)  |     319.07   91.15096     3.50   0.000     140.4174    497.7225
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
               Treated  |   3141.406   87.28586    35.99   0.000     2970.328    3312.483
------------------------+----------------------------------------------------------------
TME0                    |
                     x1 |   1.207512   .3268258     3.69   0.000     .5669452    1.848079
                        |
                     x2 |
                     1  |   1.628792   1.054719     1.54   0.123    -.4384199    3.696005
                        |
                     x3 |
                     1  |   .5805318   .8259794     0.70   0.482    -1.038358    2.199422
                     x4 |   .2831153   .2838113     1.00   0.318    -.2731445    .8393752
                     x5 |  -.0545179   .0270259    -2.02   0.044    -.1074878   -.0015481
                     x6 |   .2844593   .0688093     4.13   0.000     .1495955     .419323
                     x7 |   -.023871   .0390129    -0.61   0.541    -.1003349    .0525929
                    x90 |  -.1439494   .1292697    -1.11   0.265    -.3973133    .1094145
                    x91 |   .1331182   .1248073     1.07   0.286    -.1114997    .3777361
                    x92 |  -.1277527    .133834    -0.95   0.340    -.3900625    .1345572
                    x93 |  -.0623585   .1243317    -0.50   0.616    -.3060441    .1813271
                    x94 |   .1663354   .1194682     1.39   0.164    -.0678179    .4004887
                    x95 |   -.017776   .1254901    -0.14   0.887     -.263732    .2281801
                  _cons |  -1.379538   .9297905    -1.48   0.138    -3.201894    .4428177
-----------------------------------------------------------------------------------------

:   D.ipw("ateu")
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888   -1.628789297   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406   -.1331181675    .1277525862
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------+

:   D.balanceresults("ateu")
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .7133644           .75     -.0366356     -.0837821      .4372727      1.099818  |
   3 |         1.x2      .0130902      .0269608     -.0138706     -.0897954      .1544686      .4966403  |
   4 |         1.x3      .0261829      .0441176     -.0179347     -.0905493      .1980657       .609761  |
   5 |           x4      .5207033       .495098      .0256053      .0511594      .5005007      1.006879  |
   6 |           x5      25.99075      26.56863      -.577878     -.1002906      5.762036      .7963305  |
   7 |           x6      12.53645      13.15931     -.6228673     -.2813566        2.2138      .6382822  |
   8 |           x7      6.764632      6.696078      .0685532      .0204092      3.358927      1.200431  |
   9 |          x90     -.1840235      -.048508     -.1355155     -.1337092      1.013509      1.263776  |
  10 |          x91       .054549     -.0077434      .0622924      .0625861      .9953062      .8955527  |
  11 |          x92       .013304     -.0227801      .0360842      .0351881      1.025465       1.21557  |
  12 |          x93      .0163448      .0403853     -.0240406     -.0246383      .9757395       .857822  |
  13 |          x94     -.1461641      .0160559     -.1622201     -.1661874       .976127      .8119355  |
  14 |          x95      -.096076     -.0658282     -.0302478     -.0307892      .9824155      .7755988  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0040935914
  Mean absolute standardized diff.
  .0900339258
  Maximum absolute standardized diff.
  .2813566299
  C.V. of matching weights:
  .8301616273
  S.D. of matching weights:
  .8301616273
  Skewness of matching weights:
  .2680619555
  Kurtosis of matching weights:
  .1550433574
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3447.97            3460.475           -12.50512            3460.475  |
  3 |          y1_binary            .9524694            .9607843           -.0083149            .9607843  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // tradeoff between CBPS-like balance and variance in weights
:   D.cbps("atet","cbps", 1, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  7.881e-09  
Iteration 1:   f(p) =  7.799e-09  (backed up)
Iteration 2:   f(p) =  7.301e-09  
Iteration 3:   f(p) =  5.045e-09  
Iteration 4:   f(p) =  4.162e-09  
Iteration 5:   f(p) =  3.700e-09  
Iteration 6:   f(p) =  3.063e-09  
Iteration 7:   f(p) =  2.655e-09  
Iteration 8:   f(p) =  2.353e-09  
Iteration 9:   f(p) =  2.232e-09  
Iteration 10:  f(p) =  1.928e-09  
Iteration 11:  f(p) =  1.687e-09  
(switching technique to nr)
Iteration 12:  f(p) =  1.155e-09  
Iteration 13:  f(p) =  8.181e-12  
Iteration 14:  f(p) =  4.655e-16  
Iteration 15:  f(p) =  2.607e-24  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.339290927   -1.525175229   -.5996277399   -.3183658287    .0587883339   -.2435675677    .0341033606    .1585989692   -.1617619473    .1391155704
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0571150775   -.1175051975    .0115050157    .7828580418  |
     -------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4673913    -1.38e-10    -2.76e-10     .5016695     1.008511  |
   3 |        1.x2     .0108696     .0108696    -7.66e-11    -7.34e-10     .1042572     1.008511  |
   4 |        1.x3     .0217391     .0217391    -8.17e-11    -5.57e-10     .1466296     1.008511  |
   5 |          x4     .4347826     .4347826    -4.03e-10    -8.08e-10     .4984448     1.008511  |
   6 |          x5     25.46739     25.46739    -1.76e-09    -3.24e-10     5.443922     .6195799  |
   7 |          x6     11.86957     11.86957    -1.98e-09    -1.23e-09     1.605057     .5669465  |
   8 |          x7     6.858696     6.858696    -1.77e-10    -4.99e-11     3.556704     1.145237  |
   9 |         x90     .0972024     .0972024     4.54e-11     4.76e-11     .9537854      .845302  |
  10 |         x91    -.0890157    -.0890157    -3.25e-11    -3.45e-11     .9429542     .9654928  |
  11 |         x92     .0453787     .0453787     4.05e-11     3.85e-11     1.051175     1.136731  |
  12 |         x93     .0865687     .0865687    -6.32e-11    -6.76e-11     .9349714     .9577067  |
  13 |         x94    -.1299173    -.1299173     5.29e-10     5.72e-10     .9248091     .7795321  |
  14 |         x95    -.0807251    -.0807251     8.07e-11     8.83e-11      .914005     .8888006  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  6.60027e-20
  Mean absolute standardized diff.
  3.71690e-10
  Maximum absolute standardized diff.
  1.23417e-09
  C.V. of matching weights:
  .9884371288
  S.D. of matching weights:
  .9884371288
  Skewness of matching weights:
  .1100078305
  Kurtosis of matching weights:
  .0225364399
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.753            3424.753           -7.80e-09            3424.753  |
  3 |          y1_binary            .9470393            .9470393           -1.14e-11            .9470393  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","cbps", 1, 0, (1,.75,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00061284  
Iteration 1:   f(p) =  2.180e-07  
Iteration 2:   f(p) =  1.269e-07  
Iteration 3:   f(p) =  1.206e-07  
Iteration 4:   f(p) =  1.176e-07  
Iteration 5:   f(p) =  1.170e-07  
Iteration 6:   f(p) =  1.170e-07  
Iteration 7:   f(p) =  1.161e-07  
Iteration 8:   f(p) =  8.900e-08  
Iteration 9:   f(p) =  8.301e-08  
Iteration 10:  f(p) =  8.238e-08  
Iteration 11:  f(p) =  8.232e-08  
(switching technique to nr)
Iteration 12:  f(p) =  8.209e-08  
Iteration 13:  f(p) =  7.516e-08  
Iteration 14:  f(p) =  6.789e-08  
Iteration 15:  f(p) =  4.227e-08  
Iteration 16:  f(p) =  2.563e-08  (not concave)
Iteration 17:  f(p) =  1.868e-08  (not concave)
Iteration 18:  f(p) =  1.309e-08  (not concave)
Iteration 19:  f(p) =  1.230e-08  
Iteration 20:  f(p) =  1.163e-08  
Iteration 21:  f(p) =  1.144e-08  
Iteration 22:  f(p) =  1.143e-08  
Iteration 23:  f(p) =  1.143e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.069921157   -1.301676324   -.4865722909   -.2463173344    .0447740691   -.1995635542    .0257331036    .1236240922   -.1270510658    .1015911479
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .047055079   -.0948947731    .0008498405    .4556068033  |
     -------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5182506    -.0508593    -.1013802     .5016695     1.005561  |
   3 |        1.x2     .0108696      .012455    -.0015855    -.0152072     .1042572     .8815459  |
   4 |        1.x3     .0217391     .0242826    -.0025435    -.0173465     .1466296     .9052272  |
   5 |          x4     .4347826     .4521395    -.0173569    -.0348222     .4984448      1.00052  |
   6 |          x5     25.46739     25.54157    -.0741742    -.0136251     5.443922     .6518318  |
   7 |          x6     11.86957     12.06656    -.1969952    -.1227341     1.605057     .5447873  |
   8 |          x7     6.858696     6.811629      .047067     .0132333     3.556704     1.145782  |
   9 |         x90     .0972024     .0715905     .0256119     .0268529     .9537854     .8605673  |
  10 |         x91    -.0890157    -.0737238    -.0152918    -.0162169     .9429542     .9393008  |
  11 |         x92     .0453787     .0269169     .0184618      .017563     1.051175     1.126957  |
  12 |         x93     .0865687     .0765419     .0100267     .0107241     .9349714     .9352735  |
  13 |         x94    -.1299173    -.0967909    -.0331264    -.0358197     .9248091      .797834  |
  14 |         x95    -.0807251    -.0889146     .0081896     .0089601      .914005     .8763149  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0004633043
  Mean absolute standardized diff.
  .0334219473
  Maximum absolute standardized diff.
  .1227341119
  C.V. of matching weights:
  .7780723145
  S.D. of matching weights:
  .7780723145
  Skewness of matching weights:
  .086726395
  Kurtosis of matching weights:
  .015619736
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3425.501            3432.853           -7.352076            3432.853  |
  3 |          y1_binary             .947131            .9496087           -.0024777            .9496087  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","cbps", 1, 0, (1,.50,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .02519572  
Iteration 1:   f(p) =  .00037232  
Iteration 2:   f(p) =  .00018115  
Iteration 3:   f(p) =  .00007047  
Iteration 4:   f(p) =  .00006335  
Iteration 5:   f(p) =  .00005995  
Iteration 6:   f(p) =  .00003158  
Iteration 7:   f(p) =  .00001706  
Iteration 8:   f(p) =  .00001448  
Iteration 9:   f(p) =  .00001017  
Iteration 10:  f(p) =  9.753e-06  
Iteration 11:  f(p) =  9.539e-06  
(switching technique to nr)
Iteration 12:  f(p) =  9.503e-06  (not concave)
Iteration 13:  f(p) =  6.245e-06  (not concave)
Iteration 14:  f(p) =  5.513e-06  (not concave)
Iteration 15:  f(p) =  3.248e-07  (not concave)
Iteration 16:  f(p) =  3.015e-07  (not concave)
Iteration 17:  f(p) =  2.755e-07  (not concave)
Iteration 18:  f(p) =  1.198e-07  (not concave)
Iteration 19:  f(p) =  9.067e-08  (not concave)
Iteration 20:  f(p) =  7.308e-08  (not concave)
Iteration 21:  f(p) =  5.794e-08  (not concave)
Iteration 22:  f(p) =  5.529e-08  
Iteration 23:  f(p) =  5.128e-08  
(switching technique to bfgs)
Iteration 24:  f(p) =  5.114e-08  
Iteration 25:  f(p) =  5.114e-08  
Iteration 26:  f(p) =  5.114e-08  
Iteration 27:  f(p) =  5.114e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.7224139993   -.9764863457   -.3663536237   -.1681586848    .0290491594   -.1459133251    .0167638142    .0854737183   -.0882828063    .0659836391
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0343202868   -.0658755344   -.0067121946   -.0849348977  |
     -------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5906749    -.1232836    -.2457466     .5016695     1.038371  |
   3 |        1.x2     .0108696     .0149903    -.0041207    -.0395247     .1042572     .7343374  |
   4 |        1.x3     .0217391     .0280492      -.00631    -.0430339     .1466296     .7867073  |
   5 |          x4     .4347826     .4668619    -.0320792    -.0643587     .4984448     .9957268  |
   6 |          x5     25.46739     25.77278    -.3053873    -.0560969     5.443922     .6996664  |
   7 |          x6     11.86957     12.34747     -.477904     -.297749     1.605057     .5220231  |
   8 |          x7     6.858696     6.764909     .0937864     .0263689     3.556704     1.148402  |
   9 |         x90     .0972024     .0379816     .0592208     .0620903     .9537854     .8843596  |
  10 |         x91    -.0890157    -.0569166    -.0320991     -.034041     .9429542     .9113449  |
  11 |         x92     .0453787      .011174     .0342047     .0325395     1.051175     1.115674  |
  12 |         x93     .0865687     .0661146      .020454     .0218766     .9349714     .9136067  |
  13 |         x94    -.1299173    -.0574346    -.0724827    -.0783758     .9248091     .8189413  |
  14 |         x95    -.0807251    -.0931506     .0124255     .0135946      .914005     .8623481  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0029197953
  Mean absolute standardized diff.
  .0781074249
  Maximum absolute standardized diff.
  .2977490236
  C.V. of matching weights:
  .5321355921
  S.D. of matching weights:
  .5321355921
  Skewness of matching weights:
  .062927853
  Kurtosis of matching weights:
  .0108020115
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3428.47            3442.757           -14.28672            3442.757  |
  3 |          y1_binary            .9474566            .9529479           -.0054914            .9529479  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","mean_sd_sq", 1, 0, (1,.75,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00093921  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00042753  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00003686  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00002767  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00001518  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  6.684e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  3.117e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  1.306e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  3.889e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  1.977e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  7.501e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  5.838e-08  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  4.674e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  4.275e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  4.460e-10  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  3.813e-11  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  1.676e-11  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  3.286e-13  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  9.610e-14  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  2.661e-14  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  4.888e-15  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  1.321e-15  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  5.316e-16  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  2.525e-16  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  1.242e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  9.015e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  7.958e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  7.886e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  6.704e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  5.120e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  5.010e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  4.996e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  4.378e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  4.059e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 34:  f(p) =  4.037e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 35:  f(p) =  4.035e-17  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.201676727   -1.648350684   -.6891126998   -.2535703993     .013437619   -.0743064685   -.0183205652    .0730708885   -.1318570593    .0667988243
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1    -.0158103811   -.1189470446    -.025908628    1.404817741  |
     -------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4844105    -.0170192    -.0339251     .5016695     1.005199  |
   3 |        1.x2     .0108696     .0086749     .0021947     .0210506     .1042572     1.260858  |
   4 |        1.x3     .0217391     .0172585     .0044806     .0305572     .1466296     1.264544  |
   5 |          x4     .4347826     .4902598    -.0554772    -.1113006     .4984448     .9917294  |
   6 |          x5     25.46739     24.82696     .6404269     .1176407     5.443922     .7360093  |
   7 |          x6     11.86957     12.34967    -.4801055    -.2991206     1.605057     .5291607  |
   8 |          x7     6.858696     6.355497     .5031987     .1414789     3.556704      1.13066  |
   9 |         x90     .0972024     .0662128     .0309897     .0324912     .9537854     .8440927  |
  10 |         x91    -.0890157    -.0857377     -.003278    -.0034763     .9429542     .9409264  |
  11 |         x92     .0453787     .0273471     .0180315     .0171537     1.051175     1.109174  |
  12 |         x93     .0865687     .0236051     .0629636     .0673428     .9349714     .9223614  |
  13 |         x94    -.1299173    -.1329455     .0030282     .0032744     .9248091     .8302999  |
  14 |         x95    -.0807251    -.0961106     .0153856     .0168331      .914005     .8707006  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  7.28684e-21
  Mean absolute standardized diff.
  .0688957931
  Maximum absolute standardized diff.
  .2991206009
  C.V. of matching weights:
  .7518519607
  S.D. of matching weights:
  .7518519607
  Skewness of matching weights:
  .0829073688
  Kurtosis of matching weights:
  .0131976578
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3429.304            3448.057           -18.75253            3448.057  |
  3 |          y1_binary             .947141            .9577309           -.0105898            .9577309  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","mean_sd_sq", 1, 0, (1,.50,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =   .0255221  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00707055  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00121893  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00077435  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00038439  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00027065  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00020657  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00014905  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00004814  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00002729  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00002254  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00001783  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00001699  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  4.708e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  2.990e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  1.435e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  1.177e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  7.334e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  6.259e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  5.611e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  4.353e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  4.347e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  4.094e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  1.637e-07  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  1.536e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  1.465e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  1.080e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  1.045e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  1.045e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  1.040e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  9.998e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  9.894e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  9.891e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  9.891e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 34:  f(p) =  9.890e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 35:  f(p) =  9.885e-08  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 36:  f(p) =  9.881e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 37:  f(p) =  7.801e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 38:  f(p) =  7.575e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 39:  f(p) =  6.674e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 40:  f(p) =  6.457e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 41:  f(p) =  6.041e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 42:  f(p) =  5.874e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 43:  f(p) =  5.765e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 44:  f(p) =  5.719e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 45:  f(p) =  5.237e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 46:  f(p) =  5.012e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 47:  f(p) =  2.461e-08  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 48:  f(p) =  2.280e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 49:  f(p) =  2.254e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 50:  f(p) =  2.189e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 51:  f(p) =  2.176e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 52:  f(p) =  2.175e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 53:  f(p) =  2.175e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 54:  f(p) =  2.175e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 55:  f(p) =  2.175e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 56:  f(p) =  2.175e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 57:  f(p) =  2.175e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 58:  f(p) =  2.175e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 59:  f(p) =  2.175e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.7887844483   -2.395101698   -.6210363196   -.2725947385   -.0004799527   -.0335334567   -.0119068894   -.0990997379   -.1447482144   -.1146630236
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1    -.1030321896   -.0782802618   -.1519557751    3.357107052  |
     -------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5940708    -.1266795    -.2525158     .5016695     1.041073  |
   3 |        1.x2     .0108696     .0035822     .0072874     .0698982     .1042572     3.037792  |
   4 |        1.x3     .0217391     .0173612      .004378     .0298573     .1466296     1.257201  |
   5 |          x4     .4347826     .4813204    -.0465378     -.093366     .4984448     .9927386  |
   6 |          x5     25.46739     25.49233    -.0249395    -.0045812     5.443922     .7683625  |
   7 |          x6     11.86957     12.62643    -.7568611     -.471548     1.605057     .5051906  |
   8 |          x7     6.858696     6.552401     .3062946     .0861175     3.556704     1.126873  |
   9 |         x90     .0972024     -.113035     .2102375     .2204243     .9537854     .8801527  |
  10 |         x91    -.0890157     -.110682     .0216663      .022977     .9429542     .9383917  |
  11 |         x92     .0453787    -.1366855     .1820642     .1732006     1.051175      1.11749  |
  12 |         x93     .0865687    -.0591155     .1456841     .1558167     .9349714     .8388811  |
  13 |         x94    -.1299173    -.0825678    -.0473494    -.0511992     .9248091     .8328052  |
  14 |         x95    -.0807251    -.1857156     .1049905     .1148686      .914005     .8641629  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.47263e-11
  Mean absolute standardized diff.
  .1343361875
  Maximum absolute standardized diff.
  .471547967
  C.V. of matching weights:
  .5528294035
  S.D. of matching weights:
  .5528294035
  Skewness of matching weights:
  .0688225943
  Kurtosis of matching weights:
  .013107526
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3436.518            3475.966            -39.4479            3475.966  |
  3 |          y1_binary            .9475683            .9590717           -.0115034            .9590717  |
    +-----------------------------------------------------------------------------------------------------+

: 
: mata drop D

: 
: 
: // * WEIGHTED DATA EXAMPLES *
: 
: DW = gmatch()

: DW.set(treatvar, varlist, tousevar, wgtvar)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)

: if (depvars!="") DW.set_Y(depvars,tousevar)
> 
> // Misc balance measures
>   DW.diff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.295813959   -.0156488223   -.0187317786   -.0757286195   -1.051311077   -1.308590669     .297707166    .1231935602   -.0575694681    .0828891447
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0552344857   -.1298217376   -.0348745599  |
     ----------------------------------------------+

:   DW.stddiff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.5928113513   -.1469730323   -.1218929028   -.1529139652   -.1938926866   -.7969828512    .0837330563    .1283646934   -.0613348134    .0800443396
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0583642775   -.1419196244   -.0384510908  |
     ----------------------------------------------+

:   DW.mean_asd()
  .1998214373

:   DW.stddiff(1)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.5928113513   -.1469730323   -.1218929028   -.1529139652   -.1938926866   -.7969828512    .0837330563    .1283646934   -.0613348134    .0800443396
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0583642775   -.1419196244   -.0384510908  |
     ----------------------------------------------+

:   DW.stddiff(0)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.680061781   -.0963964449   -.0924925724    -.151364552   -.1796741931    -.574992733     .089787867    .1235603267   -.0581251544    .0827450762
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13
     ----------------------------------------------+
  1     .0561740214   -.1310646825   -.0346950651  |
     ----------------------------------------------+

:   DW.varratio()
                 1             2             3             4             5             6             7             8             9            10
    +---------------------------------------------------------------------------------------------------------------------------------------------
  1 |  1.316023713   .4301765439   .5757804001   .9798375062   .8587140122   .5205072206   1.149850614   .9265458616   .8980781756   1.068619436
    +---------------------------------------------------------------------------------------------------------------------------------------------
                11            12            13
     -------------------------------------------+
  1    .9263536214    .852877099   .8141756036  |
     -------------------------------------------+

:   DW.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3448.29            3459.434           -11.14415            3459.434  |
  3 |          y1_binary              .95075            .9627243           -.0119743            .9627243  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |  -11.14415063    -.011974287  |
    +-------------------------------+

: 
:   "Balance table before matching"
  Balance table before matching

:   temp = DW.balancetable(1)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .7470371     -.295814    -.5928114     .4990018     1.316024  |
   3 |        1.x2     .0114039     .0270527    -.0156488     -.146973     .1064741     .4301765  |
   4 |        1.x3     .0240637     .0427955    -.0187318    -.1218929     .1536741     .5757804  |
   5 |          x4     .4218861     .4976147    -.0757286     -.152914     .4952368     .9798375  |
   6 |          x5     25.44699      26.4983    -1.051311    -.1938927     5.422129      .858714  |
   7 |          x6     11.84757     13.15616    -1.308591    -.7969829     1.641931     .5205072  |
   8 |          x7     7.015422     6.717714     .2977072     .0837331     3.555432     1.149851  |
   9 |         x90     .0839738    -.0392197     .1231936     .1283647     .9597153     .9265459  |
  10 |         x91    -.0648837    -.0073142    -.0575695    -.0613348       .93861     .8980782  |
  11 |         x92     .0575388    -.0253504     .0828891     .0800443      1.03554     1.068619  |
  12 |         x93     .1016523     .0464178     .0552345     .0583643     .9463749     .9263536  |
  13 |         x94    -.1252265     .0045953    -.1298217    -.1419196     .9147554     .8528771  |
  14 |         x95    -.1044649    -.0695904    -.0348746    -.0384511     .9069849     .8141756  |
     +--------------------------------------------------------------------------------------------+

: 
: // Replicate CBPS
: 
:   "--- ATE (not overidentified) ---"; ""; ""
  --- ATE (not overidentified) ---
  
  

:     DW.cbps("ate", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00008909  
Iteration 1:   f(p) =  .00006006  
Iteration 2:   f(p) =  .00005798  
Iteration 3:   f(p) =  .00005798  
Iteration 4:   f(p) =  .00005797  
Iteration 5:   f(p) =  .00005722  
Iteration 6:   f(p) =  .00004799  
Iteration 7:   f(p) =  .00002163  
Iteration 8:   f(p) =  .00001682  
Iteration 9:   f(p) =  .00001603  
Iteration 10:  f(p) =  .00001599  
Iteration 11:  f(p) =  .00001599  
(switching technique to nr)
Iteration 12:  f(p) =  .00001598  (not concave)
Iteration 13:  f(p) =  4.571e-06  (not concave)
Iteration 14:  f(p) =  1.592e-06  (not concave)
Iteration 15:  f(p) =  8.516e-07  (not concave)
Iteration 16:  f(p) =  3.286e-07  (not concave)
Iteration 17:  f(p) =  1.745e-07  (not concave)
Iteration 18:  f(p) =  8.936e-08  (not concave)
Iteration 19:  f(p) =  2.836e-08  (not concave)
Iteration 20:  f(p) =  5.115e-09  
Iteration 21:  f(p) =  1.153e-10  
Iteration 22:  f(p) =  1.212e-14  
Iteration 23:  f(p) =  2.740e-25  
(switching technique to bfgs)
Iteration 24:  f(p) =  2.405e-27  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.502416045   -2.525398915   -.8191009475   -.3236397063    .0771198244   -.4884764405    .0722685739    .0234164978    .0257848717    .2152141202
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1    -.0285372179   -.3393876759   -.0407880729    3.075436854  |
     -------------------------------------------------------------+

:     DW.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6695182      .6695182      1.44e-15      3.07e-15      .4706262      1.004328  |
   3 |         1.x2      .0220668      .0220668     -1.88e-14     -1.28e-13      .1469756      1.004328  |
   4 |         1.x3      .0366911      .0366911     -2.61e-14     -1.39e-13       .188098      1.004328  |
   5 |           x4       .485133       .485133      1.70e-13      3.39e-13      .5000334      1.004328  |
   6 |           x5      26.17889      26.17889      6.18e-13      9.91e-14      6.237853      .6789026  |
   7 |           x6      12.63449      12.63449     -1.58e-12     -6.76e-13      2.338005      .5740656  |
   8 |           x7      6.755243      6.755243     -6.36e-13     -1.89e-13      3.370937      1.187219  |
   9 |          x90     -.0520316     -.0520316      3.49e-14      3.34e-14      1.046128      1.163666  |
  10 |          x91      .0164856      .0164856      7.94e-14      8.18e-14      .9705717      .9930954  |
  11 |          x92     -.0021645     -.0021645     -2.62e-15     -2.58e-15      1.017927      1.359802  |
  12 |          x93      .0456916      .0456916     -2.14e-13     -2.22e-13      .9636159       .883731  |
  13 |          x94     -.0910006     -.0910006     -2.10e-13     -2.07e-13      1.014116      .7859289  |
  14 |          x95     -.0894588     -.0894588      6.18e-13      6.32e-13       .978942      .8236876  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  8.32408e-28
  Mean absolute standardized diff.
  2.11649e-13
  Maximum absolute standardized diff.
  6.76199e-13
  C.V. of matching weights:
  .5270998694
  S.D. of matching weights:
  .5284997369
  Skewness of matching weights:
  .2026515012
  Kurtosis of matching weights:
  .0762370775
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3445.465            3445.465           -5.18e-11            3445.465  |
  3 |          y1_binary            .9569441            .9569441           -1.93e-14            .9569441  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATE overidentified ---"; ""; ""
  --- ATE overidentified ---
  
  

:     DW.cbps("ate", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .02296546  
Iteration 1:   f(p) =  .01893921  
Iteration 2:   f(p) =  .01888779  
Iteration 3:   f(p) =  .01864991  
Iteration 4:   f(p) =  .01807801  
Iteration 5:   f(p) =  .01796175  
Iteration 6:   f(p) =  .01796123  
Iteration 7:   f(p) =  .01795278  
Iteration 8:   f(p) =  .01785278  
Iteration 9:   f(p) =   .0178181  
Iteration 10:  f(p) =  .01781755  
Iteration 11:  f(p) =  .01781528  
(switching technique to nr)
Iteration 12:  f(p) =  .01780001  
Iteration 13:  f(p) =  .01777185  
Iteration 14:  f(p) =  .01777184  
Iteration 15:  f(p) =  .01777184  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.226645055   -1.653762196   -.7776876289   -.3532490659    .0574628554   -.2583005137    .0080438631    .0890275829    -.170688089    .1765097113
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .1136718374   -.1271347144     .021470362    1.180155482  |
     -------------------------------------------------------------+

:     DW.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6415953      .6970127     -.0554173     -.1194311      .4640107      1.093567  |
   3 |         1.x2      .0142909      .0234703     -.0091794     -.0628462      .1460619      .6172753  |
   4 |         1.x3      .0334441      .0380925     -.0046484     -.0245369      .1894462      .8860314  |
   5 |           x4      .4881571      .4821182      .0060389      .0120785       .499973       1.00505  |
   6 |           x5      25.72258      26.31855     -.5959644     -.1000426      5.957105      .7659019  |
   7 |           x6      12.33189       12.8994     -.5675068     -.2533225      2.240254      .6135511  |
   8 |           x7      6.911084      6.688832       .222252      .0657612      3.379685      1.211887  |
   9 |          x90     -.0440388     -.0251309      -.018908     -.0185767       1.01783      1.120774  |
  10 |          x91      .0661735     -.0257224      .0918959      .0936219      .9815644      .9753854  |
  11 |          x92     -.0382008     -.0020298     -.0361709     -.0355957      1.016161       1.20721  |
  12 |          x93      .0014101      .0645199     -.0631098     -.0653399      .9658703      .9125525  |
  13 |          x94     -.1442668     -.0285682     -.1156986     -.1166712      .9916637      .8216037  |
  14 |          x95     -.1053626       -.07164     -.0337226     -.0344811      .9780038       .803947  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0025726925
  Mean absolute standardized diff.
  .0771004086
  Maximum absolute standardized diff.
  .2533225075
  C.V. of matching weights:
  .3236892358
  S.D. of matching weights:
  .3244154091
  Skewness of matching weights:
  .1499732973
  Kurtosis of matching weights:
  .0569705853
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3443.873            3455.428           -11.55448            3455.428  |
  3 |          y1_binary            .9538356            .9614582           -.0076226            .9614582  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET (not overidentified) ---"; ""; ""
  --- ATET (not overidentified) ---
  
  

:     DW.cbps("atet", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00001735  
Iteration 1:   f(p) =  6.450e-06  
Iteration 2:   f(p) =  5.892e-06  
Iteration 3:   f(p) =  5.889e-06  
Iteration 4:   f(p) =  5.889e-06  
Iteration 5:   f(p) =  5.884e-06  
Iteration 6:   f(p) =  5.782e-06  
Iteration 7:   f(p) =  1.662e-06  
Iteration 8:   f(p) =  1.352e-06  
Iteration 9:   f(p) =  1.347e-06  
Iteration 10:  f(p) =  1.347e-06  
Iteration 11:  f(p) =  1.347e-06  
(switching technique to nr)
Iteration 12:  f(p) =  1.337e-06  (not concave)
Iteration 13:  f(p) =  8.478e-08  
Iteration 14:  f(p) =  1.602e-08  
Iteration 15:  f(p) =  7.712e-10  
Iteration 16:  f(p) =  5.651e-13  
Iteration 17:  f(p) =  5.938e-20  
Iteration 18:  f(p) =  8.653e-26  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -1.44704714   -1.546890931    -.471062263   -.3822539288    .0635823768   -.2432270283    .0477026872    .1334992086   -.1336116528    .1522937138
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0757732417   -.1016170888   -.0383391404    .6265763158  |
     -------------------------------------------------------------+

:     DW.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4512231      .4512231      2.63e-12      5.28e-12      .4978686      1.004328  |
   3 |         1.x2      .0114039      .0114039      2.63e-13      2.47e-12      .1062323      1.004328  |
   4 |         1.x3      .0240637      .0240637      3.94e-13      2.57e-12      .1533251      1.004328  |
   5 |           x4      .4218861      .4218861      7.43e-13      1.50e-12       .494112      1.004328  |
   6 |           x5      25.44699      25.44699      1.28e-11      1.92e-12      6.665558      .6144662  |
   7 |           x6      11.84757      11.84757      1.34e-11      6.54e-12      2.042375      .5982513  |
   8 |           x7      7.015422      7.015422     -1.00e-11     -3.00e-12      3.345323      1.161761  |
   9 |          x90      .0839738      .0839738     -1.05e-14     -1.02e-14        1.0258      .8505325  |
  10 |          x91     -.0648837     -.0648837      3.35e-12      3.56e-12       .941106      .9922891  |
  11 |          x92      .0575388      .0575388     -1.11e-12     -1.12e-12      .9892732      1.118263  |
  12 |          x93      .1016523      .1016523     -1.98e-12     -2.11e-12      .9410813      1.012572  |
  13 |          x94     -.1252265     -.1252265      1.63e-12      1.59e-12      1.026859      .7576623  |
  14 |          x95     -.1044649     -.1044649      6.17e-13      6.40e-13      .9627688      .8646431  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  2.32907e-24
  Mean absolute standardized diff.
  2.48484e-12
  Maximum absolute standardized diff.
  6.53792e-12
  C.V. of matching weights:
  1.031924564
  S.D. of matching weights:
  1.02710789
  Skewness of matching weights:
  .1135011509
  Kurtosis of matching weights:
  .0229206639
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.367            5.17e-10            3431.367  |
  3 |          y1_binary            .9509094            .9509094            1.84e-13            .9509094  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET overidentified ---"; ""; ""
  --- ATET overidentified ---
  
  

:     DW.cbps("atet", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00053487  
Iteration 1:   f(p) =  .00021848  
Iteration 2:   f(p) =  .00021162  
Iteration 3:   f(p) =  .00021159  
Iteration 4:   f(p) =  .00021001  
Iteration 5:   f(p) =  .00019724  
Iteration 6:   f(p) =   .0001771  
Iteration 7:   f(p) =  .00017502  
Iteration 8:   f(p) =  .00017501  
Iteration 9:   f(p) =  .00017499  
Iteration 10:  f(p) =  .00017465  
Iteration 11:  f(p) =  .00017249  
(switching technique to nr)
Iteration 12:  f(p) =  .00017245  
Iteration 13:  f(p) =  .00017215  
Iteration 14:  f(p) =  .00017215  
Iteration 15:  f(p) =  .00017215  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.393749216   -1.561041129    -.460004096   -.3846168055    .0606091575   -.2482012462    .0443349316    .1306487561   -.1205474411    .1453091539
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0704759932   -.1075637918    -.030791552    .7598453036  |
     -------------------------------------------------------------+

:     DW.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4512231      .4553292      -.004106      -.008242       .498186      1.002774  |
   3 |         1.x2      .0114039      .0111962      .0002076      .0019689      .1054487      1.022737  |
   4 |         1.x3      .0240637      .0242798     -.0002161     -.0014043      .1538723      .9956099  |
   5 |           x4      .4218861      .4235251      -.001639     -.0033156       .494322      1.003286  |
   6 |           x5      25.44699      25.39436      .0526224      .0078927      6.667188      .6141311  |
   7 |           x6      11.84757      11.82507      .0224988      .0110125      2.043017      .5978372  |
   8 |           x7      7.015422      6.978162        .03726       .011128      3.348319      1.159171  |
   9 |          x90      .0839738      .0816058       .002368      .0023047      1.027479      .8472278  |
  10 |          x91     -.0648837     -.0554765     -.0094072     -.0099831      .9423132      .9892043  |
  11 |          x92      .0575388      .0526517      .0048871      .0049455      .9881782      1.121369  |
  12 |          x93      .1016523        .09771      .0039424      .0041911      .9406607      1.013686  |
  13 |          x94     -.1252265      -.131327      .0061006      .0059387       1.02725      .7569926  |
  14 |          x95     -.1044649     -.1015494     -.0029155     -.0030291      .9625009      .8652191  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  3.24223e-06
  Mean absolute standardized diff.
  .0057966356
  Maximum absolute standardized diff.
  .0111279635
  C.V. of matching weights:
  1.019033715
  S.D. of matching weights:
  1.014129106
  Skewness of matching weights:
  .1128933006
  Kurtosis of matching weights:
  .0230686436
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.338            3430.734            .6042787            3430.734  |
  3 |          y1_binary            .9509085            .9508973            .0000112            .9508973  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // Other objective functions
:   DW.cbps("atet","mean_sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00026309  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00001126  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  4.733e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  1.762e-13  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  1.968e-21  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  4.929e-33  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  4.437e-33  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  4.120e-33  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  3.603e-33  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  1.521e-33  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  8.788e-34  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  8.574e-34  (backed up)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.298300659   -1.629910465   -.4511737896   -.3553036347    .0715800496   -.2773324041    .0371348754    .1283825511   -.0952384668    .1409151853
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0743038835   -.1419191916     -.02015005     1.24895601  |
     -------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231      .487981    -.0367579    -.0736628     .4990018     .9953452  |
   3 |        1.x2     .0114039     .0101189     .0012849     .0120681     .1064741     1.130392  |
   4 |        1.x3     .0240637     .0243904    -.0003267     -.002126     .1536741      .991207  |
   5 |          x4     .4218861     .4077073     .0141788     .0286304     .4952368     1.014377  |
   6 |          x5     25.44699     25.93854    -.4915548    -.0906572     5.422129     .5820455  |
   7 |          x6     11.84757     11.77832     .0692519     .0421771     1.641931     .5870658  |
   8 |          x7     7.015422     6.877177     .1382443     .0388826     3.555432     1.150412  |
   9 |         x90     .0839738     .0558962     .0280776     .0292562     .9597153     .8505932  |
  10 |         x91    -.0648837    -.0314162    -.0334675    -.0356565       .93861     .9896463  |
  11 |         x92     .0575388     .0508005     .0067383      .006507      1.03554     1.132825  |
  12 |         x93     .1016523     .1109109    -.0092586    -.0097833     .9463749     1.021042  |
  13 |         x94    -.1252265    -.1752569     .0500305     .0546928     .9147554     .7291541  |
  14 |         x95    -.1044649     -.104167    -.0002979    -.0003285     .9069849     .8690485  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  8.57424e-34
  Mean absolute standardized diff.
  .03264833
  Maximum absolute standardized diff.
  .0906571704
  C.V. of matching weights:
  1.067016841
  S.D. of matching weights:
  1.064358817
  Skewness of matching weights:
  .1583892395
  Kurtosis of matching weights:
  .0509012076
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.445            3432.164           -.7196186            3432.164  |
  3 |          y1_binary            .9507734            .9518109           -.0010374            .9518109  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .01944489  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .01784035  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01032757  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00864463  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00309574  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00232235  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00091852  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00071553  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00032888  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00013226  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00006152  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00004718  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00002689  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  .00002262  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  .00002081  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  .00001998  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  .00001282  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  .00001172  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  .00001048  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  8.671e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  7.927e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  7.374e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  6.900e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  6.153e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  5.753e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  5.501e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  5.209e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  5.180e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  5.179e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  5.179e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  5.179e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  5.179e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  5.179e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  5.179e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 34:  f(p) =  5.179e-06  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 35:  f(p) =  4.398e-06  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 36:  f(p) =  4.273e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 37:  f(p) =  4.184e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 38:  f(p) =  3.832e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 39:  f(p) =  3.682e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 40:  f(p) =  3.499e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 41:  f(p) =  3.318e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 42:  f(p) =  3.153e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 43:  f(p) =  3.041e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 44:  f(p) =  2.857e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 45:  f(p) =  2.695e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 46:  f(p) =  2.269e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 47:  f(p) =  2.002e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 48:  f(p) =  1.416e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 49:  f(p) =  2.825e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 50:  f(p) =  2.063e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 51:  f(p) =  6.982e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 52:  f(p) =  2.797e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 53:  f(p) =  5.554e-10  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 54:  f(p) =  7.404e-12  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 55:  f(p) =  7.404e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 56:  f(p) =  7.320e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 57:  f(p) =  6.368e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 58:  f(p) =  5.709e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 59:  f(p) =  5.695e-12  (backed up)
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 60:  f(p) =  4.944e-12  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 61:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 62:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 63:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 64:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 65:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 66:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 67:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 68:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 69:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 70:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 71:  f(p) =  4.944e-12  (backed up)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 72:  f(p) =  4.944e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 73:  f(p) =  4.599e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 74:  f(p) =  4.505e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 75:  f(p) =  4.505e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 76:  f(p) =  4.505e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 77:  f(p) =  4.297e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 78:  f(p) =  4.126e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 79:  f(p) =  4.126e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 80:  f(p) =  4.126e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 81:  f(p) =  3.995e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 82:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 83:  f(p) =  3.899e-12  (backed up)
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 84:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 85:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 86:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 87:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 88:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 89:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 90:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 91:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 92:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 93:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 94:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 95:  f(p) =  3.899e-12  (backed up)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 96:  f(p) =  3.899e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 97:  f(p) =  3.799e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 98:  f(p) =  3.795e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 99:  f(p) =  3.795e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 100: f(p) =  3.719e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 101: f(p) =  3.716e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 102: f(p) =  3.716e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 103: f(p) =  3.716e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 104: f(p) =  3.716e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 105: f(p) =  3.657e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 106: f(p) =  3.652e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 107: f(p) =  3.652e-12  (backed up)
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 108: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 109: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 110: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 111: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 112: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 113: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 114: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 115: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 116: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 117: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 118: f(p) =  3.605e-12  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 119: f(p) =  3.605e-12  (backed up)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 120: f(p) =  3.605e-12  (backed up)
convergence not achieved
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -1.44704385   -1.546894326    -.471068058   -.3822577667    .0635820131   -.2432269578     .047702666    .1334985925   -.1336114176    .1522938422
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0757727782   -.1016167639   -.0383397043    1.396245318  |
     -------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512235    -3.77e-07    -7.56e-07     .4990018     1.004328  |
   3 |        1.x2     .0114039     .0114038     6.35e-08     5.96e-07     .1064741     1.004333  |
   4 |        1.x3     .0240637     .0240636     1.33e-07     8.62e-07     .1536741     1.004333  |
   5 |          x4     .4218861     .4218856     4.73e-07     9.55e-07     .4952368     1.004328  |
   6 |          x5     25.44699     25.44698     3.04e-06     5.60e-07     5.422129     .6144666  |
   7 |          x6     11.84757     11.84757    -4.02e-08    -2.45e-08     1.641931     .5982513  |
   8 |          x7     7.015422     7.015421     5.44e-07     1.53e-07     3.555432     1.161761  |
   9 |         x90     .0839738     .0839734     3.95e-07     4.12e-07     .9597153     .8505323  |
  10 |         x91    -.0648837    -.0648837     2.53e-08     2.69e-08       .93861     .9922888  |
  11 |         x92     .0575388      .057539    -2.88e-07    -2.78e-07      1.03554     1.118263  |
  12 |         x93     .1016523     .1016521     2.41e-07     2.55e-07     .9463749     1.012572  |
  13 |         x94    -.1252265    -.1252263    -2.06e-07    -2.25e-07     .9147554     .7576623  |
  14 |         x95    -.1044649    -.1044655     5.14e-07     5.67e-07     .9069849     .8646432  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  5.69999e-14
  Mean absolute standardized diff.
  4.36202e-07
  Maximum absolute standardized diff.
  9.55101e-07
  C.V. of matching weights:
  1.031923765
  S.D. of matching weights:
  1.027107077
  Skewness of matching weights:
  .1135010921
  Kurtosis of matching weights:
  .0229206384
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.367           -.0001196            3431.367  |
  3 |          y1_binary            .9509094            .9509094           -1.87e-08            .9509094  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.367           -.0001196            3431.367  |
  3 |          y1_binary            .9509094            .9509094           -1.87e-08            .9509094  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |   -.000119554   -1.86839e-08  |
    +-------------------------------+

:   DW.reweight()

:   DW.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3448.29            3459.434           -11.14415            3459.434  |
  3 |          y1_binary              .95075            .9627243           -.0119743            .9627243  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |  -11.14415063    -.011974287  |
    +-------------------------------+

: 
: // IPW
: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], atet aequations")

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  1.444e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Treated vs Untreated)  |  -373.2561   49.21885    -7.58   0.000    -469.7233   -276.7889
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3424.879   30.82585   111.10   0.000     3364.462    3485.297
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.299227   .2371935    -5.48   0.000    -1.764118   -.8343367
                        |
                     x2 |
                     1  |  -1.630014    .746001    -2.19   0.029    -3.092149   -.1678787
                        |
                     x3 |
                     1  |  -.4513753   .5770312    -0.78   0.434    -1.582336    .6795851
                     x4 |  -.3551911    .204881    -1.73   0.083    -.7567506    .0463684
                     x5 |    .058452   .0195046     3.00   0.003     .0202237    .0966803
                     x6 |  -.2821622    .049775    -5.67   0.000    -.3797195    -.184605
                     x7 |   .0332008   .0279849     1.19   0.235    -.0216486    .0880501
                    x90 |   .1276778   .0907109     1.41   0.159    -.0501124     .305468
                    x91 |  -.0961159   .0916737    -1.05   0.294     -.275793    .0835612
                    x92 |   .1400043   .0976573     1.43   0.152    -.0514004    .3314091
                    x93 |   .0734557   .0916967     0.80   0.423    -.1062665     .253178
                    x94 |  -.1435742   .0862727    -1.66   0.096    -.3126656    .0255172
                    x95 |  -.0212452   .0898768    -0.24   0.813    -.1974006    .1549102
                  _cons |    1.24872   .6712769     1.86   0.063    -.0669587    2.564399
-----------------------------------------------------------------------------------------

:   stata("di _b[POmean:0.treat]")
3424.8791

:   stata("tebalance summarize")

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        249.5
                          Control obs   =          408        250.5
                          -----------------------------------------

  -----------------------------------------------------------------
                  |Standardized differences          Variance ratio
                  |        Raw    Weighted           Raw   Weighted
  ----------------+------------------------------------------------
               x1 |  -.6027752    .0041102      1.338962   1.000571
                  |
               x2 |
               1  |  -.1180374    .0011686      .4133173   1.011157
                  |
               x3 |
               1  |  -.1253201   -.0169419      .5085817   .8975379
                  |
               x4 |  -.1207472    .0136004      .9914484   1.003798
               x5 |  -.1944638     .003179      .8589874   .5855492
               x6 |  -.6542694    .0947099      .4958356   .5643304
               x7 |   .0473848    .0177567      1.160037   1.134687
              x90 |   .1499304    .0348222      .9289414    .817157
              x91 |  -.0833726   -.0675073      .8791918     .96061
              x92 |   .0662245   -.0005441      1.090179   1.148892
              x93 |   .0479737    -.020065      .8926169   .9606022
              x94 |  -.1521926    .0315996      .8686432   .7548902
              x95 |  -.0155155    .0398234      .8285405   .8815991
  -----------------------------------------------------------------

:   stata("tebalance summarize, baseline")  // I noticed the sum of weights in tebalance are weird

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        249.5
                          Control obs   =          408        250.5
                          -----------------------------------------

  -----------------------------------------------------------------
                  |           Means                  Variances     
                  |    Control     Treated       Control    Treated
  ----------------+------------------------------------------------
               x1 |        .75    .4673913      .1879607   .2516722
                  |
               x2 |
               1  |   .0269608    .0108696      .0262984   .0108696
                  |
               x3 |
               1  |   .0441176    .0217391      .0422749   .0215002
                  |
               x4 |    .495098    .4347826      .2505902   .2484472
               x5 |   26.56863    25.46739      34.50142   29.63629
               x6 |   13.15931    11.86957      5.195687   2.576206
               x7 |   6.696078    6.858696      10.90495   12.65014
              x90 |   -.048508    .0972024      .9792937   .9097065
              x91 |  -.0077434   -.0890157      1.011341   .8891627
              x92 |  -.0227801    .0453787      1.013567    1.10497
              x93 |   .0403853    .0865687      .9793358   .8741716
              x94 |   .0160559   -.1299173      .9846065   .8552718
              x95 |  -.0658282   -.0807251      1.008285   .8354051
  -----------------------------------------------------------------

: 
:   DW.ipw("atet")
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462   -1.630013723    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932   -.0961158854    .1400043185
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------+

:   table = DW.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4512231     .4574808    -.0062577    -.0125467     .4987508     1.002016  |
   3 |        1.x2     .0114039     .0104612     .0009427     .0090496     .1041667     1.093786  |
   4 |        1.x3     .0240637     .0241722    -.0001085    -.0007058     .1536767     .9999323  |
   5 |          x4     .4218861     .4314162    -.0095301    -.0192367     .4954098     .9986039  |
   6 |          x5     25.44699     25.25275     .1942356     .0309352     6.278789     .5945665  |
   7 |          x6     11.84757     11.67955     .1680205     .0885487     1.897493     .5984287  |
   8 |          x7     7.015422     6.824197     .1912245     .0556435       3.4366     1.151353  |
   9 |         x90     .0839738     .0777469     .0062269     .0061803     1.007542     .8303562  |
  10 |         x91    -.0648837     -.033852    -.0310317    -.0329813      .940886      .990382  |
  11 |         x92     .0575388     .0480591     .0094797     .0094309     1.005171     1.130693  |
  12 |         x93     .1016523     .1032412    -.0015889    -.0016918     .9391571     1.031343  |
  13 |         x94    -.1252265    -.1745685     .0493421     .0498225     .9903584     .7439065  |
  14 |         x95    -.1044649    -.1114622     .0069973     .0074459     .9397461     .8717687  |
     +--------------------------------------------------------------------------------------------+

:   DW.pomean()
                 1             2
    +-----------------------------+
  1 |  3424.879077   .9506406354  |
    +-----------------------------+

:   DW.reweight()

:   table = DW.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4512231     .7470371     -.295814    -.6319633     .4680872     1.316024  |
   3 |        1.x2     .0114039     .0270527    -.0156488    -.1139938     .1372778     .4301765  |
   4 |        1.x3     .0240637     .0427955    -.0187318    -.1042015     .1797649     .5757804  |
   5 |          x4     .4218861     .4976147    -.0757286    -.1521333     .4977779     .9798375  |
   6 |          x5     25.44699      26.4983    -1.051311    -.1863779      5.64075      .858714  |
   7 |          x6     11.84757     13.15616    -1.308591    -.6594519     1.984361     .5205072  |
   8 |          x7     7.015422     6.717714     .2977072     .0866021     3.437643     1.149851  |
   9 |         x90     .0839738    -.0392197     .1231936     .1258938     .9785514     .9265459  |
  10 |         x91    -.0648837    -.0073142    -.0575695    -.0596653      .964873     .8980782  |
  11 |         x92     .0575388    -.0253504     .0828891     .0813611     1.018781     1.068619  |
  12 |         x93     .1016523     .0464178     .0552345     .0572377     .9650011     .9263536  |
  13 |         x94    -.1252265     .0045953    -.1298217    -.1361687     .9533888     .8528771  |
  14 |         x95    -.1044649    -.0695904    -.0348746    -.0364286     .9573389     .8141756  |
     +--------------------------------------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], ate aequations")

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  2.423e-25  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATE                     |
                  treat |
(Treated vs Untreated)  |  -332.1348   56.53175    -5.88   0.000     -442.935   -221.3346
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3453.029    20.1341   171.50   0.000     3413.567    3492.491
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.299227   .2371935    -5.48   0.000    -1.764118   -.8343367
                        |
                     x2 |
                     1  |  -1.630014    .746001    -2.19   0.029    -3.092149   -.1678787
                        |
                     x3 |
                     1  |  -.4513753   .5770312    -0.78   0.434    -1.582336    .6795851
                     x4 |  -.3551911    .204881    -1.73   0.083    -.7567506    .0463684
                     x5 |    .058452   .0195046     3.00   0.003     .0202237    .0966803
                     x6 |  -.2821622    .049775    -5.67   0.000    -.3797195    -.184605
                     x7 |   .0332008   .0279849     1.19   0.235    -.0216486    .0880501
                    x90 |   .1276778   .0907109     1.41   0.159    -.0501124     .305468
                    x91 |  -.0961159   .0916737    -1.05   0.294     -.275793    .0835612
                    x92 |   .1400043   .0976573     1.43   0.152    -.0514004    .3314091
                    x93 |   .0734557   .0916967     0.80   0.423    -.1062665     .253178
                    x94 |  -.1435742   .0862727    -1.66   0.096    -.3126656    .0255172
                    x95 |  -.0212452   .0898768    -0.24   0.813    -.1974006    .1549102
                  _cons |    1.24872   .6712769     1.86   0.063    -.0669587    2.564399
-----------------------------------------------------------------------------------------

:   DW.ipw("ate")
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462   -1.630013723    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932   -.0961158854    .1400043185
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], atet aequations tlevel(0) control(1)")

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  1.908e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Untreated vs Treated)  |   321.4309   62.35166     5.16   0.000     199.2239    443.6379
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
               Treated  |   3138.003   59.50596    52.73   0.000     3021.374    3254.633
------------------------+----------------------------------------------------------------
TME0                    |
                     x1 |   1.299227   .2371935     5.48   0.000     .8343367    1.764118
                        |
                     x2 |
                     1  |   1.630014    .746001     2.19   0.029     .1678787    3.092149
                        |
                     x3 |
                     1  |   .4513753   .5770312     0.78   0.434    -.6795851    1.582336
                     x4 |   .3551911    .204881     1.73   0.083    -.0463684    .7567506
                     x5 |   -.058452   .0195046    -3.00   0.003    -.0966803   -.0202237
                     x6 |   .2821622    .049775     5.67   0.000      .184605    .3797195
                     x7 |  -.0332008   .0279849    -1.19   0.235    -.0880501    .0216486
                    x90 |  -.1276778   .0907109    -1.41   0.159     -.305468    .0501124
                    x91 |   .0961159   .0916737     1.05   0.294    -.0835612     .275793
                    x92 |  -.1400043   .0976573    -1.43   0.152    -.3314091    .0514004
                    x93 |  -.0734557   .0916967    -0.80   0.423     -.253178    .1062665
                    x94 |   .1435742   .0862727     1.66   0.096    -.0255172    .3126656
                    x95 |   .0212452   .0898768     0.24   0.813    -.1549102    .1974006
                  _cons |   -1.24872   .6712769    -1.86   0.063    -2.564399    .0669587
-----------------------------------------------------------------------------------------

:   DW.ipw("ateu")
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462   -1.630013723    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932   -.0961158854    .1400043185
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------+

: 
: // tradeoff between CBPS-like balance and variance in weights
: 
:   DW.cbps("atet","cbps", 1, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00001735  
Iteration 1:   f(p) =  6.450e-06  
Iteration 2:   f(p) =  5.892e-06  
Iteration 3:   f(p) =  5.889e-06  
Iteration 4:   f(p) =  5.889e-06  
Iteration 5:   f(p) =  5.884e-06  
Iteration 6:   f(p) =  5.782e-06  
Iteration 7:   f(p) =  1.662e-06  
Iteration 8:   f(p) =  1.352e-06  
Iteration 9:   f(p) =  1.347e-06  
Iteration 10:  f(p) =  1.347e-06  
Iteration 11:  f(p) =  1.347e-06  
(switching technique to nr)
Iteration 12:  f(p) =  1.337e-06  (not concave)
Iteration 13:  f(p) =  8.478e-08  
Iteration 14:  f(p) =  1.602e-08  
Iteration 15:  f(p) =  7.712e-10  
Iteration 16:  f(p) =  5.651e-13  
Iteration 17:  f(p) =  5.938e-20  
Iteration 18:  f(p) =  8.653e-26  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -1.44704714   -1.546890931    -.471062263   -.3822539288    .0635823768   -.2432270283    .0477026872    .1334992086   -.1336116528    .1522937138
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1     .0757732417   -.1016170888   -.0383391404    .6265763158  |
     -------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512231     2.63e-12     5.26e-12     .4990018     1.004328  |
   3 |        1.x2     .0114039     .0114039     2.63e-13     2.47e-12     .1064741     1.004328  |
   4 |        1.x3     .0240637     .0240637     3.94e-13     2.57e-12     .1536741     1.004328  |
   5 |          x4     .4218861     .4218861     7.43e-13     1.50e-12     .4952368     1.004328  |
   6 |          x5     25.44699     25.44699     1.28e-11     2.36e-12     5.422129     .6144662  |
   7 |          x6     11.84757     11.84757     1.34e-11     8.13e-12     1.641931     .5982513  |
   8 |          x7     7.015422     7.015422    -1.00e-11    -2.82e-12     3.555432     1.161761  |
   9 |         x90     .0839738     .0839738    -1.05e-14    -1.09e-14     .9597153     .8505325  |
  10 |         x91    -.0648837    -.0648837     3.35e-12     3.57e-12       .93861     .9922891  |
  11 |         x92     .0575388     .0575388    -1.11e-12    -1.07e-12      1.03554     1.118263  |
  12 |         x93     .1016523     .1016523    -1.98e-12    -2.09e-12     .9463749     1.012572  |
  13 |         x94    -.1252265    -.1252265     1.63e-12     1.78e-12     .9147554     .7576623  |
  14 |         x95    -.1044649    -.1044649     6.17e-13     6.80e-13     .9069849     .8646431  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  2.95033e-24
  Mean absolute standardized diff.
  2.63972e-12
  Maximum absolute standardized diff.
  8.13242e-12
  C.V. of matching weights:
  1.031924564
  S.D. of matching weights:
  1.02710789
  Skewness of matching weights:
  .1135011509
  Kurtosis of matching weights:
  .0229206639
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.367            5.17e-10            3431.367  |
  3 |          y1_binary            .9509094            .9509094            1.84e-13            .9509094  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","cbps", 1, 0, (1,.75,6))
Warning: cvopt does not appear to substantially affect the reults with fctn=cbps. Consider switching to fctn=sd_sq or mean_sd_sq
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .17799586  
Iteration 1:   f(p) =  .17799428  (backed up)
Iteration 2:   f(p) =  .17798375  
Iteration 3:   f(p) =  .17798365  
Iteration 4:   f(p) =  .17798365  
Iteration 5:   f(p) =  .17798364  
Iteration 6:   f(p) =  .17798171  
Iteration 7:   f(p) =     .17798  
Iteration 8:   f(p) =  .17797995  
Iteration 9:   f(p) =  .17797995  
Iteration 10:  f(p) =  .17797995  
Iteration 11:  f(p) =  .17797995  
(switching technique to nr)
Iteration 12:  f(p) =  .17797989  
Iteration 13:  f(p) =  .17797853  
Iteration 14:  f(p) =  .17797852  
Iteration 15:  f(p) =  .17797852  
Iteration 16:  f(p) =  .17797852  (backed up)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.447029858   -1.546957039   -.4711250881   -.3822612275    .0635810203   -.2432253195    .0477030324     .133496012   -.1336042893    .1522876577
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .075771114   -.1016181111   -.0383357689    .6265858817  |
     -------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512254    -2.28e-06    -4.57e-06     .4990018     1.004327  |
   3 |        1.x2     .0114039     .0114028     1.10e-06     .0000103     .1064741     1.004424  |
   4 |        1.x3     .0240637     .0240619     1.83e-06     .0000119     .1536741     1.004402  |
   5 |          x4     .4218861     .4218858     3.47e-07     7.00e-07     .4952368     1.004328  |
   6 |          x5     25.44699     25.44699    -7.28e-08    -1.34e-08     5.422129     .6144678  |
   7 |          x6     11.84757     11.84758    -7.96e-06    -4.85e-06     1.641931     .5982507  |
   8 |          x7     7.015422      7.01543    -8.81e-06    -2.48e-06     3.555432      1.16176  |
   9 |         x90     .0839738     .0839704     3.43e-06     3.58e-06     .9597153     .8505319  |
  10 |         x91    -.0648837    -.0648782    -5.53e-06    -5.89e-06       .93861     .9922873  |
  11 |         x92     .0575388     .0575326     6.12e-06     5.91e-06      1.03554     1.118264  |
  12 |         x93     .1016523     .1016513     1.04e-06     1.10e-06     .9463749     1.012569  |
  13 |         x94    -.1252265    -.1252272     7.45e-07     8.14e-07     .9147554     .7576633  |
  14 |         x95    -.1044649    -.1044615    -3.48e-06    -3.84e-06     .9069849     .8646435  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  9.46598e-13
  Mean absolute standardized diff.
  4.30250e-06
  Maximum absolute standardized diff.
  .0000118814
  C.V. of matching weights:
  1.031917533
  S.D. of matching weights:
  1.027100831
  Skewness of matching weights:
  .1135002103
  Kurtosis of matching weights:
  .0229202661
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.368           -.0012221            3431.368  |
  3 |          y1_binary            .9509094            .9509095           -1.11e-07            .9509095  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","cbps", 1, 0, (1,.50,6))
Warning: cvopt does not appear to substantially affect the reults with fctn=cbps. Consider switching to fctn=sd_sq or mean_sd_sq
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.04895  
Iteration 2:   f(p) = -411.28759  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .01564235  
Iteration 1:   f(p) =  .01563174  
Iteration 2:   f(p) =  .01563166  
Iteration 3:   f(p) =  .01563166  
Iteration 4:   f(p) =  .01563166  
Iteration 5:   f(p) =  .01563163  
Iteration 6:   f(p) =  .01563123  
Iteration 7:   f(p) =  .01562716  
Iteration 8:   f(p) =  .01562646  
Iteration 9:   f(p) =  .01562645  
Iteration 10:  f(p) =  .01562645  
Iteration 11:  f(p) =  .01562645  
(switching technique to nr)
Iteration 12:  f(p) =  .01562645  
Iteration 13:  f(p) =  .01562501  
Iteration 14:  f(p) =    .015625  
Iteration 15:  f(p) =    .015625  
Iteration 16:  f(p) =    .015625  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.447045665   -1.546894224   -.4710655698   -.3822544863    .0635822705    -.243227075    .0477027048    .1334991615   -.1336111486    .1522936049
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1      .075773132   -.1016171326   -.0383387697    .6265789704  |
     -------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512233    -1.29e-07    -2.59e-07     .4990018     1.004328  |
   3 |        1.x2     .0114039     .0114038     5.58e-08     5.24e-07     .1064741     1.004333  |
   4 |        1.x3     .0240637     .0240636     8.93e-08     5.81e-07     .1536741     1.004332  |
   5 |          x4     .4218861     .4218861     2.19e-08     4.43e-08     .4952368     1.004328  |
   6 |          x5     25.44699     25.44698     1.14e-06     2.10e-07     5.422129     .6144663  |
   7 |          x6     11.84757     11.84757     1.01e-07     6.13e-08     1.641931     .5982513  |
   8 |          x7     7.015422     7.015422    -2.88e-07    -8.09e-08     3.555432     1.161761  |
   9 |         x90     .0839738     .0839738     5.56e-08     5.79e-08     .9597153     .8505324  |
  10 |         x91    -.0648837    -.0648833    -3.76e-07    -4.01e-07       .93861     .9922889  |
  11 |         x92     .0575388     .0575386     1.37e-07     1.33e-07      1.03554     1.118263  |
  12 |         x93     .1016523     .1016523     5.48e-08     5.79e-08     .9463749     1.012572  |
  13 |         x94    -.1252265    -.1252265     1.98e-08     2.17e-08     .9147554     .7576623  |
  14 |         x95    -.1044649    -.1044647    -2.85e-07    -3.14e-07     .9069849     .8646431  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  2.39664e-15
  Mean absolute standardized diff.
  2.11202e-07
  Maximum absolute standardized diff.
  5.80789e-07
  C.V. of matching weights:
  1.031924268
  S.D. of matching weights:
  1.027107584
  Skewness of matching weights:
  .1135011307
  Kurtosis of matching weights:
  .0229206584
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.367           -.0000196            3431.367  |
  3 |          y1_binary            .9509094            .9509094           -9.01e-10            .9509094  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","mean_sd_sq", 1, 0, (1,.75,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00118407  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00047827  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00006974  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00004509  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  9.893e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  2.962e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  1.695e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  6.547e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  2.889e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  1.307e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  8.558e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  7.610e-08  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  6.398e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  2.236e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  1.796e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  1.364e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  1.276e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  9.084e-10  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  5.549e-10  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  5.143e-10  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  3.836e-10  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  3.371e-10  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  7.528e-13  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  3.621e-14  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  3.015e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  2.545e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  1.952e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  1.884e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  1.877e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  1.871e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  1.406e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  1.294e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  1.283e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  1.281e-16  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 34:  f(p) =  8.378e-17  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 35:  f(p) =  6.059e-17  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.249358569   -1.626167397   -.4803350337    -.262010737     .002723899   -.0355859293   -.0172989768    .0149658177   -.1033867042    .1073470982
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1    -.0849274281   -.0978387647    -.032509563    1.256772415  |
     -------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4707037    -.0194806    -.0390391     .4990018     .9981969  |
   3 |        1.x2     .0114039     .0096564     .0017475     .0164124     .1064741     1.183986  |
   4 |        1.x3     .0240637     .0211209     .0029428     .0191497     .1536741     1.140823  |
   5 |          x4     .4218861     .5009078    -.0790217    -.1595635     .4952368     .9798184  |
   6 |          x5     25.44699     24.58965     .8573351     .1581178     5.422129     .7625045  |
   7 |          x6     11.84757      12.4132    -.5656277    -.3444894     1.641931     .5476945  |
   8 |          x7     7.015422     6.414085     .6013365     .1691318     3.555432     1.145332  |
   9 |         x90     .0839738     .0118324     .0721414     .0751696     .9597153     .8427132  |
  10 |         x91    -.0648837    -.0647897     -.000094    -.0001002       .93861     .9652767  |
  11 |         x92     .0575388     .0752692    -.0177304    -.0171219      1.03554     1.085538  |
  12 |         x93     .1016523    -.0430683     .1447206      .152921     .9463749     .9504488  |
  13 |         x94    -.1252265    -.1245777    -.0006488    -.0007093     .9147554     .8186894  |
  14 |         x95    -.1044649    -.0773651    -.0270998     -.029879     .9069849     .8544649  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  2.25813e-18
  Mean absolute standardized diff.
  .0909080436
  Maximum absolute standardized diff.
  .3444893777
  C.V. of matching weights:
  .751969346
  S.D. of matching weights:
  .7482253012
  Skewness of matching weights:
  .0823111222
  Kurtosis of matching weights:
  .0124576756
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3435.752            3456.654           -20.90224            3456.654  |
  3 |          y1_binary            .9503328            .9611166           -.0107838            .9611166  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","mean_sd_sq", 1, 0, (1,.50,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .03174366  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .01880683  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01499079  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00460016  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00088681  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00069868  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00016284  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00008031  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00004972  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00003906  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00003723  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00002755  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00001175  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =   .0000104  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  4.104e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  2.518e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  8.956e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  6.250e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  6.018e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  5.226e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  3.482e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  3.352e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  3.207e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  2.038e-07  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  1.920e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  1.812e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  1.778e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  1.767e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  1.767e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  1.746e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  1.639e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  1.616e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  1.615e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  1.615e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 34:  f(p) =  1.615e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 35:  f(p) =  1.615e-07  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 36:  f(p) =  1.608e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 37:  f(p) =  9.150e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 38:  f(p) =  8.189e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 39:  f(p) =  8.037e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 40:  f(p) =  7.887e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 41:  f(p) =  5.407e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 42:  f(p) =  5.354e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 43:  f(p) =  5.169e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 44:  f(p) =  5.011e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 45:  f(p) =  4.109e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 46:  f(p) =  3.836e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 47:  f(p) =  3.530e-08  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 48:  f(p) =  3.373e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 49:  f(p) =  3.328e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 50:  f(p) =  3.314e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 51:  f(p) =  3.305e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 52:  f(p) =  3.305e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 53:  f(p) =  3.305e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 54:  f(p) =  3.292e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 55:  f(p) =  3.267e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 56:  f(p) =  3.266e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 57:  f(p) =  3.266e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 58:  f(p) =  3.266e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 59:  f(p) =  3.266e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.8655474837   -2.012498434   -.5331544261   -.2009153444    .0074919838   -.0269136498   -.0241028813   -.1063025417   -.1486142581    -.117340159
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14
     -------------------------------------------------------------+
  1    -.0916431406   -.0834430489   -.1485137745    1.248261659  |
     -------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .5840585    -.1328353     -.266202     .4990018     1.023703  |
   3 |        1.x2     .0114039     .0056038     .0058001      .054474     .1064741     2.031914  |
   4 |        1.x3     .0240637     .0189987      .005065     .0329596     .1536741     1.265513  |
   5 |          x4     .4218861     .4945447    -.0726586     -.146715     .4952368     .9799319  |
   6 |          x5     25.44699     25.48452    -.0375313    -.0069219     5.422129     .7621934  |
   7 |          x6     11.84757     12.64643    -.7988609    -.4865375     1.641931      .523746  |
   8 |          x7     7.015422     6.453984     .5614375     .1579098     3.555432     1.122084  |
   9 |         x90     .0839738    -.1127792      .196753     .2050119     .9597153      .874998  |
  10 |         x91    -.0648837    -.1158463     .0509626     .0542958       .93861      .961266  |
  11 |         x92     .0575388    -.1337106     .1912494     .1846856      1.03554     1.083012  |
  12 |         x93     .1016523    -.0386913     .1403437     .1482961     .9463749     .8963407  |
  13 |         x94    -.1252265      -.10533    -.0198964    -.0217506     .9147554     .8151421  |
  14 |         x95    -.1044649    -.1864815     .0820166     .0904277     .9069849      .847116  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  2.61339e-11
  Mean absolute standardized diff.
  .1427836434
  Maximum absolute standardized diff.
  .4865374905
  C.V. of matching weights:
  .5565306635
  S.D. of matching weights:
  .5556313865
  Skewness of matching weights:
  .0742515871
  Kurtosis of matching weights:
  .0140383956
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3443.819            3477.191           -33.37222            3477.191  |
  3 |          y1_binary            .9510691            .9625367           -.0114677            .9625367  |
    +-----------------------------------------------------------------------------------------------------+

: 
: 
: end  // end of Mata block
----------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. log close gmatch_example
      name:  gmatch_example
       log:  C:\Users\kkranker\Documents\Stata\Ado\Devel\gmatch\gmatch_example.log
  log type:  text
 closed on:  14 Feb 2018, 01:24:05
----------------------------------------------------------------------------------------------------------------------------------------------------------------
