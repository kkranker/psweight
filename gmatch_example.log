----------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  gmatch_example
       log:  C:\Users\kkranker\Documents\Stata\Ado\Devel\gmatch\gmatch_example.log
  log type:  text
 opened on:  22 Feb 2018, 12:58:03

. 
. // ***************************************************************************
. *! $Id: gmatch_example.do,v da95dc2cef90 2018/02/22 19:55:31 kkranker $
. *! Generalization of IPW and CBPS estimators
. *! Example files
. //
. *! By Keith Kranker
. // Last updated $Date: 2018/02/22 19:55:31 $
. //
. // Copyright (C) Mathematica Policy Research, Inc.
. // This code cannot be copied, distributed or used without the express written
. // permission of Mathematica Policy Research, Inc.
. // ***************************************************************************
. 
. version 15.1

. set type double

. di as txt "Current user: `c(username)'" _n "Environment: `c(os)' `c(machine_type)' `: environment computername'" _n "Stata: `c(stata_version)'" cond(c(stata_v
> ersion)==c(version),""," (set to version `c(version)')") _n "Date: " c(current_date) " " c(current_time)
Current user: KKranker
Environment: Windows PC (64-bit x86-64) KKRANKER
Stata: 15.1
Date: 22 Feb 2018 12:58:03

. 
. which gmatch
.\gmatch.ado
*! $Id: gmatch.ado,v 1d7bb6ea04c0 2018/02/14 22:05:21 kkranker $
*! Generalization of IPW and CBPS estimators
*! Stata command to estimate models
*! By Keith Kranker

. which gmatchcall
.\gmatchcall.ado
*! $Id: gmatchcall.ado,v 3a696a7b31b4 2018/02/14 07:28:04 kkranker $
*! Generalization of IPW and CBPS estimators
*! Stata command to call class functions on an instance of the class
*! named gmatch_ado_most_recent
*! By Keith Kranker

. mata: mata describe using lgmatch
(library contains 50 members)


      # bytes   type                        name and extent
-------------------------------------------------------------------------------
        4,112   auto classdef scalar        gmatch()
          852   auto real matrix             ::Ct()
          208   auto real rowvector          ::asd()
        1,504   auto void                    ::balanceresults()
        1,312   auto real matrix             ::balancetable()
          628   auto void                    ::calcN()
          816   auto void                    ::calccovariances()
          320   auto void                    ::calcmeans()
          576   auto void                    ::calcvariances()
        6,456   auto real rowvector          ::cbps()
        2,136   auto void                    ::cbps_port_r()
          768   auto void                    ::cbps_port_stata()
          676   auto real matrix             ::cbps_port_stata_gradient()
          748   auto real colvector          ::cbps_port_stata_moments()
        1,668   auto real matrix             ::cbps_port_stata_wgt_matrix()
        3,148   auto void                    ::cbpseval()
          592   auto void                    ::clone()
          568   auto real rowvector          ::diagvariance()
          168   auto real rowvector          ::diff()
          336   auto real scalar             ::entropydistance()
          968   auto void                    ::get_scores()
          712   auto real rowvector          ::ipw()
        1,816   auto real rowvector          ::logitbeta()
          524   auto real colvector          ::logitpredict()
        1,292   auto real colvector          ::logitweights()
          232   auto real scalar             ::max_asd()
          240   auto real scalar             ::mean_asd()
          272   auto real scalar             ::mean_sd_sq()
           96   auto void                    ::new()
          688   auto real rowvector          ::olsbeta()
          468   auto real colvector          ::olspredict()
          264   auto real rowvector          ::pomean()
          752   auto void                    ::postbeta()
        1,200   auto real rowvector          ::prognosticdiff()
          728   auto void                    ::reweight()
          224   auto real rowvector          ::sd_sq()
        1,616   auto void                    ::set()
          264   auto void                    ::set_Y()
          852   auto real rowvector          ::stddiff()
          512   auto real colvector          ::trim()
          168   auto real rowvector          ::varratio()
          200   auto real scalar             ::wgt_cv()
          264   auto real scalar             ::wgt_kurtosis()
          488   auto real scalar             ::wgt_max()
          784   auto real rowvector          ::wgt_moments()
          140   auto real scalar             ::wgt_sd()
          272   auto real scalar             ::wgt_skewness()
          412   auto void                   gmatch_cbps_eval()
          504   auto void                   gmatch_logit_eval()
        2,276   auto void                   optimize_init_mlopts()
-------------------------------------------------------------------------------

. 
. ************************************************************************************
. * Describe/summarize the example datasets
. ************************************************************************************
. 
. *** Input data file (simple_cattaneo_data) comes from the program named Make_example_datasets.do (in C:\Users\kkranker\Documents\Stata\Multiple-Equation-Model
> s)
. 
. use "C:\Users\kkranker\Documents\Stata\Multiple-Equation-Models\simple_cattaneo_data.dta"
(Cattaneo (2010) study on the effect of maternal smoking on birth weight)

. desc, short

Contains data from C:\Users\kkranker\Documents\Stata\Multiple-Equation-Models\simple_cattaneo_data.dta
  obs:         4,642                          Cattaneo (2010) study on the effect of maternal smoking on birth weight
 vars:            11                          8 Apr 2015 05:07
 size:        55,704                          
Sorted by: 

. notes _dta

_dta:
  1.  Cattaneo (2010) study on the effect of maternal smoking on birth weight
  2.  Dataset created by Keith Kranker (program name: make_example_datasets.do)
  3.  Source: Cattaneo, M. D. 2010. "Efficient Semiparametric Estimation of Multi-Valued Treatment Effects under Ignorability." Journal of Econometrics, 155(2):
      138–154, doi:10.1016/j.jeconom.2009.09.023.
  4.  Source: Almond, D., Chay, K.Y., Lee, D.S., 2005. "The costs of low birth weight." Quarterly Journal of Economics, 120: 1031-1083.
  5.  Original dataset downloaded 4/3/2015 via Stata command ". webuse cattaneo2"
  6.  The variable names in the original datasets are replaced with "generic" names: (1) The outcome variables are named y1 y2 y3... (2) The treatment variable
      is named treat (binary) or treat_cat (categorical). (3) The control variables are named x1 x2 x3...

. summ, sep(0)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       treat |      4,642    .1861267    .3892508          0          1
   treat_cat |      4,642    .3996122    .8988632          0          3
          x1 |      4,642    .6996984    .4584385          0          1
          x2 |      4,642    .0340371    .1813439          0          1
          x3 |      4,642    .0534252    .2249042          0          1
          x4 |      4,642    .4379578    .4961893          0          1
          x5 |      4,642    26.50452    5.619026         13         45
          x6 |      4,642    12.68957    2.520661          0         17
          x7 |      4,642    6.540069    3.359167          1         12
          y1 |      4,642     3361.68    578.8196        340       5500
   y1_binary |      4,642    .9396812    .2381022          0          1

. tab treat treat_cat, mi

           |                  treat_cat
     treat | Untreated  1st Treat  2nd Treat  3rd Treat |     Total
-----------+--------------------------------------------+----------
 Untreated |     3,778          0          0          0 |     3,778 
   Treated |         0        200        337        327 |       864 
-----------+--------------------------------------------+----------
     Total |     3,778        200        337        327 |     4,642 


. corr treat y1 y1_binary
(obs=4,642)

             |    treat       y1 y1_bin~y
-------------+---------------------------
       treat |   1.0000
          y1 |  -0.1851   1.0000
   y1_binary |  -0.0997   0.5924   1.0000


. 
. local if if _n<=500

. set seed 1

. gen wgt = max(.1,rnormal(2,.4))

. gen fwgt = round(rnormal(2,.4))

. // forvalues i = 20/200 {
. forvalues i = 90/95 {
  2.   gen x`i' = rnormal()
  3. }

. 
. local depvars = "y1 y1_binary"

. local treatvar = "treat"

. local varlist = "x1 i.x2 i.x3 x4 x5 x6 x7 x9*"

. local wgtvar = "wgt"

. local tousevar = "touse"

. local estimate = "atet"

. 
. 
. // some automatic parsing based on options above, since Mata doesn't have this stuff
. if "`wgtvar'"!="" local wgtexp "[iw=`wgtvar']"

. mark    `tousevar' `if' `in' `wgtexp'

. markout `tousevar' `depvars' `treatvar' `varlist'

. local varlist_orig : copy local varlist

. 
. _rmcoll `treatvar' `varlist' if `tousevar' `wgtexp', expand logit touse(`tousevar')


. local varlist `r(varlist)'

. gettoken trash varlist : varlist

. 
. 
. // *******************************
. // * RUN MODELS DIRECTLY IN MATA *
. // *******************************
. 
. mata:
------------------------------------------------- mata (type end to exit) --------------------------------------------------------------------------------------
: 
: depvars  = st_local("depvars" )

: treatvar = st_local("treatvar")

: wgtvar   = st_local("wgtvar"  )

: varlist  = st_local("varlist" )

: tousevar = st_local("tousevar")

: estimate = st_local("estimate")

: // * UNWEIGHTED DATA EXAMPLES *
: 
: D = gmatch()

: D.set(treatvar, varlist, tousevar)
  408 control obs
  92 treatment obs
  (Data are unweighted.)

: if (depvars!="") D.set_Y(depvars,tousevar)
> 
> // Misc balance measures
>   D.diff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.2826086957              0   -.0160912191              0   -.0223785166   -.0603154305   -1.101236147   -1.289748508    .1626172208    .1457104569
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1    -.0812723301    .0681588142    .0461833248   -.1459731942   -.0148968728  |
     ----------------------------------------------------------------------------+

:   D.stddiff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.563336463              .   -.1543415516              .   -.1526193687   -.1210072453    -.202287272   -.8035533326    .0457213254    .1527707004
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1      -.08618905    .0648405717    .0493954389   -.1578414414    -.016298459  |
     ----------------------------------------------------------------------------+

:   D.mean_asd()
  .1977078631

:   D.stddiff(1)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.563336463              .   -.1543415516              .   -.1526193687   -.1210072453    -.202287272   -.8035533326    .0457213254    .1527707004
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1      -.08618905    .0648405717    .0493954389   -.1578414414    -.016298459  |
     ----------------------------------------------------------------------------+

:   D.stddiff(0)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.6518565108              .   -.0992258067              .   -.1088403741    -.120488729   -.1874830308   -.5658268397    .0492441608    .1472428581
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1    -.0808153611    .0677010963    .0466680215   -.1471098503   -.0148355423  |
     ----------------------------------------------------------------------------+

:   D.varratio()
                 1             2             3             4             5             6             7             8             9            10
    +---------------------------------------------------------------------------------------------------------------------------------------------
  1 |  1.338962118             .   .4133172708             .   .5085817193   .9914483579   .8589874442   .4958355659   1.160037045   .9289414423
    +---------------------------------------------------------------------------------------------------------------------------------------------
                11            12            13            14            15
     -----------------------------------------------------------------------+
  1    .8791918375   1.090178798   .8926168505   .8686432131   .8285405428  |
     -----------------------------------------------------------------------+

:   D.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3444.538            3460.475           -15.93746            3460.475  |
  3 |          y1_binary            .9482656            .9607843           -.0125187            .9607843  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |  -15.93745522   -.0125187159  |
    +-------------------------------+

: 
:   "Balance table before matching"
  Balance table before matching

:   table = D.balancetable(1)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913          .75    -.2826087    -.5633365     .5016695     1.338962  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0269608    -.0160912    -.1543416     .1042572     .4133173  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0441176    -.0223785    -.1526194     .1466296     .5085817  |
   7 |          x4     .4347826      .495098    -.0603154    -.1210072     .4984448     .9914484  |
   8 |          x5     25.46739     26.56863    -1.101236    -.2022873     5.443922     .8589874  |
   9 |          x6     11.86957     13.15931    -1.289749    -.8035533     1.605057     .4958356  |
  10 |          x7     6.858696     6.696078     .1626172     .0457213     3.556704     1.160037  |
  11 |         x90     .0972024     -.048508     .1457105     .1527707     .9537854     .9289414  |
  12 |         x91    -.0890157    -.0077434    -.0812723    -.0861891     .9429542     .8791918  |
  13 |         x92     .0453787    -.0227801     .0681588     .0648406     1.051175     1.090179  |
  14 |         x93     .0865687     .0403853     .0461833     .0493954     .9349714     .8926169  |
  15 |         x94    -.1299173     .0160559    -.1459732    -.1578414     .9248091     .8686432  |
  16 |         x95    -.0807251    -.0658282    -.0148969    -.0162985      .914005     .8285405  |
     +--------------------------------------------------------------------------------------------+

: 
: // Replicate CBPS
: 
:   "--- ATE (not overidentified) ---"; ""; ""
  --- ATE (not overidentified) ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , ate      logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .00647386  
Iteration 1:   f(p) =  .00451406  
Iteration 2:   f(p) =   .0005336  
Iteration 3:   f(p) =  .00001373  
Iteration 4:   f(p) =  2.637e-08  
Iteration 5:   f(p) =  6.777e-13  
Iteration 6:   f(p) =  1.066e-21  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.441064   .5046768    -2.86   0.004    -2.430213   -.4519161
        1.x2 |  -2.548784   3.501511    -0.73   0.467     -9.41162    4.314051
        1.x3 |   -1.02318   2.005094    -0.51   0.610    -4.953091    2.906732
          x4 |  -.2320966   .5678014    -0.41   0.683    -1.344967    .8807737
          x5 |   .0736983    .042799     1.72   0.085    -.0101862    .1575829
          x6 |  -.4863391   .1923869    -2.53   0.011    -.8634106   -.1092676
          x7 |   .0655415   .0720901     0.91   0.363    -.0757525    .2068354
         x90 |   .0303861    .203675     0.15   0.881    -.3688096    .4295819
         x91 |  -.0236437   .2499136    -0.09   0.925    -.5134655     .466178
         x92 |   .2014652   .2092517     0.96   0.336    -.2086606    .6115911
         x93 |  -.0067202   .2511949    -0.03   0.979    -.4990531    .4856126
         x94 |  -.3662317   .2431817    -1.51   0.132     -.842859    .1103956
         x95 |  -.0080118   .2531324    -0.03   0.975    -.5041423    .4881187
       _cons |   3.127763   1.826429     1.71   0.087    -.4519713    6.707497
------------------------------------------------------------------------------

:     stata(`"cbps_imbalance"')
Total average covariate imbalance: 1.5e-10
Average covariate imbalance on the treated: 1.26

:     D.cbps("ate", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  2.590e-08  
Iteration 1:   f(p) =  2.548e-08  (backed up)
Iteration 2:   f(p) =  1.980e-08  
Iteration 3:   f(p) =  1.652e-08  
Iteration 4:   f(p) =  1.627e-08  
Iteration 5:   f(p) =  1.540e-08  
Iteration 6:   f(p) =  1.451e-08  
Iteration 7:   f(p) =  1.377e-08  
Iteration 8:   f(p) =  1.290e-08  
Iteration 9:   f(p) =  1.195e-08  
Iteration 10:  f(p) =  1.168e-08  
Iteration 11:  f(p) =  1.075e-08  
(switching technique to nr)
Iteration 12:  f(p) =  1.026e-08  
Iteration 13:  f(p) =  7.037e-09  
Iteration 14:  f(p) =  2.042e-10  
Iteration 15:  f(p) =  1.083e-12  
Iteration 16:  f(p) =  4.352e-17  
Iteration 17:  f(p) =  3.960e-25  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.441064364              0   -2.548784375              0   -1.023179787   -.2320965899    .0736983183   -.4863390836    .0655414714    .0303861209
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0236437103    .2014652341   -.0067202316   -.3662316849   -.0080118221    3.127762798  |
     -------------------------------------------------------------------------------------------+

:     D.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6750468      .6750468      1.72e-11      3.66e-11      .4688264      1.008511  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0219357      .0219357      1.15e-11      7.84e-11      .1466203      1.008511  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0370067      .0370067      2.40e-10      1.27e-09      .1889672      1.008511  |
   7 |           x4      .4861037      .4861037      5.20e-11      1.04e-10      .5003074      1.008511  |
   8 |           x5      26.25386      26.25386      2.87e-11      4.57e-12      6.268993      .6747771  |
   9 |           x6      12.63471      12.63471      4.25e-10      1.81e-10      2.343236      .5637225  |
  10 |           x7      6.724952      6.724952     -2.27e-10     -6.75e-11      3.360602      1.190087  |
  11 |          x90     -.0592246     -.0592246      6.94e-11      6.65e-11      1.042785      1.206644  |
  12 |          x91      .0116973      .0116973     -1.60e-10     -1.63e-10      .9810721      .9436962  |
  13 |          x92     -.0041245     -.0041245     -4.41e-11     -4.33e-11      1.020036      1.339887  |
  14 |          x93      .0443809      .0443809      3.13e-11      3.24e-11      .9681889      .8469644  |
  15 |          x94     -.0856689     -.0856689     -1.31e-11     -1.29e-11      1.015864      .7767335  |
  16 |          x95     -.0859154     -.0859154     -5.96e-12     -6.11e-12      .9766877      .8347645  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.29325e-20
  Mean absolute standardized diff.
  1.58820e-10
  Maximum absolute standardized diff.
  1.26794e-09
  C.V. of matching weights:
  .5275374066
  S.D. of matching weights:
  .5275374066
  Skewness of matching weights:
  .2158747756
  Kurtosis of matching weights:
  .0860729366
  Maximum matching weight:
  6.906400443
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3444.163            3444.163           -3.58e-08            3444.163  |
  3 |          y1_binary            .9544751            .9544751            1.12e-12            .9544751  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATE overidentified ---"; ""; ""
  --- ATE overidentified ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , ate over logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .02441999  (not concave)
Iteration 1:   f(p) =    .020112  
Iteration 2:   f(p) =  .01484746  
Iteration 3:   f(p) =   .0142955  
Iteration 4:   f(p) =  .01428412  
Iteration 5:   f(p) =  .01428407  
Iteration 6:   f(p) =  .01428407  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.074574   .2572873    -4.18   0.000    -1.578848      -.5703
        1.x2 |  -1.732571    .847337    -2.04   0.041    -3.393321   -.0718214
        1.x3 |   -.535995   .6259896    -0.86   0.392    -1.762912    .6909221
          x4 |  -.2389831   .2458124    -0.97   0.331    -.7207666    .2428004
          x5 |   .0484453   .0243181     1.99   0.046     .0007828    .0961078
          x6 |  -.2519975   .0459113    -5.49   0.000    -.3419819    -.162013
          x7 |   .0081703   .0322545     0.25   0.800    -.0550474    .0713879
         x90 |    .120204   .1075227     1.12   0.264    -.0905366    .3309445
         x91 |  -.1467757   .1099013    -1.34   0.182    -.3621782    .0686269
         x92 |   .1315867   .1151671     1.14   0.253    -.0941367    .3573101
         x93 |    .086207   .1113523     0.77   0.439    -.1320395    .3044534
         x94 |  -.1702521    .103099    -1.65   0.099    -.3723225    .0318183
         x95 |   .0217906    .112224     0.19   0.846    -.1981643    .2417456
       _cons |   1.206345   .6074599     1.99   0.047      .015746    2.396945
------------------------------------------------------------------------------
J test for overidentifying restrictions: P(chisq>7.142, 14) = 0.929

:     stata(`"cbps_imbalance"')
Total average covariate imbalance: .313
Average covariate imbalance on the treated: .168

:     D.cbps("ate", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  9.768e-08  
Iteration 1:   f(p) =  9.599e-08  (backed up)
Iteration 2:   f(p) =  7.672e-08  
Iteration 3:   f(p) =  6.399e-08  
Iteration 4:   f(p) =  6.304e-08  
Iteration 5:   f(p) =  6.026e-08  
Iteration 6:   f(p) =  5.854e-08  
Iteration 7:   f(p) =  5.801e-08  
Iteration 8:   f(p) =  5.780e-08  
Iteration 9:   f(p) =  5.775e-08  
Iteration 10:  f(p) =  5.764e-08  
Iteration 11:  f(p) =  5.743e-08  
(switching technique to nr)
Iteration 12:  f(p) =  5.722e-08  
Iteration 13:  f(p) =  5.714e-08  
Iteration 14:  f(p) =  5.714e-08  
Iteration 15:  f(p) =  5.714e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.074573785              0    -1.73257095              0   -.5359949351     -.23898303    .0484452934   -.2519974261    .0081702571    .1202039716
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1467756596    .1315866934    .0862070169   -.1702520909     .021790637    1.206345174  |
     -------------------------------------------------------------------------------------------+

:     D.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6406563      .7027893      -.062133     -.1343718      .4623962      1.111543  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0157701      .0233767     -.0076067     -.0518322      .1467555      .6856459  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3       .024807      .0398362     -.0150293     -.0794675      .1891246      .6378543  |
   7 |           x4      .4886894      .4862356      .0024538      .0049044      .5003233      1.008759  |
   8 |           x5      25.82556      26.34781     -.5222463      -.087499      5.968599        .75999  |
   9 |           x6      12.33004       12.9064     -.5763641     -.2576164      2.237296      .5881093  |
  10 |           x7       6.88452      6.669732      .2147883      .0639215      3.360189      1.180429  |
  11 |          x90     -.0713183     -.0265029     -.0448154     -.0441805      1.014371      1.157748  |
  12 |          x91      .0200089     -.0226109      .0426199       .043028      .9905145      .9174008  |
  13 |          x92      .0040221     -.0083767      .0123988       .012151      1.020391      1.200576  |
  14 |          x93      .0229491       .055179       -.03223     -.0331899      .9710769      .8891008  |
  15 |          x94      -.121595     -.0231316     -.0984633     -.0994521       .990058      .8143466  |
  16 |          x95     -.0950136      -.071595     -.0234187     -.0239408      .9781897      .8041468  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0027971508
  Mean absolute standardized diff.
  .0719657756
  Maximum absolute standardized diff.
  .2576163783
  C.V. of matching weights:
  .2958975504
  S.D. of matching weights:
  .2958975504
  Skewness of matching weights:
  .1574497662
  Kurtosis of matching weights:
  .0654318582
  Maximum matching weight:
  4.204588915
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3443.444            3453.946           -10.50205            3453.946  |
  3 |          y1_binary            .9509072            .9588221           -.0079149            .9588221  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET (not overidentified) ---"; ""; ""
  --- ATET (not overidentified) ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , att      logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .00197031  
Iteration 1:   f(p) =  .00006892  
Iteration 2:   f(p) =  1.777e-07  
Iteration 3:   f(p) =  2.570e-12  
Iteration 4:   f(p) =  6.940e-22  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.339291   .3615444    -3.70   0.000    -2.047905   -.6306769
        1.x2 |  -1.525175    1.19071    -1.28   0.200    -3.858923    .8085728
        1.x3 |  -.5996277   .8424377    -0.71   0.477    -2.250775     1.05152
          x4 |  -.3183658   .3103113    -1.03   0.305    -.9265647    .2898331
          x5 |   .0587883     .02835     2.07   0.038     .0032234    .1143533
          x6 |  -.2435676   .0675718    -3.60   0.000    -.3760059   -.1111292
          x7 |   .0341034   .0400884     0.85   0.395    -.0444685    .1126752
         x90 |    .158599   .1286436     1.23   0.218    -.0935378    .4107357
         x91 |  -.1617619    .131618    -1.23   0.219    -.4197284    .0962045
         x92 |   .1391156   .1358437     1.02   0.306    -.1271333    .4053644
         x93 |   .0571151    .134574     0.42   0.671    -.2066451    .3208752
         x94 |  -.1175052   .1193236    -0.98   0.325    -.3513752    .1163649
         x95 |    .011505   .1383574     0.08   0.934    -.2596705    .2826805
       _cons |    .782858    .962964     0.81   0.416    -1.104517    2.670233
------------------------------------------------------------------------------

:     stata(`"cbps_imbalance"')
Total average covariate imbalance: .374
Average covariate imbalance on the treated: 1.1e-10

:     D.cbps("atet", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  7.881e-09  
Iteration 1:   f(p) =  7.799e-09  (backed up)
Iteration 2:   f(p) =  7.301e-09  
Iteration 3:   f(p) =  5.045e-09  
Iteration 4:   f(p) =  4.162e-09  
Iteration 5:   f(p) =  3.700e-09  
Iteration 6:   f(p) =  3.063e-09  
Iteration 7:   f(p) =  2.655e-09  
Iteration 8:   f(p) =  2.353e-09  
Iteration 9:   f(p) =  2.232e-09  
Iteration 10:  f(p) =  1.928e-09  
Iteration 11:  f(p) =  1.687e-09  
(switching technique to nr)
Iteration 12:  f(p) =  1.155e-09  
Iteration 13:  f(p) =  8.181e-12  
Iteration 14:  f(p) =  4.655e-16  
Iteration 15:  f(p) =  2.607e-24  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.339290927              0   -1.525175229              0   -.5996277399   -.3183658287    .0587883339   -.2435675677    .0341033606    .1585989692
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1617619473    .1391155704    .0571150775   -.1175051975    .0115050157    .7828580418  |
     -------------------------------------------------------------------------------------------+

:     D.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4673913     -1.38e-10     -2.77e-10      .4994352      1.008511  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0108696      .0108696     -7.66e-11     -7.38e-10      .1037929      1.008511  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0217391      .0217391     -8.17e-11     -5.60e-10      .1459766      1.008511  |
   7 |           x4      .4347826      .4347826     -4.03e-10     -8.12e-10      .4962249      1.008511  |
   8 |           x5      25.46739      25.46739     -1.76e-09     -2.65e-10      6.664728      .6195799  |
   9 |           x6      11.86957      11.86957     -1.98e-09     -9.69e-10      2.043536      .5669465  |
  10 |           x7      6.858696      6.858696     -1.77e-10     -5.27e-11      3.363971      1.145237  |
  11 |          x90      .0972024      .0972024      4.54e-11      4.44e-11      1.021603       .845302  |
  12 |          x91     -.0890157     -.0890157     -3.25e-11     -3.40e-11      .9556678      .9654928  |
  13 |          x92      .0453787      .0453787      4.05e-11      4.06e-11      .9971707      1.136731  |
  14 |          x93      .0865687      .0865687     -6.32e-11     -6.65e-11        .95074      .9577067  |
  15 |          x94     -.1299173     -.1299173      5.29e-10      5.16e-10       1.02511      .7795321  |
  16 |          x95     -.0807251     -.0807251      8.07e-11      8.42e-11      .9586344      .8888006  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  5.64497e-20
  Mean absolute standardized diff.
  3.42968e-10
  Maximum absolute standardized diff.
  9.69352e-10
  C.V. of matching weights:
  .9884371288
  S.D. of matching weights:
  .9884371288
  Skewness of matching weights:
  .1100078305
  Kurtosis of matching weights:
  .0225364399
  Maximum matching weight:
  7.032260601
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.753            3424.753           -7.80e-09            3424.753  |
  3 |          y1_binary            .9470393            .9470393           -1.14e-11            .9470393  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET overidentified ---"; ""; ""
  --- ATET overidentified ---
  
  

:     stata(`"cbps `treatvar' `varlist' if `tousevar' , att over logit optimization_technique("nr") evaluator_type("gf1")"')
Iteration 0:   f(p) =  .04521356  
Iteration 1:   f(p) =  .03210384  
Iteration 2:   f(p) =   .0303286  
Iteration 3:   f(p) =   .0302734  
Iteration 4:   f(p) =  .03027339  
Iteration 5:   f(p) =  .03027339  
------------------------------------------------------------------------------
       treat |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat        |
          x1 |  -1.171988   .2187737    -5.36   0.000    -1.600776   -.7431991
        1.x2 |  -1.909814   .6607307    -2.89   0.004    -3.204822   -.6148052
        1.x3 |  -.4402667   .7269474    -0.61   0.545    -1.865057     .984524
          x4 |  -.3130788   .2251092    -1.39   0.164    -.7542848    .1281272
          x5 |   .0503881   .0191417     2.63   0.008     .0128711    .0879051
          x6 |  -.2393185   .0575186    -4.16   0.000     -.352053   -.1265841
          x7 |   .0261168   .0311563     0.84   0.402    -.0349484    .0871821
         x90 |   .1425533   .1007579     1.41   0.157    -.0549285    .3400351
         x91 |  -.1282785   .1127153    -1.14   0.255    -.3491964    .0926393
         x92 |      .1073   .1112316     0.96   0.335    -.1107099    .3253099
         x93 |   .0527165   .1101053     0.48   0.632    -.1630859    .2685189
         x94 |  -.1248021   .0971592    -1.28   0.199    -.3152305    .0656263
         x95 |   .0220743   .1115296     0.20   0.843    -.1965196    .2406683
       _cons |   .9132207   .6048419     1.51   0.131    -.2722476    2.098689
------------------------------------------------------------------------------
J test for overidentifying restrictions: P(chisq>15.137, 14) = 0.369

:     stata(`"cbps_imbalance"')
Total average covariate imbalance:  .34
Average covariate imbalance on the treated: .073

:     D.cbps("atet", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  1.809e-07  
Iteration 1:   f(p) =  1.775e-07  (backed up)
Iteration 2:   f(p) =  1.749e-07  
Iteration 3:   f(p) =  1.665e-07  
Iteration 4:   f(p) =  1.593e-07  
Iteration 5:   f(p) =  1.436e-07  
Iteration 6:   f(p) =  1.400e-07  
Iteration 7:   f(p) =  1.356e-07  
Iteration 8:   f(p) =  1.328e-07  
Iteration 9:   f(p) =  1.272e-07  
Iteration 10:  f(p) =  1.231e-07  
Iteration 11:  f(p) =  1.224e-07  
(switching technique to nr)
Iteration 12:  f(p) =  1.220e-07  
Iteration 13:  f(p) =  1.211e-07  
Iteration 14:  f(p) =  1.211e-07  
Iteration 15:  f(p) =  1.211e-07  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.171987636              0   -1.909811021              0   -.4402666692   -.3130787803    .0503880832   -.2393185049    .0261168262     .142553296
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1282785303      .10729995    .0527164662   -.1248020851    .0220743362    .9132203721  |
     -------------------------------------------------------------------------------------------+

:     D.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4923283     -.0249369      -.049839      .5003503      1.004458  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0108696      .0074884      .0033811      .0376593      .0897825      1.458884  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0217391       .023711     -.0019719     -.0130452       .151158      .9265074  |
   7 |           x4      .4347826      .4386729     -.0038903     -.0078334      .4966326      1.006495  |
   8 |           x5      25.46739      25.45801      .0093781      .0014148      6.628535      .6273162  |
   9 |           x6      11.86957      11.89491     -.0253428     -.0123239        2.0564       .559006  |
  10 |           x7      6.858696      6.790863      .0678324      .0201339       3.36906      1.140985  |
  11 |          x90      .0972024      .0826851      .0145173      .0142151      1.021263      .8460037  |
  12 |          x91     -.0890157     -.0671192     -.0218965     -.0227622      .9619657      .9503048  |
  13 |          x92      .0453787      .0235132      .0218655      .0219385      .9966695      1.138269  |
  14 |          x93      .0865687      .0849356       .001633      .0017143      .9526181      .9531308  |
  15 |          x94     -.1299173     -.1339674      .0040501      .0039553      1.023979      .7815571  |
  16 |          x95     -.0807251     -.0745052     -.0062199     -.0064787      .9600495      .8856706  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  7.49047e-07
  Mean absolute standardized diff.
  .016408746
  Maximum absolute standardized diff.
  .0498389801
  C.V. of matching weights:
  .9155855842
  S.D. of matching weights:
  .9155855842
  Skewness of matching weights:
  .1040781457
  Kurtosis of matching weights:
  .0213437013
  Maximum matching weight:
  6.683351127
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.722            3428.063           -3.341108            3428.063  |
  3 |          y1_binary            .9470466            .9484255           -.0013789            .9484255  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // Other objective functions
:   st_local("mlopts", "difficult nonrtolerance")

:   D.cbps("atet","mean_sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00032638  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  8.089e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  5.298e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  1.466e-13  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  1.466e-13  (backed up)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.206443392              0   -1.628676257              0    -.580309943    -.283233696    .0694159956   -.2787870498    .0283207984    .1446874281
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1     -.132201296    .1288212627    .0633599379   -.1645468755    .0190734331    1.379530321  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5065699    -.0391786    -.0780965     .5016695     1.004395  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0094032     .0014663     .0140644     .1042572      1.16405  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0217076     .0000315     .0002149     .1466296     1.009943  |
   7 |          x4     .4347826     .4181838     .0165988     .0333011     .4984448     1.018627  |
   8 |          x5     25.46739     26.05539    -.5880032     -.108011     5.443922     .5832672  |
   9 |          x6     11.86957     11.79935     .0702201     .0437493     1.605057     .5528997  |
  10 |          x7     6.858696      6.77528     .0834157     .0234531     3.556704     1.141156  |
  11 |         x90     .0972024      .056997     .0402054     .0421535     .9537854     .8487816  |
  12 |         x91    -.0890157     -.062197    -.0268186    -.0284411     .9429542     .9668971  |
  13 |         x92     .0453787     .0391245     .0062542     .0059497     1.051175     1.151879  |
  14 |         x93     .0865687       .10444    -.0178714    -.0191143     .9349714     .9622811  |
  15 |         x94    -.1299173    -.1873487     .0574314     .0621009     .9248091     .7465149  |
  16 |         x95    -.0807251    -.0886595     .0079344     .0086809      .914005     .8927751  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.46602e-13
  Mean absolute standardized diff.
  .0359485226
  Maximum absolute standardized diff.
  .1080109549
  C.V. of matching weights:
  1.041361038
  S.D. of matching weights:
  1.041361038
  Skewness of matching weights:
  .1710872074
  Kurtosis of matching weights:
  .0624911056
  Maximum matching weight:
  11.09495523
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.964            3426.474           -1.509749            3426.474  |
  3 |          y1_binary            .9468831            .9481476           -.0012645            .9481476  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .02141594  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .02005607  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01097598  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00782372  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00292673  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00193285  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00085471  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00063406  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00028285  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00013476  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00008047  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00006324  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =   .0000443  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  .00004163  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  .00003568  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  .00003416  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  .00002911  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  .00002237  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =    .000022  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  .00001249  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  .00001002  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  8.756e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  7.572e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  7.164e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  6.172e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  5.933e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  5.174e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  4.769e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  4.741e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  4.696e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  4.587e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  4.581e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  4.581e-06  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.341703722              0   -1.543769969              0   -.5899407662   -.3171857192    .0590428435   -.2438238842    .0338901475    .1591255804
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1623106947    .1388649619    .0569692098   -.1173516623    .0110794269    1.448512448  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4672233      .000168     .0003349     .5016695     1.008556  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0107162     .0001534      .001471     .1042572     1.022786  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0218697    -.0001306    -.0008905     .1466296     1.002624  |
   7 |          x4     .4347826     .4348664    -.0000838    -.0001682     .4984448     1.008466  |
   8 |          x5     25.46739     25.47025    -.0028597    -.0005253     5.443922     .6191968  |
   9 |          x6     11.86957     11.86871     .0008586     .0005349     1.605057      .566997  |
  10 |          x7     6.858696     6.856403     .0022926     .0006446     3.556704     1.145085  |
  11 |         x90     .0972024     .0975942    -.0003918    -.0004108     .9537854     .8453963  |
  12 |         x91    -.0890157    -.0894051     .0003894      .000413     .9429542     .9656707  |
  13 |         x92     .0453787     .0452596     .0001191     .0001133     1.051175     1.136345  |
  14 |         x93     .0865687     .0864977      .000071     .0000759     .9349714     .9579257  |
  15 |         x94    -.1299173    -.1297981    -.0001191    -.0001288     .9248091     .7792962  |
  16 |         x95    -.0807251    -.0810567     .0003316     .0003628      .914005     .8888576  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.97489e-08
  Mean absolute standardized diff.
  .0004672297
  Maximum absolute standardized diff.
  .0014710116
  C.V. of matching weights:
  .9896007712
  S.D. of matching weights:
  .9896007712
  Skewness of matching weights:
  .1101013871
  Kurtosis of matching weights:
  .0225784781
  Maximum matching weight:
  7.052811095
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.753            3424.699            .0535197            3424.699  |
  3 |          y1_binary            .9470394            .9470558           -.0000165            .9470558  |
    +-----------------------------------------------------------------------------------------------------+

:   st_local("mlopts", "")

: 
: // IPW
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , atet aequations")

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  4.978e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Treated vs Untreated)  |  -365.5251   68.93598    -5.30   0.000    -500.6371   -230.4131
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3417.895   43.41569    78.72   0.000     3332.801    3502.988
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.207512   .3268258    -3.69   0.000    -1.848079   -.5669452
                        |
                     x2 |
                     1  |  -1.628792   1.054719    -1.54   0.123    -3.696005    .4384199
                        |
                     x3 |
                     1  |  -.5805318   .8259794    -0.70   0.482    -2.199422    1.038358
                     x4 |  -.2831153   .2838113    -1.00   0.318    -.8393752    .2731445
                     x5 |   .0545179   .0270259     2.02   0.044     .0015481    .1074878
                     x6 |  -.2844593   .0688093    -4.13   0.000     -.419323   -.1495955
                     x7 |    .023871   .0390129     0.61   0.541    -.0525929    .1003349
                    x90 |   .1439494   .1292697     1.11   0.265    -.1094145    .3973133
                    x91 |  -.1331182   .1248073    -1.07   0.286    -.3777361    .1114997
                    x92 |   .1277527    .133834     0.95   0.340    -.1345572    .3900625
                    x93 |   .0623585   .1243317     0.50   0.616    -.1813271    .3060441
                    x94 |  -.1663354   .1194682    -1.39   0.164    -.4004887    .0678179
                    x95 |    .017776   .1254901     0.14   0.887    -.2281801     .263732
                  _cons |   1.379538   .9297905     1.48   0.138    -.4428177    3.201894
-----------------------------------------------------------------------------------------

:   stata("di _b[POmean:0.treat]")
3417.8947

:   stata("tebalance summarize")

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        247.8
                          Control obs   =          408        252.2
                          -----------------------------------------

  -----------------------------------------------------------------
                  |Standardized differences          Variance ratio
                  |        Raw    Weighted           Raw   Weighted
  ----------------+------------------------------------------------
               x1 |  -.6027752   -.0090577      1.338962   .9989677
                  |
               x2 |
               1  |  -.1180374    .0096998      .4133173   1.098626
                  |
               x3 |
               1  |  -.1253201    .0022927      .5085817   1.015318
                  |
               x4 |  -.1207472   -.0222549      .9914484   .9947225
               x5 |  -.1944638    .0308855      .8589874   .5917507
               x6 |  -.6542694    .0952268      .4958356   .5601212
               x7 |   .0473848    .0429284      1.160037   1.132231
              x90 |   .1499304    .0130255      .9289414   .8182649
              x91 |  -.0833726   -.0288848      .8791918   .9584288
              x92 |   .0662245    .0110605      1.090179   1.139468
              x93 |   .0479737   -.0087695      .8926169   .9659809
              x94 |  -.1521926    .0562648      .8686432   .7583723
              x95 |  -.0155155     .017858      .8285405   .8879817
  -----------------------------------------------------------------

:   stata("tebalance summarize, baseline")

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        247.8
                          Control obs   =          408        252.2
                          -----------------------------------------

  -----------------------------------------------------------------
                  |           Means                  Variances     
                  |    Control     Treated       Control    Treated
  ----------------+------------------------------------------------
               x1 |        .75    .4673913      .1879607   .2516722
                  |
               x2 |
               1  |   .0269608    .0108696      .0262984   .0108696
                  |
               x3 |
               1  |   .0441176    .0217391      .0422749   .0215002
                  |
               x4 |    .495098    .4347826      .2505902   .2484472
               x5 |   26.56863    25.46739      34.50142   29.63629
               x6 |   13.15931    11.86957      5.195687   2.576206
               x7 |   6.696078    6.858696      10.90495   12.65014
              x90 |   -.048508    .0972024      .9792937   .9097065
              x91 |  -.0077434   -.0890157      1.011341   .8891627
              x92 |  -.0227801    .0453787      1.013567    1.10497
              x93 |   .0403853    .0865687      .9793358   .8741716
              x94 |   .0160559   -.1299173      .9846065   .8552718
              x95 |  -.0658282   -.0807251      1.008285   .8354051
  -----------------------------------------------------------------

: 
:   D.ipw("atet")
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888              0   -1.628789297              0   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1331181675    .1277525862     .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet")
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4673913      .4719209     -.0045296     -.0090652      .4996633      1.007399  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0108696      .0098847      .0009849      .0098566      .0999227      1.107894  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0217391      .0214054      .0003337      .0023004      .1450795      1.023886  |
   7 |           x4      .4347826       .445852     -.0110694     -.0222576      .4973308      1.003118  |
   8 |           x5      25.46739      25.27307      .1943233      .0286772      6.776222       .596745  |
   9 |           x6      11.86957      11.68981      .1797533      .0877664      2.048089      .5648484  |
  10 |           x7      6.858696      6.711046      .1476493      .0438323      3.368502      1.141787  |
  11 |          x90      .0972024      .0841522      .0130502       .012645      1.032043      .8251709  |
  12 |          x91     -.0890157     -.0615794     -.0274362     -.0287197      .9553102      .9665176  |
  13 |          x92      .0453787      .0341522      .0112265      .0113068       .992897      1.149085  |
  14 |          x93      .0865687      .0948113     -.0082427     -.0087305        .94412      .9741335  |
  15 |          x94     -.1299173     -.1857505      .0558332      .0540116      1.033726      .7647728  |
  16 |          x95     -.0807251     -.0974964      .0167713      .0175493      .9556712      .8954759  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0002347319
  Mean absolute standardized diff.
  .0259014405
  Maximum absolute standardized diff.
  .0877663582
  C.V. of matching weights:
  1.041445132
  S.D. of matching weights:
  1.041445132
  Skewness of matching weights:
  .1334759569
  Kurtosis of matching weights:
  .0358990805
  Maximum matching weight:
  9.288959219
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.454            3417.895            6.559175            3417.895  |
  3 |          y1_binary            .9470413            .9465176            .0005237            .9465176  |
    +-----------------------------------------------------------------------------------------------------+

:   table = D.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4673913     .4719209    -.0045296    -.0090456     .5007475     1.007399  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0098847     .0009849     .0096855     .1016872     1.107894  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0214054     .0003337     .0022895     .1457719     1.023886  |
   7 |          x4     .4347826      .445852    -.0110694    -.0222252     .4980573     1.003118  |
   8 |          x5     25.46739     25.27307     .1943233     .0308606     6.296806      .596745  |
   9 |          x6     11.86957     11.68981     .1797533     .0951549     1.889059     .5648484  |
  10 |          x7     6.858696     6.711046     .1476493      .042865     3.444517     1.141787  |
  11 |         x90     .0972024     .0841522     .0130502     .0130107     1.003034     .8251709  |
  12 |         x91    -.0890157    -.0615794    -.0274362    -.0288473     .9510857     .9665176  |
  13 |         x92     .0453787     .0341522     .0112265     .0110442     1.016508     1.149085  |
  14 |         x93     .0865687     .0948113    -.0082427     -.008758     .9411576     .9741335  |
  15 |         x94    -.1299173    -.1857505     .0558332     .0562053     .9933796     .7647728  |
  16 |         x95    -.0807251    -.0974964     .0167713     .0178362     .9402985     .8954759  |
     +--------------------------------------------------------------------------------------------+

:   D.reweight()

:   table = D.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4673913          .75    -.2826087    -.6027752     .4688459     1.338962  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0269608    -.0160912    -.1180374      .136323     .4133173  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0441176    -.0223785    -.1253201     .1785709     .5085817  |
   7 |          x4     .4347826      .495098    -.0603154    -.1207472     .4995185     .9914484  |
   8 |          x5     25.46739     26.56863    -1.101236    -.1944638     5.662937     .8589874  |
   9 |          x6     11.86957     13.15931    -1.289749    -.6542694      1.97128     .4958356  |
  10 |          x7     6.858696     6.696078     .1626172     .0473848     3.431843     1.160037  |
  11 |         x90     .0972024     -.048508     .1457105     .1499304      .971854     .9289414  |
  12 |         x91    -.0890157    -.0077434    -.0812723    -.0833726     .9748086     .8791918  |
  13 |         x92     .0453787    -.0227801     .0681588     .0662245     1.029208     1.090179  |
  14 |         x93     .0865687     .0403853     .0461833     .0479737     .9626805     .8926169  |
  15 |         x94    -.1299173     .0160559    -.1459732    -.1521926     .9591346     .8686432  |
  16 |         x95    -.0807251    -.0658282    -.0148969    -.0155155     .9601277     .8285405  |
     +--------------------------------------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , ate aequations")

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  1.612e-25  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATE                     |
                  treat |
(Treated vs Untreated)  |   -328.878   82.21905    -4.00   0.000    -490.0244   -167.7316
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3452.527   28.58753   120.77   0.000     3396.497    3508.558
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.207512   .3268258    -3.69   0.000    -1.848079   -.5669452
                        |
                     x2 |
                     1  |  -1.628792   1.054719    -1.54   0.123    -3.696005    .4384199
                        |
                     x3 |
                     1  |  -.5805318   .8259794    -0.70   0.482    -2.199422    1.038358
                     x4 |  -.2831153   .2838113    -1.00   0.318    -.8393752    .2731445
                     x5 |   .0545179   .0270259     2.02   0.044     .0015481    .1074878
                     x6 |  -.2844593   .0688093    -4.13   0.000     -.419323   -.1495955
                     x7 |    .023871   .0390129     0.61   0.541    -.0525929    .1003349
                    x90 |   .1439494   .1292697     1.11   0.265    -.1094145    .3973133
                    x91 |  -.1331182   .1248073    -1.07   0.286    -.3777361    .1114997
                    x92 |   .1277527    .133834     0.95   0.340    -.1345572    .3900625
                    x93 |   .0623585   .1243317     0.50   0.616    -.1813271    .3060441
                    x94 |  -.1663354   .1194682    -1.39   0.164    -.4004887    .0678179
                    x95 |    .017776   .1254901     0.14   0.887    -.2281801     .263732
                  _cons |   1.379538   .9297905     1.48   0.138    -.4428177    3.201894
-----------------------------------------------------------------------------------------

:   D.ipw("ate")
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888              0   -1.628789297              0   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1331181675    .1277525862     .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("ate")
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6643106      .6980937     -.0337831     -.0730952      .4621798      1.067096  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0126474      .0237734      -.011126     -.0762399       .145934      .5426396  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0252967      .0398782     -.0145815     -.0769757      .1894293      .6494649  |
   7 |           x4      .5035684      .4859058      .0176626      .0352982       .500383      1.009262  |
   8 |           x5      25.88638       26.3268     -.4404207     -.0736253       5.98192      .7436049  |
   9 |           x6      12.40345      12.88502     -.4815643      -.214612      2.243884      .5994444  |
  10 |           x7      6.783391      6.698872      .0845182      .0251498       3.36059      1.188955  |
  11 |          x90     -.1279394     -.0237456     -.1041937     -.1022979      1.018533      1.179133  |
  12 |          x91      .0259183     -.0177924      .0437107      .0442269      .9883275      .9105384  |
  13 |          x92      .0197006     -.0121531      .0318537      .0312437      1.019527      1.201641  |
  14 |          x93      .0303493      .0505445     -.0201952     -.0208151      .9702151      .8788976  |
  15 |          x94      -.142924     -.0216133     -.1213108     -.1226343      .9892079      .7980325  |
  16 |          x95     -.0930146     -.0717394     -.0212752     -.0217631      .9775833      .7971968  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0024703949
  Mean absolute standardized diff.
  .0706136183
  Maximum absolute standardized diff.
  .2146119676
  C.V. of matching weights:
  .3337259551
  S.D. of matching weights:
  .3337259551
  Skewness of matching weights:
  .1843123883
  Kurtosis of matching weights:
  .0838509706
  Maximum matching weight:
  4.89816874
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3442.587            3452.527           -9.940045            3452.527  |
  3 |          y1_binary            .9516224            .9581213           -.0064989            .9581213  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' , atet aequations tlevel(0) control(1)")

Iteration 0:   EE criterion =  5.570e-18  
Iteration 1:   EE criterion =  3.813e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Untreated vs Treated)  |     319.07   91.15096     3.50   0.000     140.4174    497.7225
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
               Treated  |   3141.406   87.28586    35.99   0.000     2970.328    3312.483
------------------------+----------------------------------------------------------------
TME0                    |
                     x1 |   1.207512   .3268258     3.69   0.000     .5669452    1.848079
                        |
                     x2 |
                     1  |   1.628792   1.054719     1.54   0.123    -.4384199    3.696005
                        |
                     x3 |
                     1  |   .5805318   .8259794     0.70   0.482    -1.038358    2.199422
                     x4 |   .2831153   .2838113     1.00   0.318    -.2731445    .8393752
                     x5 |  -.0545179   .0270259    -2.02   0.044    -.1074878   -.0015481
                     x6 |   .2844593   .0688093     4.13   0.000     .1495955     .419323
                     x7 |   -.023871   .0390129    -0.61   0.541    -.1003349    .0525929
                    x90 |  -.1439494   .1292697    -1.11   0.265    -.3973133    .1094145
                    x91 |   .1331182   .1248073     1.07   0.286    -.1114997    .3777361
                    x92 |  -.1277527    .133834    -0.95   0.340    -.3900625    .1345572
                    x93 |  -.0623585   .1243317    -0.50   0.616    -.3060441    .1813271
                    x94 |   .1663354   .1194682     1.39   0.164    -.0678179    .4004887
                    x95 |   -.017776   .1254901    -0.14   0.887     -.263732    .2281801
                  _cons |  -1.379538   .9297905    -1.48   0.138    -3.201894    .4428177
-----------------------------------------------------------------------------------------

:   D.ipw("ateu")
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.207511888              0   -1.628789297              0   -.5805311763   -.2831151514    .0545179194   -.2844591542    .0238709471    .1439493406
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1331181675    .1277525862     .062358461   -.1663353311    .0177759205    1.379537282  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("ateu")
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .7133644           .75     -.0366356     -.0837821      .4372727      1.099818  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0130902      .0269608     -.0138706     -.0897954      .1544686      .4966403  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0261829      .0441176     -.0179347     -.0905493      .1980657       .609761  |
   7 |           x4      .5207033       .495098      .0256053      .0511594      .5005007      1.006879  |
   8 |           x5      25.99075      26.56863      -.577878     -.1002906      5.762036      .7963305  |
   9 |           x6      12.53645      13.15931     -.6228673     -.2813566        2.2138      .6382822  |
  10 |           x7      6.764632      6.696078      .0685532      .0204092      3.358927      1.200431  |
  11 |          x90     -.1840235      -.048508     -.1355155     -.1337092      1.013509      1.263776  |
  12 |          x91       .054549     -.0077434      .0622924      .0625861      .9953062      .8955527  |
  13 |          x92       .013304     -.0227801      .0360842      .0351881      1.025465       1.21557  |
  14 |          x93      .0163448      .0403853     -.0240406     -.0246383      .9757395       .857822  |
  15 |          x94     -.1461641      .0160559     -.1622201     -.1661874       .976127      .8119355  |
  16 |          x95      -.096076     -.0658282     -.0302478     -.0307892      .9824155      .7755988  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0040935914
  Mean absolute standardized diff.
  .0900339258
  Maximum absolute standardized diff.
  .2813566299
  C.V. of matching weights:
  .8301616273
  S.D. of matching weights:
  .8301616273
  Skewness of matching weights:
  .2680619555
  Kurtosis of matching weights:
  .1550433574
  Maximum matching weight:
  5.869225798
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3447.97            3460.475           -12.50512            3460.475  |
  3 |          y1_binary            .9524694            .9607843           -.0083149            .9607843  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // tradeoff between CBPS-like balance and variance in weights
:   D.cbps("atet","cbps", 1, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  7.881e-09  
Iteration 1:   f(p) =  7.799e-09  (backed up)
Iteration 2:   f(p) =  7.301e-09  
Iteration 3:   f(p) =  5.045e-09  
Iteration 4:   f(p) =  4.162e-09  
Iteration 5:   f(p) =  3.700e-09  
Iteration 6:   f(p) =  3.063e-09  
Iteration 7:   f(p) =  2.655e-09  
Iteration 8:   f(p) =  2.353e-09  
Iteration 9:   f(p) =  2.232e-09  
Iteration 10:  f(p) =  1.928e-09  
Iteration 11:  f(p) =  1.687e-09  
(switching technique to nr)
Iteration 12:  f(p) =  1.155e-09  
Iteration 13:  f(p) =  8.181e-12  
Iteration 14:  f(p) =  4.655e-16  
Iteration 15:  f(p) =  2.607e-24  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.339290927              0   -1.525175229              0   -.5996277399   -.3183658287    .0587883339   -.2435675677    .0341033606    .1585989692
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1617619473    .1391155704    .0571150775   -.1175051975    .0115050157    .7828580418  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .4673913    -1.38e-10    -2.76e-10     .5016695     1.008511  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0108696    -7.66e-11    -7.34e-10     .1042572     1.008511  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0217391    -8.17e-11    -5.57e-10     .1466296     1.008511  |
   7 |          x4     .4347826     .4347826    -4.03e-10    -8.08e-10     .4984448     1.008511  |
   8 |          x5     25.46739     25.46739    -1.76e-09    -3.24e-10     5.443922     .6195799  |
   9 |          x6     11.86957     11.86957    -1.98e-09    -1.23e-09     1.605057     .5669465  |
  10 |          x7     6.858696     6.858696    -1.77e-10    -4.99e-11     3.556704     1.145237  |
  11 |         x90     .0972024     .0972024     4.54e-11     4.76e-11     .9537854      .845302  |
  12 |         x91    -.0890157    -.0890157    -3.25e-11    -3.45e-11     .9429542     .9654928  |
  13 |         x92     .0453787     .0453787     4.05e-11     3.85e-11     1.051175     1.136731  |
  14 |         x93     .0865687     .0865687    -6.32e-11    -6.76e-11     .9349714     .9577067  |
  15 |         x94    -.1299173    -.1299173     5.29e-10     5.72e-10     .9248091     .7795321  |
  16 |         x95    -.0807251    -.0807251     8.07e-11     8.83e-11      .914005     .8888006  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  6.60027e-20
  Mean absolute standardized diff.
  3.71690e-10
  Maximum absolute standardized diff.
  1.23417e-09
  C.V. of matching weights:
  .9884371288
  S.D. of matching weights:
  .9884371288
  Skewness of matching weights:
  .1100078305
  Kurtosis of matching weights:
  .0225364399
  Maximum matching weight:
  7.032260601
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3424.753            3424.753           -7.80e-09            3424.753  |
  3 |          y1_binary            .9470393            .9470393           -1.14e-11            .9470393  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","cbps", 1, 0, (1,.75,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00061284  
Iteration 1:   f(p) =  2.180e-07  
Iteration 2:   f(p) =  1.269e-07  
Iteration 3:   f(p) =  1.206e-07  
Iteration 4:   f(p) =  1.176e-07  
Iteration 5:   f(p) =  1.170e-07  
Iteration 6:   f(p) =  1.170e-07  
Iteration 7:   f(p) =  1.161e-07  
Iteration 8:   f(p) =  8.900e-08  
Iteration 9:   f(p) =  8.301e-08  
Iteration 10:  f(p) =  8.238e-08  
Iteration 11:  f(p) =  8.232e-08  
(switching technique to nr)
Iteration 12:  f(p) =  8.209e-08  
Iteration 13:  f(p) =  7.516e-08  
Iteration 14:  f(p) =  6.789e-08  
Iteration 15:  f(p) =  4.227e-08  
Iteration 16:  f(p) =  2.563e-08  (not concave)
Iteration 17:  f(p) =  1.606e-08  
Iteration 18:  f(p) =  1.235e-08  
Iteration 19:  f(p) =  1.146e-08  
Iteration 20:  f(p) =  1.143e-08  
Iteration 21:  f(p) =  1.143e-08  
Iteration 22:  f(p) =  1.143e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.069921496              0   -1.301676371              0   -.4865721144   -.2463172338    .0447740862    -.199563491    .0257330976    .1236241663
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1270510686    .1015911223    .0470550868   -.0948947299    .0008498108    .4556057595  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5182506    -.0508593    -.1013801     .5016695     1.005561  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696      .012455    -.0015855    -.0152072     .1042572     .8815459  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0242826    -.0025435    -.0173465     .1466296     .9052271  |
   7 |          x4     .4347826     .4521396    -.0173569    -.0348222     .4984448      1.00052  |
   8 |          x5     25.46739     25.54157    -.0741744    -.0136252     5.443922     .6518318  |
   9 |          x6     11.86957     12.06656    -.1969954    -.1227342     1.605057     .5447873  |
  10 |          x7     6.858696     6.811629      .047067     .0132333     3.556704     1.145782  |
  11 |         x90     .0972024     .0715906     .0256118     .0268528     .9537854     .8605673  |
  12 |         x91    -.0890157    -.0737238    -.0152918    -.0162169     .9429542     .9393008  |
  13 |         x92     .0453787     .0269169     .0184618      .017563     1.051175     1.126957  |
  14 |         x93     .0865687      .076542     .0100267     .0107241     .9349714     .9352735  |
  15 |         x94    -.1299173    -.0967908    -.0331264    -.0358197     .9248091      .797834  |
  16 |         x95    -.0807251    -.0889147     .0081896     .0089601      .914005     .8763149  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0004633052
  Mean absolute standardized diff.
  .0334219595
  Maximum absolute standardized diff.
  .1227342493
  C.V. of matching weights:
  .7780723078
  S.D. of matching weights:
  .7780723078
  Skewness of matching weights:
  .0867263832
  Kurtosis of matching weights:
  .0156197301
  Maximum matching weight:
  4.997305895
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3425.501            3432.853           -7.352078            3432.853  |
  3 |          y1_binary             .947131            .9496087           -.0024777            .9496087  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","cbps", 1, 0, (1,.50,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .02519572  
Iteration 1:   f(p) =  .00037232  
Iteration 2:   f(p) =  .00018115  
Iteration 3:   f(p) =  .00007047  
Iteration 4:   f(p) =  .00006335  
Iteration 5:   f(p) =  .00005995  
Iteration 6:   f(p) =  .00003158  
Iteration 7:   f(p) =  .00001706  
Iteration 8:   f(p) =  .00001448  
Iteration 9:   f(p) =  .00001017  
Iteration 10:  f(p) =  9.753e-06  
Iteration 11:  f(p) =  9.539e-06  
(switching technique to nr)
Iteration 12:  f(p) =  9.503e-06  (not concave)
Iteration 13:  f(p) =  6.831e-06  (not concave)
Iteration 14:  f(p) =  5.276e-06  (not concave)
Iteration 15:  f(p) =  3.205e-06  (not concave)
Iteration 16:  f(p) =  1.200e-06  (not concave)
Iteration 17:  f(p) =  1.542e-07  (not concave)
Iteration 18:  f(p) =  1.120e-07  
Iteration 19:  f(p) =  9.309e-08  (not concave)
Iteration 20:  f(p) =  9.006e-08  (not concave)
Iteration 21:  f(p) =  8.342e-08  
Iteration 22:  f(p) =  7.002e-08  
Iteration 23:  f(p) =  5.958e-08  
(switching technique to bfgs)
Iteration 24:  f(p) =  5.389e-08  
Iteration 25:  f(p) =  5.205e-08  
Iteration 26:  f(p) =  5.135e-08  
Iteration 27:  f(p) =  5.121e-08  
Iteration 28:  f(p) =  5.115e-08  
Iteration 29:  f(p) =  5.114e-08  
Iteration 30:  f(p) =  5.114e-08  
Iteration 31:  f(p) =  5.114e-08  
Iteration 32:  f(p) =  5.114e-08  
Iteration 33:  f(p) =  5.114e-08  
Iteration 34:  f(p) =  5.114e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.7223993407              0   -.9764488983              0    -.366445527   -.1681781041     .029049571   -.1459138637    .0167632447    .0854724269
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0882866296    .0659923266    .0343074574   -.0658921818    -.006704452   -.0849072976  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5906793     -.123288    -.2457554     .5016695     1.038375  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0149904    -.0041208    -.0395256     .1042572      .734333  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0280471     -.006308    -.0430197     .1466296     .7867638  |
   7 |          x4     .4347826     .4668556     -.032073    -.0643461     .4984448     .9957285  |
   8 |          x5     25.46739     25.77285    -.3054553    -.0561094     5.443922     .6996672  |
   9 |          x6     11.86957     12.34748    -.4779169    -.2977571     1.605057     .5220235  |
  10 |          x7     6.858696     6.764905     .0937905     .0263701     3.556704       1.1484  |
  11 |         x90     .0972024     .0379772     .0592253      .062095     .9537854       .88436  |
  12 |         x91    -.0890157     -.056921    -.0320946    -.0340363     .9429542     .9113454  |
  13 |         x92     .0453787     .0111821     .0341965     .0325317     1.051175     1.115678  |
  14 |         x93     .0865687      .066104     .0204647      .021888     .9349714     .9136039  |
  15 |         x94    -.1299173    -.0574526    -.0724647    -.0783564     .9248091     .8189386  |
  16 |         x95    -.0807251    -.0931441      .012419     .0135875      .914005     .8623481  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0029196037
  Mean absolute standardized diff.
  .0781060169
  Maximum absolute standardized diff.
  .2977570504
  C.V. of matching weights:
  .5321351322
  S.D. of matching weights:
  .5321351322
  Skewness of matching weights:
  .0629289434
  Kurtosis of matching weights:
  .010802625
  Maximum matching weight:
  3.275096518
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3428.47            3442.759           -14.28939            3442.759  |
  3 |          y1_binary            .9474565            .9529482           -.0054917            .9529482  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   st_local("mlopts", "difficult nonrtolerance")

:   D.cbps("atet","mean_sd_sq", 1, 0, (1,.75,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00093921  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00042753  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00003686  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00002767  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00001518  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  6.684e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  3.117e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  1.306e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  3.889e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  1.977e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  7.501e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  5.838e-08  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  4.674e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  4.275e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  4.460e-10  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  3.813e-11  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  1.676e-11  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  3.286e-13  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  9.610e-14  (not concave)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.203523395              0   -1.648297853              0   -.6889611149   -.2537764489    .0119766096   -.0732705769   -.0164870289    .0761475505
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1312031306    .0695374022   -.0139101628   -.1188985362   -.0241542106    1.404817741  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913      .481706    -.0143146     -.028534     .5016695     1.005568  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0086891     .0021805     .0209144     .1042572     1.258816  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0172314     .0045077     .0307424     .1466296     1.266503  |
   7 |          x4     .4347826     .4922655    -.0574829    -.1153245     .4984448     .9915903  |
   8 |          x5     25.46739     24.77346     .6939284     .1274685     5.443922     .7384288  |
   9 |          x6     11.86957     12.34392    -.4743546    -.2955376     1.605057     .5297315  |
  10 |          x7     6.858696     6.372816     .4858801     .1366096     3.556704     1.131086  |
  11 |         x90     .0972024     .0708831     .0263193     .0275946     .9537854     .8433151  |
  12 |         x91    -.0890157    -.0850236    -.0039921    -.0042336     .9429542     .9406624  |
  13 |         x92     .0453787     .0288604     .0165183     .0157141     1.051175     1.109397  |
  14 |         x93     .0865687     .0246953     .0618733     .0661767     .9349714     .9231214  |
  15 |         x94    -.1299173    -.1327696     .0028523     .0030843     .9248091     .8317584  |
  16 |         x95    -.0807251    -.0947339     .0140089     .0153269      .914005     .8706165  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.69728e-14
  Mean absolute standardized diff.
  .068250865
  Maximum absolute standardized diff.
  .2955376495
  C.V. of matching weights:
  .7565522146
  S.D. of matching weights:
  .7565522146
  Skewness of matching weights:
  .0830111672
  Kurtosis of matching weights:
  .0131708314
  Maximum matching weight:
  4.326992178
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3429.127            3447.013           -17.88593            3447.013  |
  3 |          y1_binary            .9470472            .9575087           -.0104616            .9575087  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   D.cbps("atet","mean_sd_sq", 1, 0, (1,.50,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =   .0255221  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00707055  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00121893  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00077435  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00038439  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00027065  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00020657  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00014905  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00004814  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00002729  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00002254  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00001783  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00001699  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  4.708e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  2.990e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  1.435e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  1.177e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  7.334e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  6.259e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  5.611e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  4.353e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  4.347e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  4.094e-07  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  1.637e-07  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  1.536e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  1.465e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  1.080e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  1.045e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  1.045e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  1.040e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  9.998e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  9.894e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  9.891e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  9.891e-08  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.8576315917              0   -2.278638484              0   -.4867771273   -.1207334981    .0125525175   -.0391369342   -.0253959559   -.0985808525
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1684551732    -.108393946    -.106611846   -.0849796779   -.1678559178    3.357107197  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .5896186    -.1222273     -.243641     .5016695     1.037554  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0041996       .00667     .0639761     .1042572     2.592787  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0197748     .0019643     .0133964     .1466296     1.106468  |
   7 |          x4     .4347826     .5050962    -.0703136    -.1410659     .4984448     .9914561  |
   8 |          x5     25.46739     25.59679    -.1293958    -.0237689     5.443922     .7501985  |
   9 |          x6     11.86957     12.63182    -.7622568    -.4749096     1.605057     .5006192  |
  10 |          x7     6.858696     6.396986     .4617095     .1298139     3.556704     1.127903  |
  11 |         x90     .0972024    -.1098519     .2070543     .2170869     .9537854     .8883868  |
  12 |         x91    -.0890157    -.1310079     .0419922     .0445326     .9429542     .9453563  |
  13 |         x92     .0453787    -.1269518     .1723304     .1639407     1.051175     1.100395  |
  14 |         x93     .0865687    -.0629131     .1494818     .1598785     .9349714     .8438625  |
  15 |         x94    -.1299173    -.0863392    -.0435781    -.0471212     .9248091     .8305237  |
  16 |         x95    -.0807251    -.2065973     .1258722      .137715      .914005     .8638318  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.64319e-10
  Mean absolute standardized diff.
  .143142044
  Maximum absolute standardized diff.
  .4749096411
  C.V. of matching weights:
  .56798552
  S.D. of matching weights:
  .56798552
  Skewness of matching weights:
  .0730789382
  Kurtosis of matching weights:
  .0138593555
  Maximum matching weight:
  3.431757019
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3437.544            3472.215           -34.67168            3472.215  |
  3 |          y1_binary            .9474737             .960127           -.0126533             .960127  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // furthermore, you can target skiwness, kurtosis, or max weight
:   D.cbps("atet","cbps", 1, 0, (1,.50,6,1,0.7,2))
  Step 1 (initial values from logit model):
initial:       f(p) = -346.57359
alternative:   f(p) = -283.03849
rescale:       f(p) = -247.46401
Iteration 0:   f(p) = -247.46401  
Iteration 1:   f(p) = -223.85141  
Iteration 2:   f(p) = -211.21673  
Iteration 3:   f(p) = -211.17754  
Iteration 4:   f(p) = -211.17753  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
nearby values are missing
(setting technique to bfgs)
Iteration 0:   f(p) =  .34614522  
Iteration 1:   f(p) =  .25779353  (backed up)
Iteration 2:   f(p) =  .25219839  (backed up)
Iteration 3:   f(p) =  .22043634  
Iteration 4:   f(p) =  .20253402  
Iteration 5:   f(p) =  .15892901  
Iteration 6:   f(p) =  .10461031  
Iteration 7:   f(p) =  .06759525  
Iteration 8:   f(p) =  .05045631  
Iteration 9:   f(p) =  .04848886  
Iteration 10:  f(p) =  .04786872  
Iteration 11:  f(p) =  .04733625  
(switching technique to nr)
Iteration 12:  f(p) =  .04690709  (not concave)
Iteration 13:  f(p) =  .03961078  
Iteration 14:  f(p) =  .03899762  
Iteration 15:  f(p) =  .03891774  
Iteration 16:  f(p) =  .03891651  
numerical derivatives are approximate
nearby values are missing
Iteration 17:  f(p) =  .03891644  (not concave)
Iteration 18:  f(p) =  .03891644  
Iteration 19:  f(p) =  .03891644  
Iteration 20:  f(p) =  .03891644  
Iteration 21:  f(p) =  .03891644  (backed up)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   .0400900489              0   -.0449744823              0   -.0644035838    .1717826093    .0644460112   -.2137991556   -.0240812197     .093157585
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1081187806    .1821330783    .1321345449     -.30577559    .0663444818   -.9583200169  |
     -------------------------------------------------------------------------------------------+

:   D.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4673913     .7622098    -.2948185    -.5876748     .5016695     1.385164  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0108696     .0263519    -.0154823    -.1485015     .1042572     .4226027  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0217391     .0420962     -.020357     -.138833     .1466296     .5318794  |
   7 |          x4     .4347826     .4437025    -.0089199    -.0178955     .4984448     1.004082  |
   8 |          x5     25.46739     27.91242    -2.445032    -.4491306     5.443922     .6653275  |
   9 |          x6     11.86957     12.43492     -.565356    -.3522343     1.605057     .4631149  |
  10 |          x7     6.858696     6.306199     .5524967     .1553395     3.556704     1.158364  |
  11 |         x90     .0972024    -.0158259     .1130283      .118505     .9537854     .9540569  |
  12 |         x91    -.0890157    -.1059285     .0169128      .017936     .9429542     .9192153  |
  13 |         x92     .0453787     .1467608    -.1013821    -.0964464     1.051175     1.135239  |
  14 |         x93     .0865687     .1792813    -.0927126    -.0991609     .9349714     .9529712  |
  15 |         x94    -.1299173    -.3260981     .1961809     .2121312     .9248091     .7297787  |
  16 |         x95    -.0807251    -.0955472     .0148221     .0162166      .914005     .8693439  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0111018424
  Mean absolute standardized diff.
  .1853850278
  Maximum absolute standardized diff.
  .5876748313
  C.V. of matching weights:
  .9715245687
  S.D. of matching weights:
  .9715245687
  Skewness of matching weights:
  .5328905716
  Kurtosis of matching weights:
  .412374184
  Maximum matching weight:
  16.67392699
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3432.78            3436.596           -3.816443            3436.596  |
  3 |          y1_binary            .9492824            .9562957           -.0070133            .9562957  |
    +-----------------------------------------------------------------------------------------------------+

:   st_local("mlopts", "")

: 
: mata drop D

: 
: 
: // * WEIGHTED DATA EXAMPLES *
: 
: DW = gmatch()

: DW.set(treatvar, varlist, tousevar, wgtvar)
  408 control obs (sum of weights = 802.3793)
  92 treatment obs (sum of weights = 180.1725)

: if (depvars!="") DW.set_Y(depvars,tousevar)
> 
> // Misc balance measures
>   DW.diff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.295813959              0   -.0156488223              0   -.0187317786   -.0757286195   -1.051311077   -1.308590669     .297707166    .1231935602
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1    -.0575694681    .0828891447    .0552344857   -.1298217376   -.0348745599  |
     ----------------------------------------------------------------------------+

:   DW.stddiff()
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.5928113513              .   -.1469730323              .   -.1218929028   -.1529139652   -.1938926866   -.7969828512    .0837330563    .1283646934
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1    -.0613348134    .0800443396    .0583642775   -.1419196244   -.0384510908  |
     ----------------------------------------------------------------------------+

:   DW.mean_asd()
  .1998214373

:   DW.stddiff(1)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.5928113513              .   -.1469730323              .   -.1218929028   -.1529139652   -.1938926866   -.7969828512    .0837330563    .1283646934
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1    -.0613348134    .0800443396    .0583642775   -.1419196244   -.0384510908  |
     ----------------------------------------------------------------------------+

:   DW.stddiff(0)
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -.680061781              .   -.0963964449              .   -.0924925724    -.151364552   -.1796741931    -.574992733     .089787867    .1235603267
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15
     ----------------------------------------------------------------------------+
  1    -.0581251544    .0827450762    .0561740214   -.1310646825   -.0346950651  |
     ----------------------------------------------------------------------------+

:   DW.varratio()
                 1             2             3             4             5             6             7             8             9            10
    +---------------------------------------------------------------------------------------------------------------------------------------------
  1 |  1.316023713             .   .4301765439             .   .5757804001   .9798375062   .8587140122   .5205072206   1.149850614   .9265458616
    +---------------------------------------------------------------------------------------------------------------------------------------------
                11            12            13            14            15
     -----------------------------------------------------------------------+
  1    .8980781756   1.068619436   .9263536214    .852877099   .8141756036  |
     -----------------------------------------------------------------------+

:   DW.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3448.29            3459.434           -11.14415            3459.434  |
  3 |          y1_binary              .95075            .9627243           -.0119743            .9627243  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |  -11.14415063    -.011974287  |
    +-------------------------------+

: 
:   "Balance table before matching"
  Balance table before matching

:   temp = DW.balancetable(1)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .7470371     -.295814    -.5928114     .4990018     1.316024  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0270527    -.0156488     -.146973     .1064741     .4301765  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0427955    -.0187318    -.1218929     .1536741     .5757804  |
   7 |          x4     .4218861     .4976147    -.0757286     -.152914     .4952368     .9798375  |
   8 |          x5     25.44699      26.4983    -1.051311    -.1938927     5.422129      .858714  |
   9 |          x6     11.84757     13.15616    -1.308591    -.7969829     1.641931     .5205072  |
  10 |          x7     7.015422     6.717714     .2977072     .0837331     3.555432     1.149851  |
  11 |         x90     .0839738    -.0392197     .1231936     .1283647     .9597153     .9265459  |
  12 |         x91    -.0648837    -.0073142    -.0575695    -.0613348       .93861     .8980782  |
  13 |         x92     .0575388    -.0253504     .0828891     .0800443      1.03554     1.068619  |
  14 |         x93     .1016523     .0464178     .0552345     .0583643     .9463749     .9263536  |
  15 |         x94    -.1252265     .0045953    -.1298217    -.1419196     .9147554     .8528771  |
  16 |         x95    -.1044649    -.0695904    -.0348746    -.0384511     .9069849     .8141756  |
     +--------------------------------------------------------------------------------------------+

: 
: // Replicate CBPS
: 
:   "--- ATE (not overidentified) ---"; ""; ""
  --- ATE (not overidentified) ---
  
  

:     DW.cbps("ate", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -435.82179  
Iteration 2:   f(p) = -411.28725  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00008909  
Iteration 1:   f(p) =  .00006006  
Iteration 2:   f(p) =  .00005798  
Iteration 3:   f(p) =  .00005798  
Iteration 4:   f(p) =  .00005797  
Iteration 5:   f(p) =  .00005722  
Iteration 6:   f(p) =  .00004799  
Iteration 7:   f(p) =  .00002164  
Iteration 8:   f(p) =  .00001682  
Iteration 9:   f(p) =  .00001603  
Iteration 10:  f(p) =  .00001599  
Iteration 11:  f(p) =  .00001599  
(switching technique to nr)
Iteration 12:  f(p) =  .00001598  (not concave)
Iteration 13:  f(p) =  9.601e-06  (not concave)
Iteration 14:  f(p) =  3.449e-06  
Iteration 15:  f(p) =  5.937e-07  
Iteration 16:  f(p) =  1.904e-07  
Iteration 17:  f(p) =  1.468e-07  (not concave)
Iteration 18:  f(p) =  1.206e-07  (not concave)
Iteration 19:  f(p) =  8.898e-08  (not concave)
Iteration 20:  f(p) =  2.012e-08  (not concave)
Iteration 21:  f(p) =  4.956e-09  
Iteration 22:  f(p) =  8.632e-11  
Iteration 23:  f(p) =  7.250e-14  
(switching technique to bfgs)
Iteration 24:  f(p) =  1.987e-23  
Iteration 25:  f(p) =  1.596e-26  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.502416044              0   -2.525398915              0   -.8191009475   -.3236397063    .0771198244   -.4884764405    .0722685739    .0234164978
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1     .0257848717    .2152141202   -.0285372179   -.3393876759   -.0407880729    3.075436854  |
     -------------------------------------------------------------------------------------------+

:     DW.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6695182      .6695182     -5.48e-13     -1.17e-12      .4706262      1.004328  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0220668      .0220668     -4.95e-14     -3.37e-13      .1469756      1.004328  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0366911      .0366911     -9.94e-14     -5.28e-13       .188098      1.004328  |
   7 |           x4       .485133       .485133      1.24e-13      2.48e-13      .5000334      1.004328  |
   8 |           x5      26.17889      26.17889      5.68e-13      9.11e-14      6.237853      .6789026  |
   9 |           x6      12.63449      12.63449     -4.48e-12     -1.92e-12      2.338005      .5740656  |
  10 |           x7      6.755243      6.755243      1.85e-12      5.48e-13      3.370937      1.187219  |
  11 |          x90     -.0520316     -.0520316     -2.67e-13     -2.55e-13      1.046128      1.163666  |
  12 |          x91      .0164856      .0164856      4.43e-15      4.56e-15      .9705717      .9930954  |
  13 |          x92     -.0021645     -.0021645      2.22e-13      2.18e-13      1.017927      1.359802  |
  14 |          x93      .0456916      .0456916     -3.93e-13     -4.08e-13      .9636159       .883731  |
  15 |          x94     -.0910006     -.0910006     -9.72e-13     -9.59e-13      1.014116      .7859289  |
  16 |          x95     -.0894588     -.0894588      2.22e-13      2.27e-13       .978942      .8236876  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.05915e-25
  Mean absolute standardized diff.
  5.31055e-13
  Maximum absolute standardized diff.
  1.91539e-12
  C.V. of matching weights:
  .5270998694
  S.D. of matching weights:
  .5284997369
  Skewness of matching weights:
  .2026515012
  Kurtosis of matching weights:
  .0762370775
  Maximum matching weight:
  6.642263865
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3445.465            3445.465           -9.96e-11            3445.465  |
  3 |          y1_binary            .9569441            .9569441           -6.92e-14            .9569441  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATE overidentified ---"; ""; ""
  --- ATE overidentified ---
  
  

:     DW.cbps("ate", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -435.82179  
Iteration 2:   f(p) = -411.28725  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .02296546  
Iteration 1:   f(p) =  .01893921  
Iteration 2:   f(p) =  .01888779  
Iteration 3:   f(p) =  .01864993  
Iteration 4:   f(p) =  .01807794  
Iteration 5:   f(p) =  .01796175  
Iteration 6:   f(p) =  .01796123  
Iteration 7:   f(p) =   .0179521  
Iteration 8:   f(p) =  .01782591  
Iteration 9:   f(p) =  .01781762  
Iteration 10:  f(p) =  .01781752  
Iteration 11:  f(p) =  .01781614  
(switching technique to nr)
Iteration 12:  f(p) =  .01780413  
Iteration 13:  f(p) =  .01777185  
Iteration 14:  f(p) =  .01777184  
Iteration 15:  f(p) =  .01777184  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.226645058              0    -1.65376219              0   -.7776876328   -.3532490647    .0574628555   -.2583005126    .0080438629    .0890275829
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1706880895    .1765097112    .1136718369   -.1271347153    .0214703613    1.180155469  |
     -------------------------------------------------------------------------------------------+

:     DW.balanceresults("ate",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .6415953      .6970127     -.0554173     -.1194311      .4640107      1.093567  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0142909      .0234703     -.0091794     -.0628462      .1460619      .6172753  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0334441      .0380925     -.0046484     -.0245369      .1894462      .8860314  |
   7 |           x4      .4881571      .4821182      .0060389      .0120785       .499973       1.00505  |
   8 |           x5      25.72258      26.31855     -.5959644     -.1000426      5.957105      .7659019  |
   9 |           x6      12.33189       12.8994     -.5675068     -.2533225      2.240254      .6135511  |
  10 |           x7      6.911084      6.688832       .222252      .0657612      3.379685      1.211887  |
  11 |          x90     -.0440388     -.0251309      -.018908     -.0185767       1.01783      1.120774  |
  12 |          x91      .0661735     -.0257224      .0918959      .0936219      .9815644      .9753854  |
  13 |          x92     -.0382008     -.0020298     -.0361709     -.0355957      1.016161       1.20721  |
  14 |          x93      .0014101      .0645199     -.0631098     -.0653399      .9658703      .9125525  |
  15 |          x94     -.1442668     -.0285682     -.1156986     -.1166712      .9916637      .8216037  |
  16 |          x95     -.1053626       -.07164     -.0337226     -.0344811      .9780038       .803947  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0025726925
  Mean absolute standardized diff.
  .0771004085
  Maximum absolute standardized diff.
  .2533225092
  C.V. of matching weights:
  .3236892353
  S.D. of matching weights:
  .3244154086
  Skewness of matching weights:
  .1499732962
  Kurtosis of matching weights:
  .0569705847
  Maximum matching weight:
  4.343313229
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3443.873            3455.428           -11.55448            3455.428  |
  3 |          y1_binary            .9538356            .9614582           -.0076226            .9614582  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET (not overidentified) ---"; ""; ""
  --- ATET (not overidentified) ---
  
  

:     DW.cbps("atet", "cbps", 2, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -435.82179  
Iteration 2:   f(p) = -411.28725  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00001735  
Iteration 1:   f(p) =  6.450e-06  
Iteration 2:   f(p) =  5.892e-06  
Iteration 3:   f(p) =  5.889e-06  
Iteration 4:   f(p) =  5.889e-06  
Iteration 5:   f(p) =  5.884e-06  
Iteration 6:   f(p) =  5.782e-06  
Iteration 7:   f(p) =  1.672e-06  
Iteration 8:   f(p) =  1.353e-06  
Iteration 9:   f(p) =  1.347e-06  
Iteration 10:  f(p) =  1.347e-06  
Iteration 11:  f(p) =  1.345e-06  
(switching technique to nr)
Iteration 12:  f(p) =  7.515e-07  
Iteration 13:  f(p) =  6.172e-07  
Iteration 14:  f(p) =  2.892e-07  
Iteration 15:  f(p) =  5.356e-08  
Iteration 16:  f(p) =  8.139e-10  
Iteration 17:  f(p) =  8.812e-13  
Iteration 18:  f(p) =  1.377e-20  
Iteration 19:  f(p) =  1.051e-26  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -1.44704714              0   -1.546890931              0    -.471062263   -.3822539288    .0635823768   -.2432270283    .0477026872    .1334992086
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1336116528    .1522937137    .0757732417   -.1016170888   -.0383391404    .6265763157  |
     -------------------------------------------------------------------------------------------+

:     DW.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4512231      .4512231     -9.76e-13     -1.96e-12      .4978686      1.004328  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0114039      .0114039      2.24e-13      2.11e-12      .1062323      1.004328  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0240637      .0240637      1.66e-14      1.08e-13      .1533251      1.004328  |
   7 |           x4      .4218861      .4218861     -6.23e-13     -1.26e-12       .494112      1.004328  |
   8 |           x5      25.44699      25.44699     -3.22e-12     -4.83e-13      6.665558      .6144662  |
   9 |           x6      11.84757      11.84757     -5.03e-12     -2.46e-12      2.042375      .5982513  |
  10 |           x7      7.015422      7.015422     -6.31e-13     -1.89e-13      3.345323      1.161761  |
  11 |          x90      .0839738      .0839738      3.95e-13      3.85e-13        1.0258      .8505325  |
  12 |          x91     -.0648837     -.0648837     -2.28e-13     -2.42e-13       .941106      .9922891  |
  13 |          x92      .0575388      .0575388      1.13e-12      1.14e-12      .9892732      1.118263  |
  14 |          x93      .1016523      .1016523     -5.35e-13     -5.68e-13      .9410813      1.012572  |
  15 |          x94     -.1252265     -.1252265     -5.33e-14     -5.20e-14      1.026859      .7576623  |
  16 |          x95     -.1044649     -.1044649     -7.43e-13     -7.72e-13      .9627688      .8646431  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.06888e-25
  Mean absolute standardized diff.
  9.02547e-13
  Maximum absolute standardized diff.
  2.46487e-12
  C.V. of matching weights:
  1.031924564
  S.D. of matching weights:
  1.02710789
  Skewness of matching weights:
  .1135011509
  Kurtosis of matching weights:
  .0229206639
  Maximum matching weight:
  7.007741998
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.367           -1.57e-10            3431.367  |
  3 |          y1_binary            .9509094            .9509094           -4.86e-14            .9509094  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   "--- ATET overidentified ---"; ""; ""
  --- ATET overidentified ---
  
  

:     DW.cbps("atet", "cbps", 2, 1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -435.82179  
Iteration 2:   f(p) = -411.28725  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00053487  
Iteration 1:   f(p) =  .00021848  
Iteration 2:   f(p) =  .00021162  
Iteration 3:   f(p) =  .00021159  
Iteration 4:   f(p) =  .00021001  
Iteration 5:   f(p) =  .00019724  
Iteration 6:   f(p) =   .0001771  
Iteration 7:   f(p) =  .00017502  
Iteration 8:   f(p) =  .00017501  
Iteration 9:   f(p) =  .00017499  
Iteration 10:  f(p) =  .00017464  
Iteration 11:  f(p) =   .0001725  
(switching technique to nr)
Iteration 12:  f(p) =  .00017245  
Iteration 13:  f(p) =  .00017215  
Iteration 14:  f(p) =  .00017215  
Iteration 15:  f(p) =  .00017215  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.393749216              0   -1.561041129              0    -.460004096   -.3846168055    .0606091575   -.2482012462    .0443349316    .1306487561
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1205474411    .1453091539    .0704759932   -.1075637918    -.030791552    .7598453036  |
     -------------------------------------------------------------------------------------------+

:     DW.balanceresults("atet",2)
  Balance table:
                  1             2             3             4             5             6             7
     +---------------------------------------------------------------------------------------------------+
   1 |     Variable      mean (T)      mean (C)        diff()     stddiff()   sd (Pooled)    varratio()  |
   2 |           x1      .4512231      .4553292      -.004106      -.008242       .498186      1.002774  |
   3 |        0b.x2             0             0             0             .             0             .  |
   4 |         1.x2      .0114039      .0111962      .0002076      .0019689      .1054487      1.022737  |
   5 |        0b.x3             0             0             0             .             0             .  |
   6 |         1.x3      .0240637      .0242798     -.0002161     -.0014043      .1538723      .9956099  |
   7 |           x4      .4218861      .4235251      -.001639     -.0033156       .494322      1.003286  |
   8 |           x5      25.44699      25.39436      .0526224      .0078927      6.667188      .6141311  |
   9 |           x6      11.84757      11.82507      .0224988      .0110125      2.043017      .5978372  |
  10 |           x7      7.015422      6.978162        .03726       .011128      3.348319      1.159171  |
  11 |          x90      .0839738      .0816058       .002368      .0023047      1.027479      .8472278  |
  12 |          x91     -.0648837     -.0554765     -.0094072     -.0099831      .9423132      .9892043  |
  13 |          x92      .0575388      .0526517      .0048871      .0049455      .9881782      1.121369  |
  14 |          x93      .1016523        .09771      .0039424      .0041911      .9406607      1.013686  |
  15 |          x94     -.1252265      -.131327      .0061006      .0059387       1.02725      .7569926  |
  16 |          x95     -.1044649     -.1015494     -.0029155     -.0030291      .9625009      .8652191  |
     +---------------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  3.24223e-06
  Mean absolute standardized diff.
  .0057966356
  Maximum absolute standardized diff.
  .0111279635
  C.V. of matching weights:
  1.019033715
  S.D. of matching weights:
  1.014129106
  Skewness of matching weights:
  .1128933006
  Kurtosis of matching weights:
  .0230686436
  Maximum matching weight:
  7.10958804
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.338            3430.734            .6042787            3430.734  |
  3 |          y1_binary            .9509085            .9508973            .0000112            .9508973  |
    +-----------------------------------------------------------------------------------------------------+

: 
: // Other objective functions
:   st_local("mlopts", "difficult nonrtolerance")

:   DW.cbps("atet","mean_sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00026309  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00001126  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  4.733e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  1.762e-13  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  1.968e-21  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.298300659              0   -1.629910465              0   -.4511737896   -.3553036347    .0715800496    -.277332404    .0371348754    .1283825511
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0952384668    .1409151853    .0743038835   -.1419191916     -.02015005     1.24895601  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231      .487981    -.0367579    -.0736628     .4990018     .9953452  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0101189     .0012849     .0120681     .1064741     1.130392  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0243904    -.0003267     -.002126     .1536741      .991207  |
   7 |          x4     .4218861     .4077073     .0141788     .0286304     .4952368     1.014377  |
   8 |          x5     25.44699     25.93854    -.4915548    -.0906572     5.422129     .5820455  |
   9 |          x6     11.84757     11.77832     .0692519     .0421771     1.641931     .5870658  |
  10 |          x7     7.015422     6.877177     .1382443     .0388826     3.555432     1.150412  |
  11 |         x90     .0839738     .0558962     .0280776     .0292562     .9597153     .8505932  |
  12 |         x91    -.0648837    -.0314162    -.0334675    -.0356565       .93861     .9896463  |
  13 |         x92     .0575388     .0508005     .0067383      .006507      1.03554     1.132825  |
  14 |         x93     .1016523     .1109109    -.0092586    -.0097833     .9463749     1.021042  |
  15 |         x94    -.1252265    -.1752569     .0500305     .0546928     .9147554     .7291541  |
  16 |         x95    -.1044649     -.104167    -.0002979    -.0003285     .9069849     .8690485  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.96769e-21
  Mean absolute standardized diff.
  .03264833
  Maximum absolute standardized diff.
  .0906571707
  C.V. of matching weights:
  1.067016841
  S.D. of matching weights:
  1.064358817
  Skewness of matching weights:
  .1583892396
  Kurtosis of matching weights:
  .0509012076
  Maximum matching weight:
  10.57744042
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.445            3432.164           -.7196186            3432.164  |
  3 |          y1_binary            .9507734            .9518109           -.0010374            .9518109  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","sd_sq",1)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .01944489  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .01784035  (backed up)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01032757  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00864463  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00309574  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00232235  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00091852  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00071553  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00032888  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00013226  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00006152  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00004718  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00002689  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  .00002341  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  .00002148  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  .00001985  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  .00001702  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  .00001157  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  9.655e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  9.538e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  8.649e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  8.585e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  7.605e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  7.400e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  7.393e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  7.332e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  6.805e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  6.140e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  6.071e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  6.062e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  6.062e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  6.062e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  6.062e-06  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.445995818              0   -1.569794287              0   -.4604848221   -.3850050912    .0632865531   -.2429001458    .0477264741    .1331649803
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1334475104    .1518035626    .0756112217   -.1015596015   -.0394675779    1.417186603  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231      .451336    -.0001128    -.0002261     .4990018     1.004283  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0112022     .0002017     .0018944     .1064741     1.022203  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0241994    -.0001357     -.000883     .1536741      .998835  |
   7 |          x4     .4218861     .4216376     .0002485     .0005018     .4952368     1.004488  |
   8 |          x5     25.44699     25.44256     .0044289     .0008168     5.422129     .6149052  |
   9 |          x6     11.84757     11.84794    -.0003675    -.0002238     1.641931     .5983104  |
  10 |          x7     7.015422     7.015606    -.0001846    -.0000519     3.555432     1.161648  |
  11 |         x90     .0839738     .0839428     .0000311     .0000324     .9597153     .8504276  |
  12 |         x91    -.0648837    -.0650271     .0001434     .0001528       .93861     .9920778  |
  13 |         x92     .0575388     .0573697     .0001691     .0001633      1.03554     1.118402  |
  14 |         x93     .1016523      .101601     .0000513     .0000542     .9463749     1.012402  |
  15 |         x94    -.1252265    -.1251953    -.0000311     -.000034     .9147554     .7578147  |
  16 |         x95    -.1044649    -.1051763     .0007113     .0007843     .9069849     .8643833  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  5.25811e-08
  Mean absolute standardized diff.
  .0004476028
  Maximum absolute standardized diff.
  .0018943829
  C.V. of matching weights:
  1.031485561
  S.D. of matching weights:
  1.026645451
  Skewness of matching weights:
  .1133246431
  Kurtosis of matching weights:
  .0228367572
  Maximum matching weight:
  6.978606991
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.414            -.046495            3431.414  |
  3 |          y1_binary            .9509096            .9509168           -7.26e-06            .9509168  |
    +-----------------------------------------------------------------------------------------------------+

:   st_local("mlopts", "")

: 
:   DW.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.414            -.046495            3431.414  |
  3 |          y1_binary            .9509096            .9509168           -7.26e-06            .9509168  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |  -.0464950147   -7.26095e-06  |
    +-------------------------------+

:   DW.reweight()

:   DW.prognosticdiff()
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1             3448.29            3459.434           -11.14415            3459.434  |
  3 |          y1_binary              .95075            .9627243           -.0119743            .9627243  |
    +-----------------------------------------------------------------------------------------------------+
                  1              2
    +-------------------------------+
  1 |  -11.14415063    -.011974287  |
    +-------------------------------+

: 
: // IPW
: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], atet aequations")

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  1.444e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Treated vs Untreated)  |  -373.2561   49.21885    -7.58   0.000    -469.7233   -276.7889
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3424.879   30.82585   111.10   0.000     3364.462    3485.297
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.299227   .2371935    -5.48   0.000    -1.764118   -.8343367
                        |
                     x2 |
                     1  |  -1.630014    .746001    -2.19   0.029    -3.092149   -.1678787
                        |
                     x3 |
                     1  |  -.4513753   .5770312    -0.78   0.434    -1.582336    .6795851
                     x4 |  -.3551911    .204881    -1.73   0.083    -.7567506    .0463684
                     x5 |    .058452   .0195046     3.00   0.003     .0202237    .0966803
                     x6 |  -.2821622    .049775    -5.67   0.000    -.3797195    -.184605
                     x7 |   .0332008   .0279849     1.19   0.235    -.0216486    .0880501
                    x90 |   .1276778   .0907109     1.41   0.159    -.0501124     .305468
                    x91 |  -.0961159   .0916737    -1.05   0.294     -.275793    .0835612
                    x92 |   .1400043   .0976573     1.43   0.152    -.0514004    .3314091
                    x93 |   .0734557   .0916967     0.80   0.423    -.1062665     .253178
                    x94 |  -.1435742   .0862727    -1.66   0.096    -.3126656    .0255172
                    x95 |  -.0212452   .0898768    -0.24   0.813    -.1974006    .1549102
                  _cons |    1.24872   .6712769     1.86   0.063    -.0669587    2.564399
-----------------------------------------------------------------------------------------

:   stata("di _b[POmean:0.treat]")
3424.8791

:   stata("tebalance summarize")

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        249.5
                          Control obs   =          408        250.5
                          -----------------------------------------

  -----------------------------------------------------------------
                  |Standardized differences          Variance ratio
                  |        Raw    Weighted           Raw   Weighted
  ----------------+------------------------------------------------
               x1 |  -.6027752    .0041102      1.338962   1.000571
                  |
               x2 |
               1  |  -.1180374    .0011686      .4133173   1.011157
                  |
               x3 |
               1  |  -.1253201   -.0169419      .5085817   .8975379
                  |
               x4 |  -.1207472    .0136004      .9914484   1.003798
               x5 |  -.1944638     .003179      .8589874   .5855492
               x6 |  -.6542694    .0947099      .4958356   .5643304
               x7 |   .0473848    .0177567      1.160037   1.134687
              x90 |   .1499304    .0348222      .9289414    .817157
              x91 |  -.0833726   -.0675073      .8791918     .96061
              x92 |   .0662245   -.0005441      1.090179   1.148892
              x93 |   .0479737    -.020065      .8926169   .9606022
              x94 |  -.1521926    .0315996      .8686432   .7548902
              x95 |  -.0155155    .0398234      .8285405   .8815991
  -----------------------------------------------------------------

:   stata("tebalance summarize, baseline")  // I noticed the sum of weights in tebalance are weird

  Covariate balance summary
                                                   Raw     Weighted
                          -----------------------------------------
                          Number of obs =          500        500.0
                          Treated obs   =           92        249.5
                          Control obs   =          408        250.5
                          -----------------------------------------

  -----------------------------------------------------------------
                  |           Means                  Variances     
                  |    Control     Treated       Control    Treated
  ----------------+------------------------------------------------
               x1 |        .75    .4673913      .1879607   .2516722
                  |
               x2 |
               1  |   .0269608    .0108696      .0262984   .0108696
                  |
               x3 |
               1  |   .0441176    .0217391      .0422749   .0215002
                  |
               x4 |    .495098    .4347826      .2505902   .2484472
               x5 |   26.56863    25.46739      34.50142   29.63629
               x6 |   13.15931    11.86957      5.195687   2.576206
               x7 |   6.696078    6.858696      10.90495   12.65014
              x90 |   -.048508    .0972024      .9792937   .9097065
              x91 |  -.0077434   -.0890157      1.011341   .8891627
              x92 |  -.0227801    .0453787      1.013567    1.10497
              x93 |   .0403853    .0865687      .9793358   .8741716
              x94 |   .0160559   -.1299173      .9846065   .8552718
              x95 |  -.0658282   -.0807251      1.008285   .8354051
  -----------------------------------------------------------------

: 
:   DW.ipw("atet")
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462              0   -1.630013723              0    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0961158854    .1400043185    .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------------------------------------+

:   table = DW.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4512231     .4574808    -.0062577    -.0125467     .4987508     1.002016  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0104612     .0009427     .0090496     .1041667     1.093786  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0241722    -.0001085    -.0007058     .1536767     .9999323  |
   7 |          x4     .4218861     .4314162    -.0095301    -.0192367     .4954098     .9986039  |
   8 |          x5     25.44699     25.25275     .1942356     .0309352     6.278789     .5945665  |
   9 |          x6     11.84757     11.67955     .1680205     .0885487     1.897493     .5984287  |
  10 |          x7     7.015422     6.824197     .1912245     .0556435       3.4366     1.151353  |
  11 |         x90     .0839738     .0777469     .0062269     .0061803     1.007542     .8303562  |
  12 |         x91    -.0648837     -.033852    -.0310317    -.0329813      .940886      .990382  |
  13 |         x92     .0575388     .0480591     .0094797     .0094309     1.005171     1.130693  |
  14 |         x93     .1016523     .1032412    -.0015889    -.0016918     .9391571     1.031343  |
  15 |         x94    -.1252265    -.1745685     .0493421     .0498225     .9903584     .7439065  |
  16 |         x95    -.1044649    -.1114622     .0069973     .0074459     .9397461     .8717687  |
     +--------------------------------------------------------------------------------------------+

:   DW.pomean()
                 1             2
    +-----------------------------+
  1 |  3424.879077   .9506406354  |
    +-----------------------------+

:   DW.reweight()

:   table = DW.balancetable(3)
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()     sd (Avg)   varratio()  |
   2 |          x1     .4512231     .7470371     -.295814    -.6319633     .4680872     1.316024  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0270527    -.0156488    -.1139938     .1372778     .4301765  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0427955    -.0187318    -.1042015     .1797649     .5757804  |
   7 |          x4     .4218861     .4976147    -.0757286    -.1521333     .4977779     .9798375  |
   8 |          x5     25.44699      26.4983    -1.051311    -.1863779      5.64075      .858714  |
   9 |          x6     11.84757     13.15616    -1.308591    -.6594519     1.984361     .5205072  |
  10 |          x7     7.015422     6.717714     .2977072     .0866021     3.437643     1.149851  |
  11 |         x90     .0839738    -.0392197     .1231936     .1258938     .9785514     .9265459  |
  12 |         x91    -.0648837    -.0073142    -.0575695    -.0596653      .964873     .8980782  |
  13 |         x92     .0575388    -.0253504     .0828891     .0813611     1.018781     1.068619  |
  14 |         x93     .1016523     .0464178     .0552345     .0572377     .9650011     .9263536  |
  15 |         x94    -.1252265     .0045953    -.1298217    -.1361687     .9533888     .8528771  |
  16 |         x95    -.1044649    -.0695904    -.0348746    -.0364286     .9573389     .8141756  |
     +--------------------------------------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], ate aequations")

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  2.423e-25  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATE                     |
                  treat |
(Treated vs Untreated)  |  -332.1348   56.53175    -5.88   0.000     -442.935   -221.3346
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
             Untreated  |   3453.029    20.1341   171.50   0.000     3413.567    3492.491
------------------------+----------------------------------------------------------------
TME1                    |
                     x1 |  -1.299227   .2371935    -5.48   0.000    -1.764118   -.8343367
                        |
                     x2 |
                     1  |  -1.630014    .746001    -2.19   0.029    -3.092149   -.1678787
                        |
                     x3 |
                     1  |  -.4513753   .5770312    -0.78   0.434    -1.582336    .6795851
                     x4 |  -.3551911    .204881    -1.73   0.083    -.7567506    .0463684
                     x5 |    .058452   .0195046     3.00   0.003     .0202237    .0966803
                     x6 |  -.2821622    .049775    -5.67   0.000    -.3797195    -.184605
                     x7 |   .0332008   .0279849     1.19   0.235    -.0216486    .0880501
                    x90 |   .1276778   .0907109     1.41   0.159    -.0501124     .305468
                    x91 |  -.0961159   .0916737    -1.05   0.294     -.275793    .0835612
                    x92 |   .1400043   .0976573     1.43   0.152    -.0514004    .3314091
                    x93 |   .0734557   .0916967     0.80   0.423    -.1062665     .253178
                    x94 |  -.1435742   .0862727    -1.66   0.096    -.3126656    .0255172
                    x95 |  -.0212452   .0898768    -0.24   0.813    -.1974006    .1549102
                  _cons |    1.24872   .6712769     1.86   0.063    -.0669587    2.564399
-----------------------------------------------------------------------------------------

:   DW.ipw("ate")
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462              0   -1.630013723              0    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0961158854    .1400043185    .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------------------------------------+

: 
:   stata("teffects ipw (`:word 1 of `depvars'') (`treatvar' `varlist') if `tousevar' [iw=`wgtvar'], atet aequations tlevel(0) control(1)")

Iteration 0:   EE criterion =  3.987e-18  
Iteration 1:   EE criterion =  1.908e-26  

Treatment-effects estimation                    Number of obs     =        500
Estimator      : inverse-probability weights
Outcome model  : weighted mean
Treatment model: logit
-----------------------------------------------------------------------------------------
                        |               Robust
                     y1 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------+----------------------------------------------------------------
ATET                    |
                  treat |
(Untreated vs Treated)  |   321.4309   62.35166     5.16   0.000     199.2239    443.6379
------------------------+----------------------------------------------------------------
POmean                  |
                  treat |
               Treated  |   3138.003   59.50596    52.73   0.000     3021.374    3254.633
------------------------+----------------------------------------------------------------
TME0                    |
                     x1 |   1.299227   .2371935     5.48   0.000     .8343367    1.764118
                        |
                     x2 |
                     1  |   1.630014    .746001     2.19   0.029     .1678787    3.092149
                        |
                     x3 |
                     1  |   .4513753   .5770312     0.78   0.434    -.6795851    1.582336
                     x4 |   .3551911    .204881     1.73   0.083    -.0463684    .7567506
                     x5 |   -.058452   .0195046    -3.00   0.003    -.0966803   -.0202237
                     x6 |   .2821622    .049775     5.67   0.000      .184605    .3797195
                     x7 |  -.0332008   .0279849    -1.19   0.235    -.0880501    .0216486
                    x90 |  -.1276778   .0907109    -1.41   0.159     -.305468    .0501124
                    x91 |   .0961159   .0916737     1.05   0.294    -.0835612     .275793
                    x92 |  -.1400043   .0976573    -1.43   0.152    -.3314091    .0514004
                    x93 |  -.0734557   .0916967    -0.80   0.423     -.253178    .1062665
                    x94 |   .1435742   .0862727     1.66   0.096    -.0255172    .3126656
                    x95 |   .0212452   .0898768     0.24   0.813    -.1549102    .1974006
                  _cons |   -1.24872   .6712769    -1.86   0.063    -2.564399    .0669587
-----------------------------------------------------------------------------------------

:   DW.ipw("ateu")
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.299227462              0   -1.630013723              0    -.451375265   -.3551910971    .0584519984    -.282162246    .0332007599    .1276777932
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0961158854    .1400043185    .0734557382   -.1435741845   -.0212452286    1.248719931  |
     -------------------------------------------------------------------------------------------+

: 
: // tradeoff between CBPS-like balance and variance in weights
: 
:   DW.cbps("atet","cbps", 1, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -435.82179  
Iteration 2:   f(p) = -411.28725  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00001735  
Iteration 1:   f(p) =  6.450e-06  
Iteration 2:   f(p) =  5.892e-06  
Iteration 3:   f(p) =  5.889e-06  
Iteration 4:   f(p) =  5.889e-06  
Iteration 5:   f(p) =  5.884e-06  
Iteration 6:   f(p) =  5.782e-06  
Iteration 7:   f(p) =  1.672e-06  
Iteration 8:   f(p) =  1.353e-06  
Iteration 9:   f(p) =  1.347e-06  
Iteration 10:  f(p) =  1.347e-06  
Iteration 11:  f(p) =  1.345e-06  
(switching technique to nr)
Iteration 12:  f(p) =  7.515e-07  
Iteration 13:  f(p) =  6.172e-07  
Iteration 14:  f(p) =  2.892e-07  
Iteration 15:  f(p) =  5.356e-08  
Iteration 16:  f(p) =  8.139e-10  
Iteration 17:  f(p) =  8.812e-13  
Iteration 18:  f(p) =  1.377e-20  
Iteration 19:  f(p) =  1.051e-26  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |   -1.44704714              0   -1.546890931              0    -.471062263   -.3822539288    .0635823768   -.2432270283    .0477026872    .1334992086
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1336116528    .1522937137    .0757732417   -.1016170888   -.0383391404    .6265763157  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4512231    -9.76e-13    -1.96e-12     .4990018     1.004328  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0114039     2.24e-13     2.10e-12     .1064741     1.004328  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0240637     1.66e-14     1.08e-13     .1536741     1.004328  |
   7 |          x4     .4218861     .4218861    -6.23e-13    -1.26e-12     .4952368     1.004328  |
   8 |          x5     25.44699     25.44699    -3.22e-12    -5.94e-13     5.422129     .6144662  |
   9 |          x6     11.84757     11.84757    -5.03e-12    -3.07e-12     1.641931     .5982513  |
  10 |          x7     7.015422     7.015422    -6.31e-13    -1.77e-13     3.555432     1.161761  |
  11 |         x90     .0839738     .0839738     3.95e-13     4.12e-13     .9597153     .8505325  |
  12 |         x91    -.0648837    -.0648837    -2.28e-13    -2.43e-13       .93861     .9922891  |
  13 |         x92     .0575388     .0575388     1.13e-12     1.09e-12      1.03554     1.118263  |
  14 |         x93     .1016523     .1016523    -5.35e-13    -5.65e-13     .9463749     1.012572  |
  15 |         x94    -.1252265    -.1252265    -5.33e-14    -5.83e-14     .9147554     .7576623  |
  16 |         x95    -.1044649    -.1044649    -7.43e-13    -8.19e-13     .9069849     .8646431  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.49386e-25
  Mean absolute standardized diff.
  9.57575e-13
  Maximum absolute standardized diff.
  3.06602e-12
  C.V. of matching weights:
  1.031924564
  S.D. of matching weights:
  1.02710789
  Skewness of matching weights:
  .1135011509
  Kurtosis of matching weights:
  .0229206639
  Maximum matching weight:
  7.007741998
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.367            3431.367           -1.57e-10            3431.367  |
  3 |          y1_binary            .9509094            .9509094           -4.86e-14            .9509094  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","cbps", 1, 0, (1,.75,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -435.82179  
Iteration 2:   f(p) = -411.28725  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .00093832  
Iteration 1:   f(p) =  .00004631  
Iteration 2:   f(p) =  .00003859  
Iteration 3:   f(p) =  .00003858  
Iteration 4:   f(p) =  .00003858  
Iteration 5:   f(p) =  .00003857  
Iteration 6:   f(p) =  .00003712  
Iteration 7:   f(p) =  .00001543  
Iteration 8:   f(p) =  .00001516  
Iteration 9:   f(p) =  .00001516  
Iteration 10:  f(p) =  .00001516  
Iteration 11:  f(p) =  .00001516  
(switching technique to nr)
Iteration 12:  f(p) =  .00001496  
Iteration 13:  f(p) =  .00001252  
Iteration 14:  f(p) =  .00001246  
Iteration 15:  f(p) =  .00001246  
Iteration 16:  f(p) =  .00001246  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.254172685              0   -1.322938195              0   -.3738050359   -.3150602517    .0538657054    -.207349279    .0392239292    .1112138201
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1096073709    .1251076436    .0659586261   -.0938176083   -.0291265862    .4368750691  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4880538    -.0368307    -.0738087     .4990018     .9953382  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0133715    -.0019676    -.0184797     .1064741     .8582497  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637      .026706    -.0026423    -.0171943     .1536741     .9074156  |
   7 |          x4     .4218861     .4355817    -.0136956    -.0276546     .4952368     .9963536  |
   8 |          x5     25.44699     25.52568     -.078699    -.0145144     5.422129     .6374798  |
   9 |          x6     11.84757      12.0082    -.1606278    -.0978286     1.641931     .5789038  |
  10 |          x7     7.015422     6.963125     .0522971     .0147091     3.555432     1.157516  |
  11 |         x90     .0839738     .0663511     .0176227     .0183624     .9597153      .859923  |
  12 |         x91    -.0648837     -.055222    -.0096617    -.0102937       .93861     .9716605  |
  13 |         x92     .0575388     .0443227      .013216     .0127624      1.03554      1.11088  |
  14 |         x93     .1016523     .0920485     .0096038      .010148     .9463749     .9946043  |
  15 |         x94    -.1252265    -.1096348    -.0155917    -.0170446     .9147554     .7709592  |
  16 |         x95    -.1044649    -.0986888    -.0057762    -.0063685     .9069849      .855481  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0003054568
  Mean absolute standardized diff.
  .0260899265
  Maximum absolute standardized diff.
  .0978285902
  C.V. of matching weights:
  .8670555951
  S.D. of matching weights:
  .8635493082
  Skewness of matching weights:
  .0962293895
  Kurtosis of matching weights:
  .0177411606
  Maximum matching weight:
  5.513183751
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.705            3436.507           -4.802342            3436.507  |
  3 |          y1_binary            .9509266            .9524268           -.0015001            .9524268  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","cbps", 1, 0, (1,.50,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -435.82179  
Iteration 2:   f(p) = -411.28725  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
(setting technique to bfgs)
Iteration 0:   f(p) =  .03149775  
Iteration 1:   f(p) =  .00028651  
Iteration 2:   f(p) =  .00020393  
Iteration 3:   f(p) =  .00019258  
Iteration 4:   f(p) =  .00019213  
Iteration 5:   f(p) =  .00019201  
Iteration 6:   f(p) =  .00019201  
Iteration 7:   f(p) =  .00019103  
Iteration 8:   f(p) =  .00015742  
Iteration 9:   f(p) =  .00012551  
Iteration 10:  f(p) =  .00012396  
Iteration 11:  f(p) =  .00012368  
(switching technique to nr)
Iteration 12:  f(p) =  .00012357  
Iteration 13:  f(p) =  .00008847  
Iteration 14:  f(p) =  .00007975  
Iteration 15:  f(p) =  .00007967  
Iteration 16:  f(p) =  .00007967  
Iteration 17:  f(p) =  .00007967  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.9697341561              0   -1.009948577              0   -.2681221537    -.232871244    .0401949193   -.1592825925    .0284833467    .0826320693
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0793651105    .0918044419    .0506806047    -.079089199   -.0177968522    .1432469629  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .5455567    -.0943336    -.1890445     .4990018     1.003097  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0163287    -.0049248    -.0462539     .1064741     .7049278  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637      .030259    -.0061953    -.0403148     .1536741     .8038013  |
   7 |          x4     .4218861     .4518913    -.0300052    -.0605877     .4952368     .9889709  |
   8 |          x5     25.44699     25.68608    -.2390904    -.0440953     5.422129     .6743964  |
   9 |          x6     11.84757     12.24705    -.3994838    -.2433012     1.641931     .5553462  |
  10 |          x7     7.015422     6.896035     .1193864     .0335786     3.555432     1.154006  |
  11 |         x90     .0839738     .0421678      .041806     .0435608     .9597153     .8752328  |
  12 |         x91    -.0648837    -.0430186    -.0218651    -.0232952       .93861     .9459252  |
  13 |         x92     .0575388     .0282798     .0292589     .0282548      1.03554     1.101598  |
  14 |         x93     .1016523     .0789385     .0227138     .0240009     .9463749     .9718368  |
  15 |         x94    -.1252265    -.0859452    -.0392812    -.0429418     .9147554      .788992  |
  16 |         x95    -.1044649    -.0909645    -.0135004    -.0148849     .9069849     .8447606  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  .0019585678
  Mean absolute standardized diff.
  .0641626362
  Maximum absolute standardized diff.
  .2433012237
  C.V. of matching weights:
  .6486308571
  S.D. of matching weights:
  .6465925178
  Skewness of matching weights:
  .0752729456
  Kurtosis of matching weights:
  .0127429091
  Maximum matching weight:
  3.88354215
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3433.335            3443.146           -9.811782            3443.146  |
  3 |          y1_binary             .950974            .9546103           -.0036363            .9546103  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   st_local("mlopts", " nonrtolerance")

:   DW.cbps("atet","mean_sd_sq", 1, 0, (1,.75,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00118407  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00047827  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .00006974  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00004509  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  9.893e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  2.962e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  1.695e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  6.547e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  2.889e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  1.307e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  8.558e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  7.610e-08  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  6.398e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  6.373e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  2.630e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  2.082e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  2.040e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  1.876e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  1.808e-08  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  6.771e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  6.228e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  5.106e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  4.055e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  3.953e-09  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  3.802e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  1.991e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  1.442e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  1.312e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  1.289e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  1.017e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  1.617e-10  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  3.928e-11  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  1.874e-11  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  6.925e-12  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 34:  f(p) =  1.598e-12  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.216986763              0   -1.571985713              0   -.4535952199   -.1198313562    .0055783829   -.0665758561   -.0181092495    .0324430257
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1052272381    .0895221866    .0238571903   -.0942796716   -.0284796811    1.256772393  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .4600029    -.0087797    -.0175946     .4990018     1.001177  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0099666     .0014373      .013499     .1064741     1.147496  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0210207      .003043     .0198015     .1536741     1.146141  |
   7 |          x4     .4218861     .5324699    -.1105838    -.2232949     .4952368     .9839648  |
   8 |          x5     25.44699     24.30524     1.141746     .2105716     5.422129     .7516516  |
   9 |          x6     11.84757     12.28247    -.4348956    -.2648684     1.641931     .5461252  |
  10 |          x7     7.015422     6.385598     .6298232     .1771439     3.555432     1.149439  |
  11 |         x90     .0839738     .0447679      .039206     .0408516     .9597153     .8380189  |
  12 |         x91    -.0648837    -.0653152     .0004315     .0004597       .93861     .9557679  |
  13 |         x92     .0575388     .0441054     .0134334     .0129723      1.03554     1.072122  |
  14 |         x93     .1016523     .0508218     .0508305     .0537108     .9463749     .9798565  |
  15 |         x94    -.1252265    -.1143243    -.0109022    -.0119181     .9147554     .8172598  |
  16 |         x95    -.1044649    -.0941881    -.0102769    -.0113308     .9069849     .8579994  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  7.75265e-14
  Mean absolute standardized diff.
  .0813859422
  Maximum absolute standardized diff.
  .2648683875
  C.V. of matching weights:
  .7607234445
  S.D. of matching weights:
  .7563162627
  Skewness of matching weights:
  .075974501
  Kurtosis of matching weights:
  .0104523964
  Maximum matching weight:
  3.764397393
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3436.571            3441.722            -5.15057            3441.722  |
  3 |          y1_binary            .9508375            .9599627           -.0091252            .9599627  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","mean_sd_sq", 1, 0, (1,.50,6))
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .03174366  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .01880683  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  .01499079  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  .00460016  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  .00088681  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 5:   f(p) =  .00069868  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 6:   f(p) =  .00016284  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 7:   f(p) =  .00008031  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 8:   f(p) =  .00004972  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 9:   f(p) =  .00003906  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 10:  f(p) =  .00003723  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 11:  f(p) =  .00002755  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 12:  f(p) =  .00001175  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 13:  f(p) =  9.697e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 14:  f(p) =  9.559e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 15:  f(p) =  8.433e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 16:  f(p) =  3.580e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 17:  f(p) =  2.863e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 18:  f(p) =  2.730e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 19:  f(p) =  2.705e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 20:  f(p) =  2.471e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 21:  f(p) =  2.347e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 22:  f(p) =  2.206e-06  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 23:  f(p) =  2.165e-06  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 24:  f(p) =  2.109e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 25:  f(p) =  1.995e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 26:  f(p) =  1.454e-06  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 27:  f(p) =  9.125e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 28:  f(p) =  7.114e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 29:  f(p) =  4.193e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 30:  f(p) =  2.479e-07  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 31:  f(p) =  7.787e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 32:  f(p) =  4.079e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 33:  f(p) =  2.023e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 34:  f(p) =  1.122e-08  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 35:  f(p) =  8.392e-09  
(switching technique to nr)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 36:  f(p) =  7.589e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 37:  f(p) =  7.538e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 38:  f(p) =  7.505e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 39:  f(p) =  7.477e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 40:  f(p) =  7.442e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 41:  f(p) =  7.405e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 42:  f(p) =  7.380e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 43:  f(p) =  7.355e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 44:  f(p) =  7.293e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 45:  f(p) =  7.219e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 46:  f(p) =  7.206e-09  (not concave)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 47:  f(p) =  7.195e-09  (not concave)
(switching technique to bfgs)
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 48:  f(p) =  7.184e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 49:  f(p) =  7.116e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
BFGS stepping has contracted, resetting BFGS Hessian
Iteration 50:  f(p) =  3.442e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 51:  f(p) =  2.540e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 52:  f(p) =  2.479e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 53:  f(p) =  2.431e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 54:  f(p) =  1.874e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 55:  f(p) =  7.788e-10  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 56:  f(p) =  5.802e-10  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 57:  f(p) =  5.108e-10  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 58:  f(p) =  4.887e-10  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 59:  f(p) =  4.856e-10  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -.6910577735              0   -2.985910945              0   -.7886790532   -.2490389181    .0002995071   -.0243529048   -.0121529296   -.1133510981
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.1568458695   -.1191312632   -.0996441735   -.0890135356   -.1982234858    3.186806296  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231     .6202686    -.1690454    -.3387671     .4990018      1.05586  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0019043     .0094995     .0892192     .1064741     5.957079  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0145215     .0095422     .0620939     .1536741     1.648167  |
   7 |          x4     .4218861     .4838209    -.0619348    -.1250609     .4952368     .9808422  |
   8 |          x5     25.44699     25.62729    -.1803057    -.0332537     5.422129     .7777679  |
   9 |          x6     11.84757     12.70652    -.8589463    -.5231319     1.641931     .5239996  |
  10 |          x7     7.015422     6.591588     .4238338     .1192074     3.555432     1.117382  |
  11 |         x90     .0839738    -.1175101     .2014839     .2099413     .9597153     .8841738  |
  12 |         x91    -.0648837    -.1316177      .066734     .0710988       .93861     .9550872  |
  13 |         x92     .0575388    -.1403701     .1979088     .1911165      1.03554     1.085314  |
  14 |         x93     .1016523    -.0424053     .1440577     .1522205     .9463749     .8853322  |
  15 |         x94    -.1252265    -.1076353    -.0175912    -.0192304     .9147554     .8219258  |
  16 |         x95    -.1044649    -.2355655     .1311006     .1445455     .9069849     .8418122  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  5.86941e-15
  Mean absolute standardized diff.
  .1599143925
  Maximum absolute standardized diff.
  .5231318853
  C.V. of matching weights:
  .5280362216
  S.D. of matching weights:
  .5269814036
  Skewness of matching weights:
  .0599639617
  Kurtosis of matching weights:
  .0129278301
  Maximum matching weight:
  3.356419081
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3445.009            3479.508           -34.49932            3479.508  |
  3 |          y1_binary            .9510146            .9622108           -.0111961            .9622108  |
    +-----------------------------------------------------------------------------------------------------+

: 
:   DW.cbps("atet","mean_sd_sq", 1, 0)
  Step 1 (initial values from logit model):
initial:       f(p) = -681.05307
alternative:   f(p) =  -555.8915
rescale:       f(p) = -485.05844
Iteration 0:   f(p) = -485.05844  
Iteration 1:   f(p) = -436.32795  
Iteration 2:   f(p) = -411.28929  
Iteration 3:   f(p) = -411.19869  
Iteration 4:   f(p) = -411.19865  
Iteration 5:   f(p) = -411.19865  
  
  Step 2 (CBPS) :
numerical derivatives are approximate
flat or discontinuous region encountered
(setting technique to bfgs)
Iteration 0:   f(p) =  .00026309  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 1:   f(p) =  .00001126  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 2:   f(p) =  4.733e-09  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 3:   f(p) =  1.762e-13  
numerical derivatives are approximate
flat or discontinuous region encountered
Iteration 4:   f(p) =  1.968e-21  
                  1              2              3              4              5              6              7              8              9             10
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
  1 |  -1.298300659              0   -1.629910465              0   -.4511737896   -.3553036347    .0715800496    -.277332404    .0371348754    .1283825511
    +-------------------------------------------------------------------------------------------------------------------------------------------------------
                 11             12             13             14             15             16
     -------------------------------------------------------------------------------------------+
  1    -.0952384668    .1409151853    .0743038835   -.1419191916     -.02015005     1.24895601  |
     -------------------------------------------------------------------------------------------+

:   DW.balanceresults("atet",1)
  Balance table:
                 1            2            3            4            5            6            7
     +--------------------------------------------------------------------------------------------+
   1 |    Variable     mean (T)     mean (C)       diff()    stddiff()       sd (T)   varratio()  |
   2 |          x1     .4512231      .487981    -.0367579    -.0736628     .4990018     .9953452  |
   3 |       0b.x2            0            0            0            .            0            .  |
   4 |        1.x2     .0114039     .0101189     .0012849     .0120681     .1064741     1.130392  |
   5 |       0b.x3            0            0            0            .            0            .  |
   6 |        1.x3     .0240637     .0243904    -.0003267     -.002126     .1536741      .991207  |
   7 |          x4     .4218861     .4077073     .0141788     .0286304     .4952368     1.014377  |
   8 |          x5     25.44699     25.93854    -.4915548    -.0906572     5.422129     .5820455  |
   9 |          x6     11.84757     11.77832     .0692519     .0421771     1.641931     .5870658  |
  10 |          x7     7.015422     6.877177     .1382443     .0388826     3.555432     1.150412  |
  11 |         x90     .0839738     .0558962     .0280776     .0292562     .9597153     .8505932  |
  12 |         x91    -.0648837    -.0314162    -.0334675    -.0356565       .93861     .9896463  |
  13 |         x92     .0575388     .0508005     .0067383      .006507      1.03554     1.132825  |
  14 |         x93     .1016523     .1109109    -.0092586    -.0097833     .9463749     1.021042  |
  15 |         x94    -.1252265    -.1752569     .0500305     .0546928     .9147554     .7291541  |
  16 |         x95    -.1044649     -.104167    -.0002979    -.0003285     .9069849     .8690485  |
     +--------------------------------------------------------------------------------------------+
  Mean standardized diff., squared
  1.96769e-21
  Mean absolute standardized diff.
  .03264833
  Maximum absolute standardized diff.
  .0906571707
  C.V. of matching weights:
  1.067016841
  S.D. of matching weights:
  1.064358817
  Skewness of matching weights:
  .1583892396
  Kurtosis of matching weights:
  .0509012076
  Maximum matching weight:
  10.57744042
  Difference in prognostic scores:
                       1                   2                   3                   4                   5
    +-----------------------------------------------------------------------------------------------------+
  1 |     Dependent var.   Mean of y_hat (T)   Mean of y_hat (C)    prognosticdiff()       Mean of y (C)  |
  2 |                 y1            3431.445            3432.164           -.7196186            3432.164  |
  3 |          y1_binary            .9507734            .9518109           -.0010374            .9518109  |
    +-----------------------------------------------------------------------------------------------------+

:   st_local("mlopts", "")

: 
:   // you can also target skiwness, kurtosis, or max weight, but it's finicky
: 
: end  // end of Mata block
----------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. log close gmatch_example
      name:  gmatch_example
       log:  C:\Users\kkranker\Documents\Stata\Ado\Devel\gmatch\gmatch_example.log
  log type:  text
 closed on:  22 Feb 2018, 12:59:34
----------------------------------------------------------------------------------------------------------------------------------------------------------------
